d41f2bd3c4ff523654afaaf1e1ff6eb7
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// src/enrollment/enrollment.service.spec.ts
const enrollment_service_1 = require("./enrollment.service");
const common_1 = require("@nestjs/common");
describe('EnrollmentService', () => {
    let service;
    beforeEach(() => {
        service = new enrollment_service_1.EnrollmentService();
    });
    describe('enroll', () => {
        it('should enroll a student successfully', async () => {
            const dto = { studentId: 'student1', courseId: 'course1' };
            const enrollment = await service.enroll(dto);
            expect(enrollment).toHaveProperty('id');
            expect(enrollment.studentId).toBe('student1');
            expect(enrollment.courseId).toBe('course1');
            expect(enrollment.status).toBe('ENROLLED');
            expect(enrollment.paymentStatus).toBe('PAID');
        });
        it('should throw error if already enrolled', async () => {
            const dto = { studentId: 'student2', courseId: 'course1' };
            await service.enroll(dto);
            await expect(service.enroll(dto)).rejects.toThrow(common_1.BadRequestException);
        });
        it('should throw error if course is full', async () => {
            const dto1 = { studentId: 's1', courseId: 'course1' };
            const dto2 = { studentId: 's2', courseId: 'course1' };
            const dto3 = { studentId: 's3', courseId: 'course1' };
            await service.enroll(dto1);
            await service.enroll(dto2);
            await expect(service.enroll(dto3)).rejects.toThrow(common_1.BadRequestException);
        });
        it('should throw error if prerequisites are not met', async () => {
            const dto = { studentId: 'student3', courseId: 'course2' }; // course2 requires course1
            await expect(service.enroll(dto)).rejects.toThrow(common_1.BadRequestException);
        });
        it('should allow enrollment after completing prerequisites', async () => {
            const studentId = 'student4';
            // Complete course1 first
            await service.enroll({ studentId, courseId: 'course1' });
            // Then enroll in course2
            const enrollment = await service.enroll({ studentId, courseId: 'course2' });
            expect(enrollment.courseId).toBe('course2');
            expect(enrollment.status).toBe('ENROLLED');
        });
    });
    describe('unenroll', () => {
        it('should unenroll a student successfully', async () => {
            const dto = { studentId: 'student5', courseId: 'course1' };
            const enrollment = await service.enroll(dto);
            await service.unenroll(enrollment.id);
            const found = service.findAll().find(e => e.id === enrollment.id);
            expect(found.status).toBe('UNENROLLED');
        });
        it('should throw error if enrollment not found', async () => {
            await expect(service.unenroll('non-existing-id')).rejects.toThrow(common_1.NotFoundException);
        });
        it('should throw error if already unenrolled', async () => {
            const dto = { studentId: 'student6', courseId: 'course1' };
            const enrollment = await service.enroll(dto);
            await service.unenroll(enrollment.id);
            await expect(service.unenroll(enrollment.id)).rejects.toThrow(common_1.BadRequestException);
        });
    });
    describe('findAll', () => {
        it('should return all enrollments', async () => {
            const dto1 = { studentId: 'student7', courseId: 'course1' };
            const dto2 = { studentId: 'student8', courseId: 'course1' };
            await service.enroll(dto1);
            await service.enroll(dto2);
            const enrollments = service.findAll();
            expect(enrollments.length).toBeGreaterThanOrEqual(2);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxnLWVrb2hcXERlc2t0b3BcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFxlbnJvbGxtZW50XFxlbnJvbGxtZW50LnNlcnZpY2Uuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDRDQUE0QztBQUM1Qyw2REFBeUQ7QUFFekQsMkNBQXdFO0FBRXhFLFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7SUFDakMsSUFBSSxPQUEwQixDQUFDO0lBRS9CLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxPQUFPLEdBQUcsSUFBSSxzQ0FBaUIsRUFBRSxDQUFDO0lBQ3BDLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUU7UUFDdEIsRUFBRSxDQUFDLHNDQUFzQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3BELE1BQU0sR0FBRyxHQUF3QixFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxDQUFDO1lBQ2hGLE1BQU0sVUFBVSxHQUFHLE1BQU0sT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUU3QyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3hDLE1BQU0sQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQzlDLE1BQU0sQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQzVDLE1BQU0sQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQzNDLE1BQU0sQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2hELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHdDQUF3QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3RE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QUFJLENBQUMsQ0FBQztZQUUzQixNQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDdEMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN2RCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxnLWVrb2hcXERlc2t0b3BcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFxlbnJvbGxtZW50XFxlbnJvbGxtZW50LnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvZW5yb2xsbWVudC9lbnJvbGxtZW50LnNlcnZpY2Uuc3BlYy50c1xyXG5pbXBvcnQgeyBFbnJvbGxtZW50U2VydmljZSB9IGZyb20gJy4vZW5yb2xsbWVudC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQ3JlYXRlRW5yb2xsbWVudER0byB9IGZyb20gJy4vZHRvL2NyZWF0ZS1lbnJvbGxtZW50LmR0byc7XHJcbmltcG9ydCB7IEJhZFJlcXVlc3RFeGNlcHRpb24sIE5vdEZvdW5kRXhjZXB0aW9uIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xyXG5cclxuZGVzY3JpYmUoJ0Vucm9sbG1lbnRTZXJ2aWNlJywgKCkgPT4ge1xyXG4gIGxldCBzZXJ2aWNlOiBFbnJvbGxtZW50U2VydmljZTtcclxuXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBzZXJ2aWNlID0gbmV3IEVucm9sbG1lbnRTZXJ2aWNlKCk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdlbnJvbGwnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGVucm9sbCBhIHN0dWRlbnQgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBkdG86IENyZWF0ZUVucm9sbG1lbnREdG8gPSB7IHN0dWRlbnRJZDogJ3N0dWRlbnQxJywgY291cnNlSWQ6ICdjb3Vyc2UxJyB9O1xyXG4gICAgICBjb25zdCBlbnJvbGxtZW50ID0gYXdhaXQgc2VydmljZS5lbnJvbGwoZHRvKTtcclxuXHJcbiAgICAgIGV4cGVjdChlbnJvbGxtZW50KS50b0hhdmVQcm9wZXJ0eSgnaWQnKTtcclxuICAgICAgZXhwZWN0KGVucm9sbG1lbnQuc3R1ZGVudElkKS50b0JlKCdzdHVkZW50MScpO1xyXG4gICAgICBleHBlY3QoZW5yb2xsbWVudC5jb3Vyc2VJZCkudG9CZSgnY291cnNlMScpO1xyXG4gICAgICBleHBlY3QoZW5yb2xsbWVudC5zdGF0dXMpLnRvQmUoJ0VOUk9MTEVEJyk7XHJcbiAgICAgIGV4cGVjdChlbnJvbGxtZW50LnBheW1lbnRTdGF0dXMpLnRvQmUoJ1BBSUQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3IgaWYgYWxyZWFkeSBlbnJvbGxlZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZHRvOiBDcmVhdGVFbnJvbGxtZW50RHRvID0geyBzdHVkZW50SWQ6ICdzdHVkZW50MicsIGNvdXJzZUlkOiAnY291cnNlMScgfTtcclxuICAgICAgYXdhaXQgc2VydmljZS5lbnJvbGwoZHRvKTtcclxuXHJcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmVucm9sbChkdG8pKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEV4Y2VwdGlvbik7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGlmIGNvdXJzZSBpcyBmdWxsJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBkdG8xID0geyBzdHVkZW50SWQ6ICdzMScsIGNvdXJzZUlkOiAnY291cnNlMScgfTtcclxuICAgICAgY29uc3QgZHRvMiA9IHsgc3R1ZGVudElkOiAnczInLCBjb3Vyc2VJZDogJ2NvdXJzZTEnIH07XHJcbiAgICAgIGNvbnN0IGR0bzMgPSB7IHN0dWRlbnRJZDogJ3MzJywgY291cnNlSWQ6ICdjb3Vyc2UxJyB9O1xyXG5cclxuICAgICAgYXdhaXQgc2VydmljZS5lbnJvbGwoZHRvMSk7XHJcbiAgICAgIGF3YWl0IHNlcnZpY2UuZW5yb2xsKGR0bzIpO1xyXG5cclxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuZW5yb2xsKGR0bzMpKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEV4Y2VwdGlvbik7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGlmIHByZXJlcXVpc2l0ZXMgYXJlIG5vdCBtZXQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGR0bzogQ3JlYXRlRW5yb2xsbWVudER0byA9IHsgc3R1ZGVudElkOiAnc3R1ZGVudDMnLCBjb3Vyc2VJZDogJ2NvdXJzZTInIH07IC8vIGNvdXJzZTIgcmVxdWlyZXMgY291cnNlMVxyXG5cclxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuZW5yb2xsKGR0bykpLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXhjZXB0aW9uKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgYWxsb3cgZW5yb2xsbWVudCBhZnRlciBjb21wbGV0aW5nIHByZXJlcXVpc2l0ZXMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHN0dWRlbnRJZCA9ICdzdHVkZW50NCc7XHJcblxyXG4gICAgICAvLyBDb21wbGV0ZSBjb3Vyc2UxIGZpcnN0XHJcbiAgICAgIGF3YWl0IHNlcnZpY2UuZW5yb2xsKHsgc3R1ZGVudElkLCBjb3Vyc2VJZDogJ2NvdXJzZTEnIH0pO1xyXG5cclxuICAgICAgLy8gVGhlbiBlbnJvbGwgaW4gY291cnNlMlxyXG4gICAgICBjb25zdCBlbnJvbGxtZW50ID0gYXdhaXQgc2VydmljZS5lbnJvbGwoeyBzdHVkZW50SWQsIGNvdXJzZUlkOiAnY291cnNlMicgfSk7XHJcblxyXG4gICAgICBleHBlY3QoZW5yb2xsbWVudC5jb3Vyc2VJZCkudG9CZSgnY291cnNlMicpO1xyXG4gICAgICBleHBlY3QoZW5yb2xsbWVudC5zdGF0dXMpLnRvQmUoJ0VOUk9MTEVEJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3VuZW5yb2xsJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCB1bmVucm9sbCBhIHN0dWRlbnQgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBkdG86IENyZWF0ZUVucm9sbG1lbnREdG8gPSB7IHN0dWRlbnRJZDogJ3N0dWRlbnQ1JywgY291cnNlSWQ6ICdjb3Vyc2UxJyB9O1xyXG4gICAgICBjb25zdCBlbnJvbGxtZW50ID0gYXdhaXQgc2VydmljZS5lbnJvbGwoZHRvKTtcclxuXHJcbiAgICAgIGF3YWl0IHNlcnZpY2UudW5lbnJvbGwoZW5yb2xsbWVudC5pZCk7XHJcblxyXG4gICAgICBjb25zdCBmb3VuZCA9IHNlcnZpY2UuZmluZEFsbCgpLmZpbmQoZSA9PiBlLmlkID09PSBlbnJvbGxtZW50LmlkKTtcclxuICAgICAgZXhwZWN0KGZvdW5kLnN0YXR1cykudG9CZSgnVU5FTlJPTExFRCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBpZiBlbnJvbGxtZW50IG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UudW5lbnJvbGwoJ25vbi1leGlzdGluZy1pZCcpKS5yZWplY3RzLnRvVGhyb3coTm90Rm91bmRFeGNlcHRpb24pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBpZiBhbHJlYWR5IHVuZW5yb2xsZWQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGR0bzogQ3JlYXRlRW5yb2xsbWVudER0byA9IHsgc3R1ZGVudElkOiAnc3R1ZGVudDYnLCBjb3Vyc2VJZDogJ2NvdXJzZTEnIH07XHJcbiAgICAgIGNvbnN0IGVucm9sbG1lbnQgPSBhd2FpdCBzZXJ2aWNlLmVucm9sbChkdG8pO1xyXG5cclxuICAgICAgYXdhaXQgc2VydmljZS51bmVucm9sbChlbnJvbGxtZW50LmlkKTtcclxuXHJcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLnVuZW5yb2xsKGVucm9sbG1lbnQuaWQpKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEV4Y2VwdGlvbik7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2ZpbmRBbGwnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBhbGwgZW5yb2xsbWVudHMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGR0bzE6IENyZWF0ZUVucm9sbG1lbnREdG8gPSB7IHN0dWRlbnRJZDogJ3N0dWRlbnQ3JywgY291cnNlSWQ6ICdjb3Vyc2UxJyB9O1xyXG4gICAgICBjb25zdCBkdG8yOiBDcmVhdGVFbnJvbGxtZW50RHRvID0geyBzdHVkZW50SWQ6ICdzdHVkZW50OCcsIGNvdXJzZUlkOiAnY291cnNlMScgfTtcclxuXHJcbiAgICAgIGF3YWl0IHNlcnZpY2UuZW5yb2xsKGR0bzEpO1xyXG4gICAgICBhd2FpdCBzZXJ2aWNlLmVucm9sbChkdG8yKTtcclxuXHJcbiAgICAgIGNvbnN0IGVucm9sbG1lbnRzID0gc2VydmljZS5maW5kQWxsKCk7XHJcbiAgICAgIGV4cGVjdChlbnJvbGxtZW50cy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMik7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdLCJ2ZXJzaW9uIjozfQ==