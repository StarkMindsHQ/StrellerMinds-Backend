7da1966f632309dedba342659380c755
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.ProgressController = void 0;
/**
 * ProgressController handles user progress tracking and analytics endpoints.
 */
const common_1 = require("@nestjs/common");
const progress_service_1 = require("../services/progress.service");
const jwt_auth_guard_1 = require("../../auth/guards/jwt-auth.guard");
const roles_guard_1 = require("../../auth/guards/roles.guard");
const roles_decorator_1 = require("../../auth/decorators/roles.decorator");
const update_progress_dto_1 = require("../dtos/update-progress.dto");
const roles_enum_1 = require("src/role/roles.enum");
const swagger_1 = require("@nestjs/swagger");
let ProgressController = class ProgressController {
    constructor(progressService) {
        this.progressService = progressService;
    }
    async updateLessonProgress(req, courseId, lessonId, updateProgressDto) {
        try {
            return await this.progressService.updateLessonProgress(req.user.id, courseId, lessonId, updateProgressDto.progressPercentage, updateProgressDto.metadata);
        }
        catch (error) {
            if (error instanceof common_1.HttpException) {
                throw error;
            }
            throw new common_1.HttpException('Failed to update lesson progress', common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async getCourseProgress(req, courseId) {
        try {
            return await this.progressService.getCourseProgress(req.user.id, courseId);
        }
        catch (error) {
            if (error instanceof common_1.HttpException) {
                throw error;
            }
            throw new common_1.HttpException('Failed to retrieve course progress', common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async getUserProgress(req) {
        try {
            return await this.progressService.getUserProgress(req.user.id);
        }
        catch (error) {
            throw new common_1.HttpException('Failed to retrieve user progress', common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async syncProgress(req, courseId) {
        try {
            await this.progressService.syncProgress(req.user.id, courseId);
            return { message: 'Progress synchronized successfully' };
        }
        catch (error) {
            if (error instanceof common_1.HttpException) {
                throw error;
            }
            throw new common_1.HttpException('Failed to synchronize progress', common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async getCourseProgressAdmin(courseId) {
        try {
            // For admin, you may want to pass a special userId or null if your service supports it, or fetch all users' progress for the course.
            // Here, we'll pass null as userId, but you may need to adjust the service logic if it doesn't handle null.
            return await this.progressService.getCourseProgress(null, courseId);
        }
        catch (error) {
            if (error instanceof common_1.HttpException) {
                throw error;
            }
            throw new common_1.HttpException('Failed to retrieve admin course progress', common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async getLearningAnalytics(req, courseId) {
        try {
            return await this.progressService.getLearningAnalytics(req.user.id, courseId);
        }
        catch (error) {
            throw new common_1.HttpException('Failed to retrieve analytics', common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async getAdaptiveNextLessons(req, courseId) {
        try {
            return await this.progressService.getAdaptiveNextLessons(req.user.id, courseId);
        }
        catch (error) {
            throw new common_1.HttpException('Failed to retrieve adaptive next lessons', common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async getProgressVisualization(req, courseId) {
        try {
            return await this.progressService.getProgressVisualization(req.user.id, courseId);
        }
        catch (error) {
            throw new common_1.HttpException('Failed to retrieve progress visualization', common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async getLearningOutcomeMetrics(req, courseId) {
        try {
            return await this.progressService.getLearningOutcomeMetrics(req.user.id, courseId);
        }
        catch (error) {
            throw new common_1.HttpException('Failed to retrieve learning outcome metrics', common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
};
exports.ProgressController = ProgressController;
__decorate([
    (0, swagger_1.ApiOperation)({ summary: 'Update lesson progress' }),
    (0, swagger_1.ApiParam)({ name: 'courseId', type: 'string', description: 'Course ID' }),
    (0, swagger_1.ApiParam)({ name: 'lessonId', type: 'string', description: 'Lesson ID' }),
    (0, swagger_1.ApiBody)({ type: update_progress_dto_1.UpdateProgressDto }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'Lesson progress updated.' }),
    (0, common_1.Post)('courses/:courseId/lessons/:lessonId'),
    __param(0, (0, common_1.Request)()),
    __param(1, (0, common_1.Param)('courseId', common_1.ParseUUIDPipe)),
    __param(2, (0, common_1.Param)('lessonId', common_1.ParseUUIDPipe)),
    __param(3, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String, String, typeof (_b = typeof update_progress_dto_1.UpdateProgressDto !== "undefined" && update_progress_dto_1.UpdateProgressDto) === "function" ? _b : Object]),
    __metadata("design:returntype", Promise)
], ProgressController.prototype, "updateLessonProgress", null);
__decorate([
    (0, swagger_1.ApiOperation)({ summary: 'Get course progress' }),
    (0, swagger_1.ApiParam)({ name: 'courseId', type: 'string', description: 'Course ID' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'Course progress.' }),
    (0, common_1.Get)('courses/:courseId'),
    __param(0, (0, common_1.Request)()),
    __param(1, (0, common_1.Param)('courseId', common_1.ParseUUIDPipe)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", Promise)
], ProgressController.prototype, "getCourseProgress", null);
__decorate([
    (0, swagger_1.ApiOperation)({ summary: 'Get user progress' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'User progress.' }),
    (0, common_1.Get)('user'),
    __param(0, (0, common_1.Request)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], ProgressController.prototype, "getUserProgress", null);
__decorate([
    (0, swagger_1.ApiOperation)({ summary: 'Sync course progress' }),
    (0, swagger_1.ApiParam)({ name: 'courseId', type: 'string', description: 'Course ID' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'Progress synchronized.' }),
    (0, common_1.Post)('courses/:courseId/sync'),
    __param(0, (0, common_1.Request)()),
    __param(1, (0, common_1.Param)('courseId', common_1.ParseUUIDPipe)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", Promise)
], ProgressController.prototype, "syncProgress", null);
__decorate([
    (0, swagger_1.ApiOperation)({ summary: 'Get course progress (admin)' }),
    (0, swagger_1.ApiParam)({ name: 'courseId', type: 'string', description: 'Course ID' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'Admin course progress.' }),
    (0, common_1.Get)('admin/courses/:courseId'),
    (0, roles_decorator_1.Roles)(roles_enum_1.Role.Admin),
    __param(0, (0, common_1.Param)('courseId', common_1.ParseUUIDPipe)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], ProgressController.prototype, "getCourseProgressAdmin", null);
__decorate([
    (0, swagger_1.ApiOperation)({ summary: 'Get learning analytics' }),
    (0, swagger_1.ApiParam)({ name: 'courseId', type: 'string', description: 'Course ID' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'Learning analytics.' }),
    (0, common_1.Get)('courses/:courseId/analytics'),
    __param(0, (0, common_1.Request)()),
    __param(1, (0, common_1.Param)('courseId', common_1.ParseUUIDPipe)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", Promise)
], ProgressController.prototype, "getLearningAnalytics", null);
__decorate([
    (0, swagger_1.ApiOperation)({ summary: 'Get adaptive next lessons' }),
    (0, swagger_1.ApiParam)({ name: 'courseId', type: 'string', description: 'Course ID' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'Adaptive next lessons.' }),
    (0, common_1.Get)('courses/:courseId/adaptive-next'),
    __param(0, (0, common_1.Request)()),
    __param(1, (0, common_1.Param)('courseId', common_1.ParseUUIDPipe)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", Promise)
], ProgressController.prototype, "getAdaptiveNextLessons", null);
__decorate([
    (0, swagger_1.ApiOperation)({ summary: 'Get progress visualization' }),
    (0, swagger_1.ApiParam)({ name: 'courseId', type: 'string', description: 'Course ID' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'Progress visualization.' }),
    (0, common_1.Get)('courses/:courseId/visualization'),
    __param(0, (0, common_1.Request)()),
    __param(1, (0, common_1.Param)('courseId', common_1.ParseUUIDPipe)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", Promise)
], ProgressController.prototype, "getProgressVisualization", null);
__decorate([
    (0, swagger_1.ApiOperation)({ summary: 'Get learning outcome metrics' }),
    (0, swagger_1.ApiParam)({ name: 'courseId', type: 'string', description: 'Course ID' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'Learning outcome metrics.' }),
    (0, common_1.Get)('courses/:courseId/outcomes'),
    __param(0, (0, common_1.Request)()),
    __param(1, (0, common_1.Param)('courseId', common_1.ParseUUIDPipe)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", Promise)
], ProgressController.prototype, "getLearningOutcomeMetrics", null);
exports.ProgressController = ProgressController = __decorate([
    (0, swagger_1.ApiTags)('Progress'),
    (0, swagger_1.ApiBearerAuth)(),
    (0, common_1.Controller)('progress'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard, roles_guard_1.RolesGuard),
    __metadata("design:paramtypes", [typeof (_a = typeof progress_service_1.ProgressService !== "undefined" && progress_service_1.ProgressService) === "function" ? _a : Object])
], ProgressController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxnLWVrb2hcXERlc2t0b3BcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFx1c2Vyc1xcY29udHJvbGxlcnNcXHByb2dyZXNzLmNvbnRyb2xsZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztHQUVHO0FBQ0gsMkNBV3dCO0FBQ3hCLG1FQUErRDtBQUMvRCxxRUFBZ0U7QUFDaEUsK0RBQTJEO0FBQzNELDJFQUE4RDtBQUM5RCxxRUFBZ0U7QUFDaEUsb0RBQTJDO0FBQzNDLDZDQUF1RztBQU1oRyxJQUFNLGtCQUFrQixHQUF4QixNQUFNLGtCQUFrQjtJQUM3QixZQUE2QixlQUFnQztRQUFoQyxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7SUFBRyxDQUFDO0lBUTNELEFBQU4sS0FBSyxDQUFDLG9CQUFvQixDQUNiLEdBQUcsRUFDb0IsUUFBZ0IsRUFDaEIsUUFBZ0IsRUFDMUMsaUJBQW9DO1FBRTVDLElBQUksQ0FBQztZQUNILE9BQU8sTUFBTSxJQUFJLENBQUMsZUFBZSxDQUFDLG9CQUFvQixDQUNwRCxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFDWCxRQUFRLEVBQ1IsUUFBUSxFQUNSLGlCQUFpQixDQUFDLGtCQUFrQixFQUNwQyxpQkFBaUIsQ0FBQyxRQUFRLENBQzNCLENBQUM7UUFDSixDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLElBQUksS0FBSyxZQUFZLHNCQUFhLEVBQUUsQ0FBQztnQkFDbkMsTUFBTSxLQUFLLENBQUM7WUFDZCxDQUFDO1lBQ0QsTUFBTSxJQUFJLHNCQUFhLENBQ3JCLGtDQUFrQyxFQUNsQyxtQkFBVSxDQUFDLHFCQUFxQixDQUNqQyxDQUFDO1FBQ0osQ0FBQztJQUNILENBQUM7SUFNSyxBQUFOLEtBQUssQ0FBQyxpQkFBaUIsQ0FDVixHQUFHLEVBQ29CLFFBQWdCO1FBRWxELElBQUksQ0FBQztZQUNILE9BQU8sTUFBTSxJQUFJLENBQUMsZUFBZSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxJ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RUFBRSxXQUFXLEVBQUUsV0FBVyxFQUFFLENBQUM7SUFDeEUsSUFBQSxxQkFBVyxFQUFDLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsMkJBQTJCLEVBQUUsQ0FBQztJQUN0RSxJQUFBLFlBQUcsRUFBQyw0QkFBNEIsQ0FBQztJQUUvQixXQUFBLElBQUEsZ0JBQU8sR0FBRSxDQUFBO0lBQ1QsV0FBQSxJQUFBLGNBQUssRUFBQyxVQUFVLEVBQUUsc0JBQWEsQ0FBQyxDQUFBOzs7O21FQU9sQzs2QkE1S1Usa0JBQWtCO0lBSjlCLElBQUEsaUJBQU8sRUFBQyxVQUFVLENBQUM7SUFDbkIsSUFBQSx1QkFBYSxHQUFFO0lBQ2YsSUFBQSxtQkFBVSxFQUFDLFVBQVUsQ0FBQztJQUN0QixJQUFBLGtCQUFTLEVBQUMsNkJBQVksRUFBRSx3QkFBVSxDQUFDO3lEQUVZLGtDQUFlLG9CQUFmLGtDQUFlO0dBRGxELGtCQUFrQixDQTZLOUIiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxnLWVrb2hcXERlc2t0b3BcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFx1c2Vyc1xcY29udHJvbGxlcnNcXHByb2dyZXNzLmNvbnRyb2xsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFByb2dyZXNzQ29udHJvbGxlciBoYW5kbGVzIHVzZXIgcHJvZ3Jlc3MgdHJhY2tpbmcgYW5kIGFuYWx5dGljcyBlbmRwb2ludHMuXHJcbiAqL1xyXG5pbXBvcnQge1xyXG4gIENvbnRyb2xsZXIsXHJcbiAgUG9zdCxcclxuICBHZXQsXHJcbiAgQm9keSxcclxuICBQYXJhbSxcclxuICBVc2VHdWFyZHMsXHJcbiAgUmVxdWVzdCxcclxuICBQYXJzZVVVSURQaXBlLFxyXG4gIEh0dHBTdGF0dXMsXHJcbiAgSHR0cEV4Y2VwdGlvbixcclxufSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XHJcbmltcG9ydCB7IFByb2dyZXNzU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3Byb2dyZXNzLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBKd3RBdXRoR3VhcmQgfSBmcm9tICcuLi8uLi9hdXRoL2d1YXJkcy9qd3QtYXV0aC5ndWFyZCc7XHJcbmltcG9ydCB7IFJvbGVzR3VhcmQgfSBmcm9tICcuLi8uLi9hdXRoL2d1YXJkcy9yb2xlcy5ndWFyZCc7XHJcbmltcG9ydCB7IFJvbGVzIH0gZnJvbSAnLi4vLi4vYXV0aC9kZWNvcmF0b3JzL3JvbGVzLmRlY29yYXRvcic7XHJcbmltcG9ydCB7IFVwZGF0ZVByb2dyZXNzRHRvIH0gZnJvbSAnLi4vZHRvcy91cGRhdGUtcHJvZ3Jlc3MuZHRvJztcclxuaW1wb3J0IHsgUm9sZSB9IGZyb20gJ3NyYy9yb2xlL3JvbGVzLmVudW0nO1xyXG5pbXBvcnQgeyBBcGlUYWdzLCBBcGlCZWFyZXJBdXRoLCBBcGlPcGVyYXRpb24sIEFwaVJlc3BvbnNlLCBBcGlQYXJhbSwgQXBpQm9keSB9IGZyb20gJ0BuZXN0anMvc3dhZ2dlcic7XHJcblxyXG5AQXBpVGFncygnUHJvZ3Jlc3MnKVxyXG5AQXBpQmVhcmVyQXV0aCgpXHJcbkBDb250cm9sbGVyKCdwcm9ncmVzcycpXHJcbkBVc2VHdWFyZHMoSnd0QXV0aEd1YXJkLCBSb2xlc0d1YXJkKVxyXG5leHBvcnQgY2xhc3MgUHJvZ3Jlc3NDb250cm9sbGVyIHtcclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IHByb2dyZXNzU2VydmljZTogUHJvZ3Jlc3NTZXJ2aWNlKSB7fVxyXG5cclxuICBAQXBpT3BlcmF0aW9uKHsgc3VtbWFyeTogJ1VwZGF0ZSBsZXNzb24gcHJvZ3Jlc3MnIH0pXHJcbiAgQEFwaVBhcmFtKHsgbmFtZTogJ2NvdXJzZUlkJywgdHlwZTogJ3N0cmluZycsIGRlc2NyaXB0aW9uOiAnQ291cnNlIElEJyB9KVxyXG4gIEBBcGlQYXJhbSh7IG5hbWU6ICdsZXNzb25JZCcsIHR5cGU6ICdzdHJpbmcnLCBkZXNjcmlwdGlvbjogJ0xlc3NvbiBJRCcgfSlcclxuICBAQXBpQm9keSh7IHR5cGU6IFVwZGF0ZVByb2dyZXNzRHRvIH0pXHJcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiAyMDAsIGRlc2NyaXB0aW9uOiAnTGVzc29uIHByb2dyZXNzIHVwZGF0ZWQuJyB9KVxyXG4gIEBQb3N0KCdjb3Vyc2VzLzpjb3Vyc2VJZC9sZXNzb25zLzpsZXNzb25JZCcpXHJcbiAgYXN5bmMgdXBkYXRlTGVzc29uUHJvZ3Jlc3MoXHJcbiAgICBAUmVxdWVzdCgpIHJlcSxcclxuICAgIEBQYXJhbSgnY291cnNlSWQnLCBQYXJzZVVVSURQaXBlKSBjb3Vyc2VJZDogc3RyaW5nLFxyXG4gICAgQFBhcmFtKCdsZXNzb25JZCcsIFBhcnNlVVVJRFBpcGUpIGxlc3NvbklkOiBzdHJpbmcsXHJcbiAgICBAQm9keSgpIHVwZGF0ZVByb2dyZXNzRHRvOiBVcGRhdGVQcm9ncmVzc0R0byxcclxuICApIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnByb2dyZXNzU2VydmljZS51cGRhdGVMZXNzb25Qcm9ncmVzcyhcclxuICAgICAgICByZXEudXNlci5pZCxcclxuICAgICAgICBjb3Vyc2VJZCxcclxuICAgICAgICBsZXNzb25JZCxcclxuICAgICAgICB1cGRhdGVQcm9ncmVzc0R0by5wcm9ncmVzc1BlcmNlbnRhZ2UsXHJcbiAgICAgICAgdXBkYXRlUHJvZ3Jlc3NEdG8ubWV0YWRhdGEsXHJcbiAgICAgICk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBIdHRwRXhjZXB0aW9uKSB7XHJcbiAgICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICAgIH1cclxuICAgICAgdGhyb3cgbmV3IEh0dHBFeGNlcHRpb24oXHJcbiAgICAgICAgJ0ZhaWxlZCB0byB1cGRhdGUgbGVzc29uIHByb2dyZXNzJyxcclxuICAgICAgICBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUixcclxuICAgICAgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIEBBcGlPcGVyYXRpb24oeyBzdW1tYXJ5OiAnR2V0IGNvdXJzZSBwcm9ncmVzcycgfSlcclxuICBAQXBpUGFyYW0oeyBuYW1lOiAnY291cnNlSWQnLCB0eXBlOiAnc3RyaW5nJywgZGVzY3JpcHRpb246ICdDb3Vyc2UgSUQnIH0pXHJcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiAyMDAsIGRlc2NyaXB0aW9uOiAnQ291cnNlIHByb2dyZXNzLicgfSlcclxuICBAR2V0KCdjb3Vyc2VzLzpjb3Vyc2VJZCcpXHJcbiAgYXN5bmMgZ2V0Q291cnNlUHJvZ3Jlc3MoXHJcbiAgICBAUmVxdWVzdCgpIHJlcSxcclxuICAgIEBQYXJhbSgnY291cnNlSWQnLCBQYXJzZVVVSURQaXBlKSBjb3Vyc2VJZDogc3RyaW5nLFxyXG4gICkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMucHJvZ3Jlc3NTZXJ2aWNlLmdldENvdXJzZVByb2dyZXNzKHJlcS51c2VyLmlkLCBjb3Vyc2VJZCk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBIdHRwRXhjZXB0aW9uKSB7XHJcbiAgICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICAgIH1cclxuICAgICAgdGhyb3cgbmV3IEh0dHBFeGNlcHRpb24oXHJcbiAgICAgICAgJ0ZhaWxlZCB0byByZXRyaWV2ZSBjb3Vyc2UgcHJvZ3Jlc3MnLFxyXG4gICAgICAgIEh0dHBTdGF0dXMuSU5URVJOQUxfU0VSVkVSX0VSUk9SLFxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgQEFwaU9wZXJhdGlvbih7IHN1bW1hcnk6ICdHZXQgdXNlciBwcm9ncmVzcycgfSlcclxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDIwMCwgZGVzY3JpcHRpb246ICdVc2VyIHByb2dyZXNzLicgfSlcclxuICBAR2V0KCd1c2VyJylcclxuICBhc3luYyBnZXRVc2VyUHJvZ3Jlc3MoQFJlcXVlc3QoKSByZXEpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnByb2dyZXNzU2VydmljZS5nZXRVc2VyUHJvZ3Jlc3MocmVxLnVzZXIuaWQpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhyb3cgbmV3IEh0dHBFeGNlcHRpb24oXHJcbiAgICAgICAgJ0ZhaWxlZCB0byByZXRyaWV2ZSB1c2VyIHByb2dyZXNzJyxcclxuICAgICAgICBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUixcclxuICAgICAgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIEBBcGlPcGVyYXRpb24oeyBzdW1tYXJ5OiAnU3luYyBjb3Vyc2UgcHJvZ3Jlc3MnIH0pXHJcbiAgQEFwaVBhcmFtKHsgbmFtZTogJ2NvdXJzZUlkJywgdHlwZTogJ3N0cmluZycsIGRlc2NyaXB0aW9uOiAnQ291cnNlIElEJyB9KVxyXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogMjAwLCBkZXNjcmlwdGlvbjogJ1Byb2dyZXNzIHN5bmNocm9uaXplZC4nIH0pXHJcbiAgQFBvc3QoJ2NvdXJzZXMvOmNvdXJzZUlkL3N5bmMnKVxyXG4gIGFzeW5jIHN5bmNQcm9ncmVzcyhcclxuICAgIEBSZXF1ZXN0KCkgcmVxLFxyXG4gICAgQFBhcmFtKCdjb3Vyc2VJZCcsIFBhcnNlVVVJRFBpcGUpIGNvdXJzZUlkOiBzdHJpbmcsXHJcbiAgKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBhd2FpdCB0aGlzLnByb2dyZXNzU2VydmljZS5zeW5jUHJvZ3Jlc3MocmVxLnVzZXIuaWQsIGNvdXJzZUlkKTtcclxuICAgICAgcmV0dXJuIHsgbWVzc2FnZTogJ1Byb2dyZXNzIHN5bmNocm9uaXplZCBzdWNjZXNzZnVsbHknIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBIdHRwRXhjZXB0aW9uKSB7XHJcbiAgICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICAgIH1cclxuICAgICAgdGhyb3cgbmV3IEh0dHBFeGNlcHRpb24oXHJcbiAgICAgICAgJ0ZhaWxlZCB0byBzeW5jaHJvbml6ZSBwcm9ncmVzcycsXHJcbiAgICAgICAgSHR0cFN0YXR1cy5JTlRFUk5BTF9TRVJWRVJfRVJST1IsXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBAQXBpT3BlcmF0aW9uKHsgc3VtbWFyeTogJ0dldCBjb3Vyc2UgcHJvZ3Jlc3MgKGFkbWluKScgfSlcclxuICBAQXBpUGFyYW0oeyBuYW1lOiAnY291cnNlSWQnLCB0eXBlOiAnc3RyaW5nJywgZGVzY3JpcHRpb246ICdDb3Vyc2UgSUQnIH0pXHJcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiAyMDAsIGRlc2NyaXB0aW9uOiAnQWRtaW4gY291cnNlIHByb2dyZXNzLicgfSlcclxuICBAR2V0KCdhZG1pbi9jb3Vyc2VzLzpjb3Vyc2VJZCcpXHJcbiAgQFJvbGVzKFJvbGUuQWRtaW4pXHJcbiAgYXN5bmMgZ2V0Q291cnNlUHJvZ3Jlc3NBZG1pbihcclxuICAgIEBQYXJhbSgnY291cnNlSWQnLCBQYXJzZVVVSURQaXBlKSBjb3Vyc2VJZDogc3RyaW5nLFxyXG4gICkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gRm9yIGFkbWluLCB5b3UgbWF5IHdhbnQgdG8gcGFzcyBhIHNwZWNpYWwgdXNlcklkIG9yIG51bGwgaWYgeW91ciBzZXJ2aWNlIHN1cHBvcnRzIGl0LCBvciBmZXRjaCBhbGwgdXNlcnMnIHByb2dyZXNzIGZvciB0aGUgY291cnNlLlxyXG4gICAgICAvLyBIZXJlLCB3ZSdsbCBwYXNzIG51bGwgYXMgdXNlcklkLCBidXQgeW91IG1heSBuZWVkIHRvIGFkanVzdCB0aGUgc2VydmljZSBsb2dpYyBpZiBpdCBkb2Vzbid0IGhhbmRsZSBudWxsLlxyXG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5wcm9ncmVzc1NlcnZpY2UuZ2V0Q291cnNlUHJvZ3Jlc3MobnVsbCwgY291cnNlSWQpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgSHR0cEV4Y2VwdGlvbikge1xyXG4gICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgICB9XHJcbiAgICAgIHRocm93IG5ldyBIdHRwRXhjZXB0aW9uKFxyXG4gICAgICAgICdGYWlsZWQgdG8gcmV0cmlldmUgYWRtaW4gY291cnNlIHByb2dyZXNzJyxcclxuICAgICAgICBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUixcclxuICAgICAgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIEBBcGlPcGVyYXRpb24oeyBzdW1tYXJ5OiAnR2V0IGxlYXJuaW5nIGFuYWx5dGljcycgfSlcclxuICBAQXBpUGFyYW0oeyBuYW1lOiAnY291cnNlSWQnLCB0eXBlOiAnc3RyaW5nJywgZGVzY3JpcHRpb246ICdDb3Vyc2UgSUQnIH0pXHJcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiAyMDAsIGRlc2NyaXB0aW9uOiAnTGVhcm5pbmcgYW5hbHl0aWNzLicgfSlcclxuICBAR2V0KCdjb3Vyc2VzLzpjb3Vyc2VJZC9hbmFseXRpY3MnKVxyXG4gIGFzeW5jIGdldExlYXJuaW5nQW5hbHl0aWNzKFxyXG4gICAgQFJlcXVlc3QoKSByZXEsXHJcbiAgICBAUGFyYW0oJ2NvdXJzZUlkJywgUGFyc2VVVUlEUGlwZSkgY291cnNlSWQ6IHN0cmluZyxcclxuICApIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnByb2dyZXNzU2VydmljZS5nZXRMZWFybmluZ0FuYWx5dGljcyhyZXEudXNlci5pZCwgY291cnNlSWQpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhyb3cgbmV3IEh0dHBFeGNlcHRpb24oJ0ZhaWxlZCB0byByZXRyaWV2ZSBhbmFseXRpY3MnLCBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBAQXBpT3BlcmF0aW9uKHsgc3VtbWFyeTogJ0dldCBhZGFwdGl2ZSBuZXh0IGxlc3NvbnMnIH0pXHJcbiAgQEFwaVBhcmFtKHsgbmFtZTogJ2NvdXJzZUlkJywgdHlwZTogJ3N0cmluZycsIGRlc2NyaXB0aW9uOiAnQ291cnNlIElEJyB9KVxyXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogMjAwLCBkZXNjcmlwdGlvbjogJ0FkYXB0aXZlIG5leHQgbGVzc29ucy4nIH0pXHJcbiAgQEdldCgnY291cnNlcy86Y291cnNlSWQvYWRhcHRpdmUtbmV4dCcpXHJcbiAgYXN5bmMgZ2V0QWRhcHRpdmVOZXh0TGVzc29ucyhcclxuICAgIEBSZXF1ZXN0KCkgcmVxLFxyXG4gICAgQFBhcmFtKCdjb3Vyc2VJZCcsIFBhcnNlVVVJRFBpcGUpIGNvdXJzZUlkOiBzdHJpbmcsXHJcbiAgKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5wcm9ncmVzc1NlcnZpY2UuZ2V0QWRhcHRpdmVOZXh0TGVzc29ucyhyZXEudXNlci5pZCwgY291cnNlSWQpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhyb3cgbmV3IEh0dHBFeGNlcHRpb24oJ0ZhaWxlZCB0byByZXRyaWV2ZSBhZGFwdGl2ZSBuZXh0IGxlc3NvbnMnLCBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBAQXBpT3BlcmF0aW9uKHsgc3VtbWFyeTogJ0dldCBwcm9ncmVzcyB2aXN1YWxpemF0aW9uJyB9KVxyXG4gIEBBcGlQYXJhbSh7IG5hbWU6ICdjb3Vyc2VJZCcsIHR5cGU6ICdzdHJpbmcnLCBkZXNjcmlwdGlvbjogJ0NvdXJzZSBJRCcgfSlcclxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDIwMCwgZGVzY3JpcHRpb246ICdQcm9ncmVzcyB2aXN1YWxpemF0aW9uLicgfSlcclxuICBAR2V0KCdjb3Vyc2VzLzpjb3Vyc2VJZC92aXN1YWxpemF0aW9uJylcclxuICBhc3luYyBnZXRQcm9ncmVzc1Zpc3VhbGl6YXRpb24oXHJcbiAgICBAUmVxdWVzdCgpIHJlcSxcclxuICAgIEBQYXJhbSgnY291cnNlSWQnLCBQYXJzZVVVSURQaXBlKSBjb3Vyc2VJZDogc3RyaW5nLFxyXG4gICkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMucHJvZ3Jlc3NTZXJ2aWNlLmdldFByb2dyZXNzVmlzdWFsaXphdGlvbihyZXEudXNlci5pZCwgY291cnNlSWQpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhyb3cgbmV3IEh0dHBFeGNlcHRpb24oJ0ZhaWxlZCB0byByZXRyaWV2ZSBwcm9ncmVzcyB2aXN1YWxpemF0aW9uJywgSHR0cFN0YXR1cy5JTlRFUk5BTF9TRVJWRVJfRVJST1IpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgQEFwaU9wZXJhdGlvbih7IHN1bW1hcnk6ICdHZXQgbGVhcm5pbmcgb3V0Y29tZSBtZXRyaWNzJyB9KVxyXG4gIEBBcGlQYXJhbSh7IG5hbWU6ICdjb3Vyc2VJZCcsIHR5cGU6ICdzdHJpbmcnLCBkZXNjcmlwdGlvbjogJ0NvdXJzZSBJRCcgfSlcclxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDIwMCwgZGVzY3JpcHRpb246ICdMZWFybmluZyBvdXRjb21lIG1ldHJpY3MuJyB9KVxyXG4gIEBHZXQoJ2NvdXJzZXMvOmNvdXJzZUlkL291dGNvbWVzJylcclxuICBhc3luYyBnZXRMZWFybmluZ091dGNvbWVNZXRyaWNzKFxyXG4gICAgQFJlcXVlc3QoKSByZXEsXHJcbiAgICBAUGFyYW0oJ2NvdXJzZUlkJywgUGFyc2VVVUlEUGlwZSkgY291cnNlSWQ6IHN0cmluZyxcclxuICApIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnByb2dyZXNzU2VydmljZS5nZXRMZWFybmluZ091dGNvbWVNZXRyaWNzKHJlcS51c2VyLmlkLCBjb3Vyc2VJZCk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aHJvdyBuZXcgSHR0cEV4Y2VwdGlvbignRmFpbGVkIHRvIHJldHJpZXZlIGxlYXJuaW5nIG91dGNvbWUgbWV0cmljcycsIEh0dHBTdGF0dXMuSU5URVJOQUxfU0VSVkVSX0VSUk9SKTtcclxuICAgIH1cclxuICB9XHJcbn0iXSwidmVyc2lvbiI6M30=