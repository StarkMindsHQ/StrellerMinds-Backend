{"file":"C:\\Users\\g-ekoh\\Desktop\\StrellerMinds-Backend\\src\\app.module.ts","mappings":"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","names":[],"sources":["C:\\Users\\g-ekoh\\Desktop\\StrellerMinds-Backend\\src\\app.module.ts"],"sourcesContent":["// import { I18nModule } from './i18n/i18n.module';\r\nimport { Module, NestModule, MiddlewareConsumer } from '@nestjs/common';\r\nimport { ConfigModule, ConfigService } from '@nestjs/config';\r\nimport { TypeOrmModule } from '@nestjs/typeorm';\r\nimport { UsersModule } from './users/users.module';\r\nimport { CoursesModule } from './courses/courses.module';\r\nimport { AuthModule } from './auth/auth.module';\r\nimport { CertificateModule } from './certificate/certificate.module';\r\nimport { FilesModule } from './files/files.module';\r\nimport { EmailModule } from './email/email.module';\r\nimport { LessonModule } from './lesson/lesson.module';\r\nimport { IpfsModule } from './ipfs/ipfs.module';\r\nimport { ModerationModule } from './moderation/moderation.module';\r\nimport { SubmissionModule } from './submission/submission.module';\r\nimport { UserProfilesModule } from './user-profiles/user-profiles.module';\r\nimport { CredentialModule } from './credential/credential.module';\r\nimport { TranslationModule } from './translation/translation.module';\r\nimport { AppController } from './app.controller';\r\nimport { AppService } from './app.service';\r\n// import { FeedbackModule } from './feedback/feedback.module';\r\nimport { MentorshipModule } from './mentorship/mentorship.module';\r\nimport { ArchiveModule } from './archive/archive.module';\r\nimport databaseConfig from './config/database.config';\r\nimport { ScheduleModule } from '@nestjs/schedule';\r\nimport { GdprModule } from './gdpr/gdpr.module';\r\nimport { MonitoringModule } from './monitoring/monitoring-module';\r\nimport { CoursesAdvancesModule } from './courses-advances/courses-advances.module';\r\nimport { APP_INTERCEPTOR, APP_GUARD } from '@nestjs/core';\r\nimport { ThrottlerModule } from '@nestjs/throttler';\r\nimport { CustomThrottlerGuard } from './common/guards/custom-throttler.guard';\r\nimport { ApiUsageLoggerMiddleware } from './common/middleware/api-usage-logger.middleware';\r\nimport { DeprecationWarningMiddleware } from './common/middleware/deprecation-warning.middleware';\r\nimport { VersionTrackingInterceptor } from './common/interceptors/version-tracking.interceptor';\r\nimport { VersionAnalyticsService } from './common/services/version-analytics.service';\r\nimport { PerformanceInterceptor } from './monitoring/performance.interceptor';\r\nimport { ApiUsageLog } from './common/entities/api-usage-log.entity';\r\nimport { AuthControllerV1 } from './modules/auth/controllers/auth.controller.v1';\r\nimport { AuthControllerV2 } from './modules/auth/controllers/auth.controller.v2';\r\n// import { CoursesControllerV1 } from './modules/courses/controllers/courses.controller.v1';\r\n// import { CoursesControllerV2 } from './modules/courses/controllers/courses.controller.v2';\r\nimport { VersionController } from './modules/version/version.controller';\r\nimport { apiVersionConfig } from './config/api-version.config';\r\nimport { VersionHeaderMiddleware } from './common/middleware/version-header.middleware';\r\nimport { PaymentModule } from './payment/payment.module';\r\nimport { CmsModule } from './cms/cms.module';\r\nimport { StellarService } from './blockchain/stellar/stellar.service';\r\n\r\n\r\nconst ENV = process.env.NODE_ENV;;\r\nconsole.log('NODE_ENV:', process.env.NODE_ENV);\r\nconsole.log('ENV:', ENV);\r\n\r\nconst SKIP_DB = process.env.SKIP_DB === 'true';\r\n\r\n// Choose DB module based on environment: use in-memory sqlite when SKIP_DB=true to avoid external DB connection during CI/spec generation\r\nconst dbModule = SKIP_DB\r\n  ? TypeOrmModule.forRoot({\r\n      type: 'sqlite',\r\n      database: ':memory:',\r\n      autoLoadEntities: true,\r\n      synchronize: false,\r\n    })\r\n  : TypeOrmModule.forRootAsync({\r\n      imports: [ConfigModule],\r\n      inject: [ConfigService],\r\n      useFactory: async (configService: ConfigService) => ({\r\n        type: 'postgres',\r\n        host: configService.get<string>('database.host'),\r\n        port: configService.get<number>('database.port'),\r\n        username: configService.get<string>('database.user'),\r\n        password: configService.get<string>('database.password'),\r\n        database: configService.get<string>('database.name'),\r\n        autoLoadEntities: configService.get<boolean>('database.autoload'),\r\n        synchronize: configService.get<boolean>('database.synchronize'),\r\n        // Connection Pool Settings\r\n        extra: {\r\n          max: configService.get<number>('database.maxPoolSize'),\r\n          min: configService.get<number>('database.minPoolSize'),\r\n          idleTimeoutMillis: configService.get<number>(\r\n            'database.poolIdleTimeout',\r\n          ),\r\n        },\r\n        // Retry Mechanism\r\n        retryAttempts: configService.get<number>('database.retryAttempts'),\r\n        retryDelay: configService.get<number>('database.retryDelay'),\r\n      }),\r\n    });\r\n\r\n@Module({\r\n  imports: [\r\n    ThrottlerModule.forRoot([\r\n      {\r\n        ttl: 60, // 60 seconds\r\n        limit: 100,\r\n      },\r\n    ]),\r\n    // Global Config\r\n    ScheduleModule.forRoot(),\r\n    ConfigModule.forRoot({\r\n      isGlobal: true,\r\n      envFilePath: !ENV ? '.env' : `.env.${ENV.trim()}`,\r\n      load: [databaseConfig, () => ({ api: apiVersionConfig })],\r\n    }),\r\n\r\n    // Database\r\n    dbModule,\r\n    UsersModule,\r\n    CoursesModule,\r\n    AuthModule,\r\n    CertificateModule,\r\n    FilesModule,\r\n    EmailModule,\r\n    LessonModule,\r\n    IpfsModule,\r\n    ModerationModule,\r\n    SubmissionModule,\r\n    UserProfilesModule,\r\n    CredentialModule,\r\n    ArchiveModule,\r\n    // FeedbackModule,\r\n    // I18nModule,\r\n    MentorshipModule,\r\n    TranslationModule,\r\n    GdprModule,\r\n    MonitoringModule,\r\n    UsersModule,\r\n    CoursesAdvancesModule,\r\n    AuthControllerV1,\r\n    AuthControllerV2,\r\n    // CoursesControllerV1,\r\n    // CoursesControllerV2,\r\n    VersionController,\r\n    CmsModule,\r\n    PaymentModule,\r\n  ],\r\n  controllers: [AppController],\r\n  providers: [\r\n    AppService,\r\n    VersionAnalyticsService,\r\n    {\r\n      provide: APP_INTERCEPTOR,\r\n      useClass: VersionTrackingInterceptor,\r\n    },\r\n    {\r\n      provide: APP_INTERCEPTOR,\r\n      useClass: PerformanceInterceptor,\r\n    },\r\n    {\r\n      provide: APP_GUARD,\r\n      useClass: CustomThrottlerGuard,\r\n    },\r\n    StellarService,\r\n  ],\r\n})\r\nexport class AppModule implements NestModule {\r\n  configure(consumer: MiddlewareConsumer) {\r\n    consumer\r\n      .apply(\r\n        VersionHeaderMiddleware,\r\n        DeprecationWarningMiddleware,\r\n        ApiUsageLoggerMiddleware,\r\n      )\r\n      .forRoutes('*');\r\n  }\r\n}\r\n"],"version":3}