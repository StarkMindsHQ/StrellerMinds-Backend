b8bebe827fcff159741d40a2d172db94
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var MLPersonalizationService_1;
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", { value: true });
exports.MLPersonalizationService = void 0;
const common_1 = require("@nestjs/common");
const typeorm_1 = require("@nestjs/typeorm");
const typeorm_2 = require("typeorm");
const user_interaction_entity_1 = require("../entities/user-interaction.entity");
const user_entity_1 = require("../../users/entities/user.entity");
const course_entity_1 = require("../../courses/entities/course.entity");
const recommendation_entity_1 = require("../entities/recommendation.entity");
let MLPersonalizationService = MLPersonalizationService_1 = class MLPersonalizationService {
    constructor(interactionRepository, userRepository, courseRepository) {
        this.interactionRepository = interactionRepository;
        this.userRepository = userRepository;
        this.courseRepository = courseRepository;
        this.logger = new common_1.Logger(MLPersonalizationService_1.name);
        this.model = null;
        this.EMBEDDING_SIZE = 64;
        this.SKILL_VECTOR_SIZE = 50;
        this.PREFERENCE_VECTOR_SIZE = 30;
        this.initializeModel();
    }
    /**
     * Generate personalized recommendations using ML models
     */
    async generatePersonalizedRecommendations(context, options) {
        try {
            this.logger.log(`Generating ML-based recommendations for user ${context.userId}`);
            // Extract features for the user
            const userFeatures = await this.extractUserFeatures(context);
            // Get candidate courses
            const candidateCourses = await this.getCandidateCourses(context, options.limit * 3);
            // Score each candidate course
            const scoredRecommendations = [];
            for (const course of candidateCourses) {
                const contentFeatures = await this.extractContentFeatures(course);
                const combinedFeatures = this.combineFeatures(userFeatures, contentFeatures, context);
                const score = await this.predictScore(combinedFeatures);
                if (score >= options.minConfidence) {
                    scoredRecommendations.push({
                        course,
                        score,
                        features: combinedFeatures,
                    });
                }
            }
            // Sort by score and take top recommendations
            scoredRecommendations.sort((a, b) => b.score - a.score);
            const topRecommendations = scoredRecommendations.slice(0, options.limit);
            // Convert to recommendation format
            return topRecommendations.map(({ course, score, features }) => ({
                userId: context.userId,
                courseId: course.id,
                recommendationType: recommendation_entity_1.RecommendationType.CONTENT_BASED,
                reason: this.determineRecommendationReason(features, context),
                confidenceScore: score,
                relevanceScore: score * 0.9, // Slight adjustment for relevance
                priority: this.calculateMLPriority(score, features),
                explanation: this.generateExplanation(course, features, score),
                metadata: {
                    algorithmUsed: 'ml_personalization',
                    modelVersion: this.model?.version || 'v1.0',
                    features: {
                        userEmbedding: features.userEmbedding.slice(0, 5), // Store first 5 dimensions
                        contentEmbedding: features.contentEmbedding.slice(0, 5),
                        topSkills: this.getTopSkillsFromVector(features.skillVector),
                        topPreferences: this.getTopPreferencesFromVector(features.preferenceVector),
                    },
                    mlScore: score,
                },
                mlFeatures: {
                    userEmbedding: features.userEmbedding,
                    contentEmbedding: features.contentEmbedding,
                    interactionHistory: features.interactionHistory,
                    skillVector: features.skillVector,
                    preferenceVector: features.preferenceVector,
                },
            }));
        }
        catch (error) {
            this.logger.error('Error generating ML recommendations:', error);
            return [];
        }
    }
    /**
     * Update model with user feedback
     */
    async updateModelWithFeedback(userId, recommendationId, score) {
        try {
            // Store feedback for batch training
            await this.storeFeedbackForTraining(userId, recommendationId, score);
            // If we have enough feedback, trigger model retraining
            const feedbackCount = await this.getFeedbackCount();
            if (feedbackCount % 1000 === 0) { // Retrain every 1000 feedback points
                await this.retrainModel();
            }
        }
        catch (error) {
            this.logger.error('Error updating model with feedback:', error);
        }
    }
    /**
     * Extract user features for ML model
     */
    async extractUserFeatures(context) {
        const { userId, userProfile, recentInteractions } = context;
        // User embedding based on interaction history
        const userEmbedding = await this.generateUserEmbedding(userId, recentInteractions || []);
        // Skill vector based on user's current skills
        const skillVector = this.generateSkillVector(userProfile?.skills || []);
        // Preference vector based on user preferences and behavior
        const preferenceVector = await this.generatePreferenceVector(userId, recentInteractions || []);
        // Interaction history features
        const interactionHistory = this.generateInteractionHistoryFeatures(recentInteractions || []);
        // Contextual features
        const contextualFeatures = this.generateContextualFeatures(context);
        return {
            userEmbedding,
            contentEmbedding: [], // Will be filled when combining with content
            interactionHistory,
            skillVector,
            preferenceVector,
            contextualFeatures,
        };
    }
    /**
     * Extract content features for courses
     */
    async extractContentFeatures(course) {
        // Content embedding based on course metadata
        const contentEmbedding = this.generateContentEmbedding(course);
        // Skill vector for course requirements/outcomes
        const skillVector = this.generateSkillVector(course.skills || []);
        return {
            contentEmbedding,
            skillVector,
            interactionHistory: {},
            userEmbedding: [],
            preferenceVector: [],
            contextualFeatures: {},
        };
    }
    /**
     * Combine user and content features
     */
    combineFeatures(userFeatures, contentFeatures, context) {
        return {
            userEmbedding: userFeatures.userEmbedding,
            contentEmbedding: contentFeatures.contentEmbedding || [],
            interactionHistory: userFeatures.interactionHistory,
            skillVector: this.combineSkillVectors(userFeatures.skillVector, contentFeatures.skillVector || []),
            preferenceVector: userFeatures.preferenceVector,
            contextualFeatures: {
                ...userFeatures.contextualFeatures,
                skillAlignment: this.calculateSkillAlignment(userFeatures.skillVector, contentFeatures.skillVector || []),
                contentPopularity: Math.random(), // Placeholder for actual popularity score
                userExperience: this.calculateUserExperience(context),
            },
        };
    }
    /**
     * Predict score using ML model
     */
    async predictScore(features) {
        if (!this.model) {
            // Fallback to simple heuristic if model not available
            return this.calculateHeuristicScore(features);
        }
        try {
            // Convert features to input vector
            const inputVector = this.featuresToVector(features);
            // Apply model weights and biases
            let score = 0;
            for (let i = 0; i < inputVector.length; i++) {
                for (let j = 0; j < this.model.weights[i].length; j++) {
                    score += inputVector[i] * this.model.weights[i][j];
                }
            }
            // Add bias and apply sigmoid activation
            score += this.model.biases[0];
            score = 1 / (1 + Math.exp(-score));
            return Math.max(0, Math.min(1, score));
        }
        catch (error) {
            this.logger.error('Error in ML prediction:', error);
            return this.calculateHeuristicScore(features);
        }
    }
    /**
     * Generate user embedding from interaction history
     */
    async generateUserEmbedding(userId, interactions) {
        const embedding = new Array(this.EMBEDDING_SIZE).fill(0);
        // Simple approach: aggregate interaction patterns
        const interactionCounts = new Map();
        const courseCounts = new Map();
        interactions.forEach(interaction => {
            interactionCounts.set(interaction.interactionType, (interactionCounts.get(interaction.interactionType) || 0) + 1);
            if (interaction.courseId) {
                courseCounts.set(interaction.courseId, (courseCounts.get(interaction.courseId) || 0) + 1);
            }
        });
        // Encode interaction patterns into embedding
        let idx = 0;
        for (const [type, count] of interactionCounts.entries()) {
            if (idx < this.EMBEDDING_SIZE) {
                embedding[idx] = Math.log(count + 1) / 10; // Normalize
                idx++;
            }
        }
        // Add randomness for diversity (in real implementation, this would be learned)
        for (let i = idx; i < this.EMBEDDING_SIZE; i++) {
            embedding[i] = (Math.random() - 0.5) * 0.1;
        }
        return embedding;
    }
    /**
     * Generate content embedding for courses
     */
    generateContentEmbedding(course) {
        const embedding = new Array(this.EMBEDDING_SIZE).fill(0);
        // Encode course properties
        embedding[0] = course.difficulty === 'beginner' ? 0.2 : course.difficulty === 'intermediate' ? 0.5 : 0.8;
        embedding[1] = Math.log((course.duration || 60) + 1) / 10;
        embedding[2] = (course.rating || 0) / 5;
        embedding[3] = course.isPaid ? 1 : 0;
        // Encode tags/categories (simplified)
        const tags = course.tags || [];
        for (let i = 0; i < Math.min(tags.length, 10); i++) {
            embedding[4 + i] = this.hashStringToFloat(tags[i]);
        }
        // Fill remaining with course-specific features
        for (let i = 14; i < this.EMBEDDING_SIZE; i++) {
            embedding[i] = (Math.random() - 0.5) * 0.1;
        }
        return embedding;
    }
    /**
     * Generate skill vector
     */
    generateSkillVector(skills) {
        const vector = new Array(this.SKILL_VECTOR_SIZE).fill(0);
        // Map skills to vector positions (simplified)
        skills.forEach(skill => {
            const index = this.hashStringToIndex(skill, this.SKILL_VECTOR_SIZE);
            vector[index] = Math.min(vector[index] + 0.2, 1.0);
        });
        return vector;
    }
    /**
     * Generate preference vector from user behavior
     */
    async generatePreferenceVector(userId, interactions) {
        const vector = new Array(this.PREFERENCE_VECTOR_SIZE).fill(0);
        // Analyze interaction patterns to infer preferences
        const preferences = new Map();
        interactions.forEach(interaction => {
            const weight = interaction.weightedValue;
            const course = interaction.course;
            if (course?.tags) {
                course.tags.forEach(tag => {
                    preferences.set(tag, (preferences.get(tag) || 0) + weight);
                });
            }
        });
        // Convert preferences to vector
        let idx = 0;
        for (const [preference, score] of preferences.entries()) {
            if (idx < this.PREFERENCE_VECTOR_SIZE) {
                vector[idx] = Math.tanh(score / 10); // Normalize
                idx++;
            }
        }
        return vector;
    }
    /**
     * Generate interaction history features
     */
    generateInteractionHistoryFeatures(interactions) {
        const features = {};
        // Count interactions by type
        Object.values(user_interaction_entity_1.InteractionType).forEach(type => {
            features[`${type}_count`] = interactions.filter(i => i.interactionType === type).length;
        });
        // Time-based features
        const now = new Date();
        features.recent_activity = interactions.filter(i => (now.getTime() - i.createdAt.getTime()) < 7 * 24 * 60 * 60 * 1000).length;
        features.total_interactions = interactions.length;
        features.avg_session_length = this.calculateAverageSessionLength(interactions);
        features.completion_rate = this.calculateCompletionRate(interactions);
        return features;
    }
    /**
     * Generate contextual features
     */
    generateContextualFeatures(context) {
        const features = {};
        features.time_of_day = new Date().getHours() / 24;
        features.day_of_week = new Date().getDay() / 7;
        features.is_mobile = context.deviceType === 'mobile' ? 1 : 0;
        features.session_length = Math.random(); // Placeholder
        return features;
    }
    /**
     * Get candidate courses for recommendation
     */
    async getCandidateCourses(context, limit) {
        // Get courses user hasn't interacted with recently
        const recentCourseIds = context.recentInteractions
            ?.filter(i => i.courseId)
            .map(i => i.courseId) || [];
        const queryBuilder = this.courseRepository.createQueryBuilder('course')
            .where('course.isActive = :isActive', { isActive: true });
        if (recentCourseIds.length > 0) {
            queryBuilder.andWhere('course.id NOT IN (:...recentCourseIds)', { recentCourseIds });
        }
        return queryBuilder
            .orderBy('RANDOM()')
            .take(limit)
            .getMany();
    }
    /**
     * Initialize ML model
     */
    initializeModel() {
        // In a real implementation, this would load a trained model
        // For now, we'll use a simple placeholder model
        this.model = {
            version: 'v1.0',
            weights: Array(100).fill(0).map(() => Array(10).fill(0).map(() => Math.random() - 0.5)),
            biases: Array(10).fill(0).map(() => Math.random() - 0.5),
            featureNames: ['user_embedding', 'content_embedding', 'skill_alignment', 'preference_match'],
            lastTrained: new Date(),
        };
    }
    /**
     * Convert features to input vector for ML model
     */
    featuresToVector(features) {
        const vector = [];
        // Add user embedding (first 10 dimensions)
        vector.push(...features.userEmbedding.slice(0, 10));
        // Add content embedding (first 10 dimensions)
        vector.push(...features.contentEmbedding.slice(0, 10));
        // Add skill vector (first 10 dimensions)
        vector.push(...features.skillVector.slice(0, 10));
        // Add preference vector (first 10 dimensions)
        vector.push(...features.preferenceVector.slice(0, 10));
        // Add contextual features
        const contextValues = Object.values(features.contextualFeatures);
        vector.push(...contextValues.slice(0, 10));
        // Pad to fixed size
        while (vector.length < 50) {
            vector.push(0);
        }
        return vector.slice(0, 50);
    }
    /**
     * Calculate heuristic score as fallback
     */
    calculateHeuristicScore(features) {
        let score = 0.5; // Base score
        // Skill alignment boost
        const skillAlignment = features.contextualFeatures.skillAlignment || 0;
        score += skillAlignment * 0.3;
        // User experience factor
        const userExperience = features.contextualFeatures.userExperience || 0.5;
        score += (userExperience - 0.5) * 0.2;
        // Content popularity
        const popularity = features.contextualFeatures.contentPopularity || 0.5;
        score += popularity * 0.1;
        return Math.max(0, Math.min(1, score));
    }
    /**
     * Utility functions
     */
    hashStringToFloat(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            const char = str.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash; // Convert to 32-bit integer
        }
        return Math.abs(hash) / 2147483647; // Normalize to [0, 1]
    }
    hashStringToIndex(str, maxIndex) {
        return Math.floor(this.hashStringToFloat(str) * maxIndex);
    }
    combineSkillVectors(userSkills, contentSkills) {
        const combined = new Array(Math.max(userSkills.length, contentSkills.length)).fill(0);
        for (let i = 0; i < combined.length; i++) {
            const userVal = userSkills[i] || 0;
            const contentVal = contentSkills[i] || 0;
            combined[i] = (userVal + contentVal) / 2;
        }
        return combined;
    }
    calculateSkillAlignment(userSkills, contentSkills) {
        if (userSkills.length === 0 || contentSkills.length === 0)
            return 0;
        let dotProduct = 0;
        let userNorm = 0;
        let contentNorm = 0;
        const minLength = Math.min(userSkills.length, contentSkills.length);
        for (let i = 0; i < minLength; i++) {
            dotProduct += userSkills[i] * contentSkills[i];
            userNorm += userSkills[i] * userSkills[i];
            contentNorm += contentSkills[i] * contentSkills[i];
        }
        if (userNorm === 0 || contentNorm === 0)
            return 0;
        return dotProduct / (Math.sqrt(userNorm) * Math.sqrt(contentNorm));
    }
    calculateUserExperience(context) {
        const interactions = context.recentInteractions || [];
        if (interactions.length === 0)
            return 0.1; // New user
        const completions = interactions.filter(i => i.interactionType === user_interaction_entity_1.InteractionType.COMPLETE).length;
        const enrollments = interactions.filter(i => i.interactionType === user_interaction_entity_1.InteractionType.ENROLL).length;
        if (enrollments === 0)
            return 0.3;
        const completionRate = completions / enrollments;
        return Math.min(0.9, 0.3 + completionRate * 0.6);
    }
    calculateAverageSessionLength(interactions) {
        const sessions = new Map();
        interactions.forEach(interaction => {
            const sessionId = interaction.sessionId || 'default';
            if (!sessions.has(sessionId)) {
                sessions.set(sessionId, []);
            }
            sessions.get(sessionId).push(interaction);
        });
        let totalLength = 0;
        let sessionCount = 0;
        for (const sessionInteractions of sessions.values()) {
            if (sessionInteractions.length > 1) {
                const start = Math.min(...sessionInteractions.map(i => i.createdAt.getTime()));
                const end = Math.max(...sessionInteractions.map(i => i.createdAt.getTime()));
                totalLength += (end - start) / 1000 / 60; // Convert to minutes
                sessionCount++;
            }
        }
        return sessionCount > 0 ? totalLength / sessionCount : 5; // Default 5 minutes
    }
    calculateCompletionRate(interactions) {
        const enrollments = interactions.filter(i => i.interactionType === user_interaction_entity_1.InteractionType.ENROLL).length;
        const completions = interactions.filter(i => i.interactionType === user_interaction_entity_1.InteractionType.COMPLETE).length;
        return enrollments > 0 ? completions / enrollments : 0;
    }
    determineRecommendationReason(features, context) {
        const skillAlignment = features.contextualFeatures.skillAlignment || 0;
        if (skillAlignment > 0.7) {
            return recommendation_entity_1.RecommendationReason.SKILL_GAP;
        }
        else if (context.recentInteractions?.length && context.recentInteractions.length > 10) {
            return recommendation_entity_1.RecommendationReason.LEARNING_HISTORY;
        }
        else {
            return recommendation_entity_1.RecommendationReason.INTEREST_BASED;
        }
    }
    calculateMLPriority(score, features) {
        let priority = Math.floor(score * 5); // Base priority from score
        // Boost for high skill alignment
        if ((features.contextualFeatures.skillAlignment || 0) > 0.8) {
            priority += 2;
        }
        return Math.min(priority, 10);
    }
    generateExplanation(course, features, score) {
        const skillAlignment = features.contextualFeatures.skillAlignment || 0;
        if (skillAlignment > 0.7) {
            return `This course aligns well with your skill development goals`;
        }
        else if (score > 0.8) {
            return `Highly recommended based on your learning patterns`;
        }
        else {
            return `Recommended based on your interests and activity`;
        }
    }
    getTopSkillsFromVector(skillVector) {
        // This would map vector indices back to skill names in a real implementation
        return ['JavaScript', 'React', 'Node.js'].slice(0, 3);
    }
    getTopPreferencesFromVector(preferenceVector) {
        // This would map vector indices back to preference names in a real implementation
        return ['Web Development', 'Frontend', 'Backend'].slice(0, 3);
    }
    async storeFeedbackForTraining(userId, recommendationId, score) {
        // Store feedback in a training data table (implementation would depend on your setup)
        this.logger.log(`Storing feedback: user=${userId}, rec=${recommendationId}, score=${score}`);
    }
    async getFeedbackCount() {
        // Return count of feedback records for retraining decision
        return Math.floor(Math.random() * 2000); // Placeholder
    }
    async retrainModel() {
        this.logger.log('Triggering model retraining...');
        // In a real implementation, this would trigger an ML pipeline
        // For now, just update the model timestamp
        if (this.model) {
            this.model.lastTrained = new Date();
        }
    }
};
exports.MLPersonalizationService = MLPersonalizationService;
exports.MLPersonalizationService = MLPersonalizationService = MLPersonalizationService_1 = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(user_interaction_entity_1.UserInteraction)),
    __param(1, (0, typeorm_1.InjectRepository)(user_entity_1.User)),
    __param(2, (0, typeorm_1.InjectRepository)(course_entity_1.Course)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object, typeof (_c = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _c : Object])
], MLPersonalizationService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxnLWVrb2hcXERlc2t0b3BcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFxyZWNvbW1lbmRhdGlvblxcc2VydmljZXNcXG1sLXBlcnNvbmFsaXphdGlvbi5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBQW9EO0FBQ3BELDZDQUFtRDtBQUNuRCxxQ0FBcUM7QUFDckMsaUZBQXVGO0FBQ3ZGLGtFQUF3RDtBQUN4RCx3RUFBOEQ7QUFDOUQsNkVBQTZHO0FBcUJ0RyxJQUFNLHdCQUF3QixnQ0FBOUIsTUFBTSx3QkFBd0I7SUFPbkMsWUFFRSxxQkFBMEQsRUFFMUQsY0FBd0MsRUFFeEMsZ0JBQTRDO1FBSnBDLDBCQUFxQixHQUFyQixxQkFBcUIsQ0FBNkI7UUFFbEQsbUJBQWMsR0FBZCxjQUFjLENBQWtCO1FBRWhDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBb0I7UUFaN0IsV0FBTSxHQUFHLElBQUksZUFBTSxDQUFDLDBCQUF3QixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzVELFVBQUssR0FBZ0MsSUFBSSxDQUFDO1FBQ2pDLG1CQUFjLEdBQUcsRUFBRSxDQUFDO1FBQ3BCLHNCQUFpQixHQUFHLEVBQUUsQ0FBQztRQUN2QiwyQkFBc0IsR0FBRyxFQUFFLENBQUM7UUFVM0MsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO0lBQ3pCLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxtQ0FBbUMsQ0FDdkMsT0FBOEIsRUFDOUIsT0FBaUQ7UUFFakQsSUFBSSxDQUFDO1lBQ0gsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsZ0RBQWdELE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBRWxGLGdDQUFnQztZQUNoQyxNQUFNLFlBQVksR0FBRyxNQUFNLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUU3RCx3QkFBd0I7WUFDeEIsTUFBTSxnQkFBZ0IsR0FBRyxNQUFNLElBQUksQ0FBQyxtQkFB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QUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDaEUsQ0FBQztJQUVPLEtBQUssQ0FBQyx3QkFBd0IsQ0FBQyxNQUFjLEVBQUUsZ0JBQXdCLEVBQUUsS0FBYTtRQUM1RixzRkFBc0Y7UUFDdEYsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsMEJBQTBCLE1BQU0sU0FBUyxnQkFBZ0IsV0FBVyxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBQy9GLENBQUM7SUFFTyxLQUFLLENBQUMsZ0JBQWdCO1FBQzVCLDJEQUEyRDtRQUMzRCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsY0FBYztJQUN6RCxDQUFDO0lBRU8sS0FBSyxDQUFDLFlBQVk7UUFDeEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztRQUNsRCw4REFBOEQ7UUFDOUQsMkNBQTJDO1FBQzNDLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ2YsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUN0QyxDQUFDO0lBQ0gsQ0FBQztDQUNGLENBQUE7QUF6bUJZLDREQUF3QjttQ0FBeEIsd0JBQXdCO0lBRHBDLElBQUEsbUJBQVUsR0FBRTtJQVNSLFdBQUEsSUFBQSwwQkFBZ0IsRUFBQyx5Q0FBZSxDQUFDLENBQUE7SUFFakMsV0FBQSxJQUFBLDBCQUFnQixFQUFDLGtCQUFJLENBQUMsQ0FBQTtJQUV0QixXQUFBLElBQUEsMEJBQWdCLEVBQUMsc0JBQU0sQ0FBQyxDQUFBO3lEQUhNLG9CQUFVLG9CQUFWLG9CQUFVLG9EQUVqQixvQkFBVSxvQkFBVixvQkFBVSxvREFFUixvQkFBVSxvQkFBVixvQkFBVTtHQWIzQix3QkFBd0IsQ0F5bUJwQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGctZWtvaFxcRGVza3RvcFxcU3RyZWxsZXJNaW5kcy1CYWNrZW5kXFxzcmNcXHJlY29tbWVuZGF0aW9uXFxzZXJ2aWNlc1xcbWwtcGVyc29uYWxpemF0aW9uLnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgTG9nZ2VyIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xyXG5pbXBvcnQgeyBJbmplY3RSZXBvc2l0b3J5IH0gZnJvbSAnQG5lc3Rqcy90eXBlb3JtJztcclxuaW1wb3J0IHsgUmVwb3NpdG9yeSB9IGZyb20gJ3R5cGVvcm0nO1xyXG5pbXBvcnQgeyBVc2VySW50ZXJhY3Rpb24sIEludGVyYWN0aW9uVHlwZSB9IGZyb20gJy4uL2VudGl0aWVzL3VzZXItaW50ZXJhY3Rpb24uZW50aXR5JztcclxuaW1wb3J0IHsgVXNlciB9IGZyb20gJy4uLy4uL3VzZXJzL2VudGl0aWVzL3VzZXIuZW50aXR5JztcclxuaW1wb3J0IHsgQ291cnNlIH0gZnJvbSAnLi4vLi4vY291cnNlcy9lbnRpdGllcy9jb3Vyc2UuZW50aXR5JztcclxuaW1wb3J0IHsgUmVjb21tZW5kYXRpb24sIFJlY29tbWVuZGF0aW9uVHlwZSwgUmVjb21tZW5kYXRpb25SZWFzb24gfSBmcm9tICcuLi9lbnRpdGllcy9yZWNvbW1lbmRhdGlvbi5lbnRpdHknO1xyXG5pbXBvcnQgeyBSZWNvbW1lbmRhdGlvbkNvbnRleHQgfSBmcm9tICcuL3JlY29tbWVuZGF0aW9uLWVuZ2luZS5zZXJ2aWNlJztcclxuXHJcbmludGVyZmFjZSBNTEZlYXR1cmVzIHtcclxuICB1c2VyRW1iZWRkaW5nOiBudW1iZXJbXTtcclxuICBjb250ZW50RW1iZWRkaW5nOiBudW1iZXJbXTtcclxuICBpbnRlcmFjdGlvbkhpc3Rvcnk6IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XHJcbiAgc2tpbGxWZWN0b3I6IG51bWJlcltdO1xyXG4gIHByZWZlcmVuY2VWZWN0b3I6IG51bWJlcltdO1xyXG4gIGNvbnRleHR1YWxGZWF0dXJlczogUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcclxufVxyXG5cclxuaW50ZXJmYWNlIFBlcnNvbmFsaXphdGlvbk1vZGVsIHtcclxuICB2ZXJzaW9uOiBzdHJpbmc7XHJcbiAgd2VpZ2h0czogbnVtYmVyW11bXTtcclxuICBiaWFzZXM6IG51bWJlcltdO1xyXG4gIGZlYXR1cmVOYW1lczogc3RyaW5nW107XHJcbiAgbGFzdFRyYWluZWQ6IERhdGU7XHJcbn1cclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIE1MUGVyc29uYWxpemF0aW9uU2VydmljZSB7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXIgPSBuZXcgTG9nZ2VyKE1MUGVyc29uYWxpemF0aW9uU2VydmljZS5uYW1lKTtcclxuICBwcml2YXRlIG1vZGVsOiBQZXJzb25hbGl6YXRpb25Nb2RlbCB8IG51bGwgPSBudWxsO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgRU1CRURESU5HX1NJWkUgPSA2NDtcclxuICBwcml2YXRlIHJlYWRvbmx5IFNLSUxMX1ZFQ1RPUl9TSVpFID0gNTA7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBQUkVGRVJFTkNFX1ZFQ1RPUl9TSVpFID0gMzA7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgQEluamVjdFJlcG9zaXRvcnkoVXNlckludGVyYWN0aW9uKVxyXG4gICAgcHJpdmF0ZSBpbnRlcmFjdGlvblJlcG9zaXRvcnk6IFJlcG9zaXRvcnk8VXNlckludGVyYWN0aW9uPixcclxuICAgIEBJbmplY3RSZXBvc2l0b3J5KFVzZXIpXHJcbiAgICBwcml2YXRlIHVzZXJSZXBvc2l0b3J5OiBSZXBvc2l0b3J5PFVzZXI+LFxyXG4gICAgQEluamVjdFJlcG9zaXRvcnkoQ291cnNlKVxyXG4gICAgcHJpdmF0ZSBjb3Vyc2VSZXBvc2l0b3J5OiBSZXBvc2l0b3J5PENvdXJzZT4sXHJcbiAgKSB7XHJcbiAgICB0aGlzLmluaXRpYWxpemVNb2RlbCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2VuZXJhdGUgcGVyc29uYWxpemVkIHJlY29tbWVuZGF0aW9ucyB1c2luZyBNTCBtb2RlbHNcclxuICAgKi9cclxuICBhc3luYyBnZW5lcmF0ZVBlcnNvbmFsaXplZFJlY29tbWVuZGF0aW9ucyhcclxuICAgIGNvbnRleHQ6IFJlY29tbWVuZGF0aW9uQ29udGV4dCxcclxuICAgIG9wdGlvbnM6IHsgbGltaXQ6IG51bWJlcjsgbWluQ29uZmlkZW5jZTogbnVtYmVyIH0sXHJcbiAgKTogUHJvbWlzZTxQYXJ0aWFsPFJlY29tbWVuZGF0aW9uPltdPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICB0aGlzLmxvZ2dlci5sb2coYEdlbmVyYXRpbmcgTUwtYmFzZWQgcmVjb21tZW5kYXRpb25zIGZvciB1c2VyICR7Y29udGV4dC51c2VySWR9YCk7XHJcblxyXG4gICAgICAvLyBFeHRyYWN0IGZlYXR1cmVzIGZvciB0aGUgdXNlclxyXG4gICAgICBjb25zdCB1c2VyRmVhdHVyZXMgPSBhd2FpdCB0aGlzLmV4dHJhY3RVc2VyRmVhdHVyZXMoY29udGV4dCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBHZXQgY2FuZGlkYXRlIGNvdXJzZXNcclxuICAgICAgY29uc3QgY2FuZGlkYXRlQ291cnNlcyA9IGF3YWl0IHRoaXMuZ2V0Q2FuZGlkYXRlQ291cnNlcyhjb250ZXh0LCBvcHRpb25zLmxpbWl0ICogMyk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBTY29yZSBlYWNoIGNhbmRpZGF0ZSBjb3Vyc2VcclxuICAgICAgY29uc3Qgc2NvcmVkUmVjb21tZW5kYXRpb25zOiBBcnJheTx7XHJcbiAgICAgICAgY291cnNlOiBDb3Vyc2U7XHJcbiAgICAgICAgc2NvcmU6IG51bWJlcjtcclxuICAgICAgICBmZWF0dXJlczogTUxGZWF0dXJlcztcclxuICAgICAgfT4gPSBbXTtcclxuXHJcbiAgICAgIGZvciAoY29uc3QgY291cnNlIG9mIGNhbmRpZGF0ZUNvdXJzZXMpIHtcclxuICAgICAgICBjb25zdCBjb250ZW50RmVhdHVyZXMgPSBhd2FpdCB0aGlzLmV4dHJhY3RDb250ZW50RmVhdHVyZXMoY291cnNlKTtcclxuICAgICAgICBjb25zdCBjb21iaW5lZEZlYXR1cmVzID0gdGhpcy5jb21iaW5lRmVhdHVyZXModXNlckZlYXR1cmVzLCBjb250ZW50RmVhdHVyZXMsIGNvbnRleHQpO1xyXG4gICAgICAgIGNvbnN0IHNjb3JlID0gYXdhaXQgdGhpcy5wcmVkaWN0U2NvcmUoY29tYmluZWRGZWF0dXJlcyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKHNjb3JlID49IG9wdGlvbnMubWluQ29uZmlkZW5jZSkge1xyXG4gICAgICAgICAgc2NvcmVkUmVjb21tZW5kYXRpb25zLnB1c2goe1xyXG4gICAgICAgICAgICBjb3Vyc2UsXHJcbiAgICAgICAgICAgIHNjb3JlLFxyXG4gICAgICAgICAgICBmZWF0dXJlczogY29tYmluZWRGZWF0dXJlcyxcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gU29ydCBieSBzY29yZSBhbmQgdGFrZSB0b3AgcmVjb21tZW5kYXRpb25zXHJcbiAgICAgIHNjb3JlZFJlY29tbWVuZGF0aW9ucy5zb3J0KChhLCBiKSA9PiBiLnNjb3JlIC0gYS5zY29yZSk7XHJcbiAgICAgIGNvbnN0IHRvcFJlY29tbWVuZGF0aW9ucyA9IHNjb3JlZFJlY29tbWVuZGF0aW9ucy5zbGljZSgwLCBvcHRpb25zLmxpbWl0KTtcclxuXHJcbiAgICAgIC8vIENvbnZlcnQgdG8gcmVjb21tZW5kYXRpb24gZm9ybWF0XHJcbiAgICAgIHJldHVybiB0b3BSZWNvbW1lbmRhdGlvbnMubWFwKCh7IGNvdXJzZSwgc2NvcmUsIGZlYXR1cmVzIH0pID0+ICh7XHJcbiAgICAgICAgdXNlcklkOiBjb250ZXh0LnVzZXJJZCxcclxuICAgICAgICBjb3Vyc2VJZDogY291cnNlLmlkLFxyXG4gICAgICAgIHJlY29tbWVuZGF0aW9uVHlwZTogUmVjb21tZW5kYXRpb25UeXBlLkNPTlRFTlRfQkFTRUQsXHJcbiAgICAgICAgcmVhc29uOiB0aGlzLmRldGVybWluZVJlY29tbWVuZGF0aW9uUmVhc29uKGZlYXR1cmVzLCBjb250ZXh0KSxcclxuICAgICAgICBjb25maWRlbmNlU2NvcmU6IHNjb3JlLFxyXG4gICAgICAgIHJlbGV2YW5jZVNjb3JlOiBzY29yZSAqIDAuOSwgLy8gU2xpZ2h0IGFkanVzdG1lbnQgZm9yIHJlbGV2YW5jZVxyXG4gICAgICAgIHByaW9yaXR5OiB0aGlzLmNhbGN1bGF0ZU1MUHJpb3JpdHkoc2NvcmUsIGZlYXR1cmVzKSxcclxuICAgICAgICBleHBsYW5hdGlvbjogdGhpcy5nZW5lcmF0ZUV4cGxhbmF0aW9uKGNvdXJzZSwgZmVhdHVyZXMsIHNjb3JlKSxcclxuICAgICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgICAgYWxnb3JpdGhtVXNlZDogJ21sX3BlcnNvbmFsaXphdGlvbicsXHJcbiAgICAgICAgICBtb2RlbFZlcnNpb246IHRoaXMubW9kZWw/LnZlcnNpb24gfHwgJ3YxLjAnLFxyXG4gICAgICAgICAgZmVhdHVyZXM6IHtcclxuICAgICAgICAgICAgdXNlckVtYmVkZGluZzogZmVhdHVyZXMudXNlckVtYmVkZGluZy5zbGljZSgwLCA1KSwgLy8gU3RvcmUgZmlyc3QgNSBkaW1lbnNpb25zXHJcbiAgICAgICAgICAgIGNvbnRlbnRFbWJlZGRpbmc6IGZlYXR1cmVzLmNvbnRlbnRFbWJlZGRpbmcuc2xpY2UoMCwgNSksXHJcbiAgICAgICAgICAgIHRvcFNraWxsczogdGhpcy5nZXRUb3BTa2lsbHNGcm9tVmVjdG9yKGZlYXR1cmVzLnNraWxsVmVjdG9yKSxcclxuICAgICAgICAgICAgdG9wUHJlZmVyZW5jZXM6IHRoaXMuZ2V0VG9wUHJlZmVyZW5jZXNGcm9tVmVjdG9yKGZlYXR1cmVzLnByZWZlcmVuY2VWZWN0b3IpLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIG1sU2NvcmU6IHNjb3JlLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbWxGZWF0dXJlczoge1xyXG4gICAgICAgICAgdXNlckVtYmVkZGluZzogZmVhdHVyZXMudXNlckVtYmVkZGluZyxcclxuICAgICAgICAgIGNvbnRlbnRFbWJlZGRpbmc6IGZlYXR1cmVzLmNvbnRlbnRFbWJlZGRpbmcsXHJcbiAgICAgICAgICBpbnRlcmFjdGlvbkhpc3Rvcnk6IGZlYXR1cmVzLmludGVyYWN0aW9uSGlzdG9yeSxcclxuICAgICAgICAgIHNraWxsVmVjdG9yOiBmZWF0dXJlcy5za2lsbFZlY3RvcixcclxuICAgICAgICAgIHByZWZlcmVuY2VWZWN0b3I6IGZlYXR1cmVzLnByZWZlcmVuY2VWZWN0b3IsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSkpO1xyXG5cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdFcnJvciBnZW5lcmF0aW5nIE1MIHJlY29tbWVuZGF0aW9uczonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZSBtb2RlbCB3aXRoIHVzZXIgZmVlZGJhY2tcclxuICAgKi9cclxuICBhc3luYyB1cGRhdGVNb2RlbFdpdGhGZWVkYmFjayh1c2VySWQ6IHN0cmluZywgcmVjb21tZW5kYXRpb25JZDogc3RyaW5nLCBzY29yZTogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBTdG9yZSBmZWVkYmFjayBmb3IgYmF0Y2ggdHJhaW5pbmdcclxuICAgICAgYXdhaXQgdGhpcy5zdG9yZUZlZWRiYWNrRm9yVHJhaW5pbmcodXNlcklkLCByZWNvbW1lbmRhdGlvbklkLCBzY29yZSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBJZiB3ZSBoYXZlIGVub3VnaCBmZWVkYmFjaywgdHJpZ2dlciBtb2RlbCByZXRyYWluaW5nXHJcbiAgICAgIGNvbnN0IGZlZWRiYWNrQ291bnQgPSBhd2FpdCB0aGlzLmdldEZlZWRiYWNrQ291bnQoKTtcclxuICAgICAgaWYgKGZlZWRiYWNrQ291bnQgJSAxMDAwID09PSAwKSB7IC8vIFJldHJhaW4gZXZlcnkgMTAwMCBmZWVkYmFjayBwb2ludHNcclxuICAgICAgICBhd2FpdCB0aGlzLnJldHJhaW5Nb2RlbCgpO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRXJyb3IgdXBkYXRpbmcgbW9kZWwgd2l0aCBmZWVkYmFjazonLCBlcnJvcik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBFeHRyYWN0IHVzZXIgZmVhdHVyZXMgZm9yIE1MIG1vZGVsXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyBleHRyYWN0VXNlckZlYXR1cmVzKGNvbnRleHQ6IFJlY29tbWVuZGF0aW9uQ29udGV4dCk6IFByb21pc2U8TUxGZWF0dXJlcz4ge1xyXG4gICAgY29uc3QgeyB1c2VySWQsIHVzZXJQcm9maWxlLCByZWNlbnRJbnRlcmFjdGlvbnMgfSA9IGNvbnRleHQ7XHJcblxyXG4gICAgLy8gVXNlciBlbWJlZGRpbmcgYmFzZWQgb24gaW50ZXJhY3Rpb24gaGlzdG9yeVxyXG4gICAgY29uc3QgdXNlckVtYmVkZGluZyA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVVc2VyRW1iZWRkaW5nKHVzZXJJZCwgcmVjZW50SW50ZXJhY3Rpb25zIHx8IFtdKTtcclxuICAgIFxyXG4gICAgLy8gU2tpbGwgdmVjdG9yIGJhc2VkIG9uIHVzZXIncyBjdXJyZW50IHNraWxsc1xyXG4gICAgY29uc3Qgc2tpbGxWZWN0b3IgPSB0aGlzLmdlbmVyYXRlU2tpbGxWZWN0b3IodXNlclByb2ZpbGU/LnNraWxscyB8fCBbXSk7XHJcbiAgICBcclxuICAgIC8vIFByZWZlcmVuY2UgdmVjdG9yIGJhc2VkIG9uIHVzZXIgcHJlZmVyZW5jZXMgYW5kIGJlaGF2aW9yXHJcbiAgICBjb25zdCBwcmVmZXJlbmNlVmVjdG9yID0gYXdhaXQgdGhpcy5nZW5lcmF0ZVByZWZlcmVuY2VWZWN0b3IodXNlcklkLCByZWNlbnRJbnRlcmFjdGlvbnMgfHwgW10pO1xyXG4gICAgXHJcbiAgICAvLyBJbnRlcmFjdGlvbiBoaXN0b3J5IGZlYXR1cmVzXHJcbiAgICBjb25zdCBpbnRlcmFjdGlvbkhpc3RvcnkgPSB0aGlzLmdlbmVyYXRlSW50ZXJhY3Rpb25IaXN0b3J5RmVhdHVyZXMocmVjZW50SW50ZXJhY3Rpb25zIHx8IFtdKTtcclxuICAgIFxyXG4gICAgLy8gQ29udGV4dHVhbCBmZWF0dXJlc1xyXG4gICAgY29uc3QgY29udGV4dHVhbEZlYXR1cmVzID0gdGhpcy5nZW5lcmF0ZUNvbnRleHR1YWxGZWF0dXJlcyhjb250ZXh0KTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB1c2VyRW1iZWRkaW5nLFxyXG4gICAgICBjb250ZW50RW1iZWRkaW5nOiBbXSwgLy8gV2lsbCBiZSBmaWxsZWQgd2hlbiBjb21iaW5pbmcgd2l0aCBjb250ZW50XHJcbiAgICAgIGludGVyYWN0aW9uSGlzdG9yeSxcclxuICAgICAgc2tpbGxWZWN0b3IsXHJcbiAgICAgIHByZWZlcmVuY2VWZWN0b3IsXHJcbiAgICAgIGNvbnRleHR1YWxGZWF0dXJlcyxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBFeHRyYWN0IGNvbnRlbnQgZmVhdHVyZXMgZm9yIGNvdXJzZXNcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIGV4dHJhY3RDb250ZW50RmVhdHVyZXMoY291cnNlOiBDb3Vyc2UpOiBQcm9taXNlPFBhcnRpYWw8TUxGZWF0dXJlcz4+IHtcclxuICAgIC8vIENvbnRlbnQgZW1iZWRkaW5nIGJhc2VkIG9uIGNvdXJzZSBtZXRhZGF0YVxyXG4gICAgY29uc3QgY29udGVudEVtYmVkZGluZyA9IHRoaXMuZ2VuZXJhdGVDb250ZW50RW1iZWRkaW5nKGNvdXJzZSk7XHJcbiAgICBcclxuICAgIC8vIFNraWxsIHZlY3RvciBmb3IgY291cnNlIHJlcXVpcmVtZW50cy9vdXRjb21lc1xyXG4gICAgY29uc3Qgc2tpbGxWZWN0b3IgPSB0aGlzLmdlbmVyYXRlU2tpbGxWZWN0b3IoY291cnNlLnNraWxscyB8fCBbXSk7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgY29udGVudEVtYmVkZGluZyxcclxuICAgICAgc2tpbGxWZWN0b3IsXHJcbiAgICAgIGludGVyYWN0aW9uSGlzdG9yeToge30sXHJcbiAgICAgIHVzZXJFbWJlZGRpbmc6IFtdLFxyXG4gICAgICBwcmVmZXJlbmNlVmVjdG9yOiBbXSxcclxuICAgICAgY29udGV4dHVhbEZlYXR1cmVzOiB7fSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDb21iaW5lIHVzZXIgYW5kIGNvbnRlbnQgZmVhdHVyZXNcclxuICAgKi9cclxuICBwcml2YXRlIGNvbWJpbmVGZWF0dXJlcyhcclxuICAgIHVzZXJGZWF0dXJlczogTUxGZWF0dXJlcyxcclxuICAgIGNvbnRlbnRGZWF0dXJlczogUGFydGlhbDxNTEZlYXR1cmVzPixcclxuICAgIGNvbnRleHQ6IFJlY29tbWVuZGF0aW9uQ29udGV4dCxcclxuICApOiBNTEZlYXR1cmVzIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHVzZXJFbWJlZGRpbmc6IHVzZXJGZWF0dXJlcy51c2VyRW1iZWRkaW5nLFxyXG4gICAgICBjb250ZW50RW1iZWRkaW5nOiBjb250ZW50RmVhdHVyZXMuY29udGVudEVtYmVkZGluZyB8fCBbXSxcclxuICAgICAgaW50ZXJhY3Rpb25IaXN0b3J5OiB1c2VyRmVhdHVyZXMuaW50ZXJhY3Rpb25IaXN0b3J5LFxyXG4gICAgICBza2lsbFZlY3RvcjogdGhpcy5jb21iaW5lU2tpbGxWZWN0b3JzKHVzZXJGZWF0dXJlcy5za2lsbFZlY3RvciwgY29udGVudEZlYXR1cmVzLnNraWxsVmVjdG9yIHx8IFtdKSxcclxuICAgICAgcHJlZmVyZW5jZVZlY3RvcjogdXNlckZlYXR1cmVzLnByZWZlcmVuY2VWZWN0b3IsXHJcbiAgICAgIGNvbnRleHR1YWxGZWF0dXJlczoge1xyXG4gICAgICAgIC4uLnVzZXJGZWF0dXJlcy5jb250ZXh0dWFsRmVhdHVyZXMsXHJcbiAgICAgICAgc2tpbGxBbGlnbm1lbnQ6IHRoaXMuY2FsY3VsYXRlU2tpbGxBbGlnbm1lbnQodXNlckZlYXR1cmVzLnNraWxsVmVjdG9yLCBjb250ZW50RmVhdHVyZXMuc2tpbGxWZWN0b3IgfHwgW10pLFxyXG4gICAgICAgIGNvbnRlbnRQb3B1bGFyaXR5OiBNYXRoLnJhbmRvbSgpLCAvLyBQbGFjZWhvbGRlciBmb3IgYWN0dWFsIHBvcHVsYXJpdHkgc2NvcmVcclxuICAgICAgICB1c2VyRXhwZXJpZW5jZTogdGhpcy5jYWxjdWxhdGVVc2VyRXhwZXJpZW5jZShjb250ZXh0KSxcclxuICAgICAgfSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBQcmVkaWN0IHNjb3JlIHVzaW5nIE1MIG1vZGVsXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyBwcmVkaWN0U2NvcmUoZmVhdHVyZXM6IE1MRmVhdHVyZXMpOiBQcm9taXNlPG51bWJlcj4ge1xyXG4gICAgaWYgKCF0aGlzLm1vZGVsKSB7XHJcbiAgICAgIC8vIEZhbGxiYWNrIHRvIHNpbXBsZSBoZXVyaXN0aWMgaWYgbW9kZWwgbm90IGF2YWlsYWJsZVxyXG4gICAgICByZXR1cm4gdGhpcy5jYWxjdWxhdGVIZXVyaXN0aWNTY29yZShmZWF0dXJlcyk7XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gQ29udmVydCBmZWF0dXJlcyB0byBpbnB1dCB2ZWN0b3JcclxuICAgICAgY29uc3QgaW5wdXRWZWN0b3IgPSB0aGlzLmZlYXR1cmVzVG9WZWN0b3IoZmVhdHVyZXMpO1xyXG4gICAgICBcclxuICAgICAgLy8gQXBwbHkgbW9kZWwgd2VpZ2h0cyBhbmQgYmlhc2VzXHJcbiAgICAgIGxldCBzY29yZSA9IDA7XHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXRWZWN0b3IubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMubW9kZWwud2VpZ2h0c1tpXS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgc2NvcmUgKz0gaW5wdXRWZWN0b3JbaV0gKiB0aGlzLm1vZGVsLndlaWdodHNbaV1bal07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBBZGQgYmlhcyBhbmQgYXBwbHkgc2lnbW9pZCBhY3RpdmF0aW9uXHJcbiAgICAgIHNjb3JlICs9IHRoaXMubW9kZWwuYmlhc2VzWzBdO1xyXG4gICAgICBzY29yZSA9IDEgLyAoMSArIE1hdGguZXhwKC1zY29yZSkpO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIE1hdGgubWF4KDAsIE1hdGgubWluKDEsIHNjb3JlKSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRXJyb3IgaW4gTUwgcHJlZGljdGlvbjonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB0aGlzLmNhbGN1bGF0ZUhldXJpc3RpY1Njb3JlKGZlYXR1cmVzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdlbmVyYXRlIHVzZXIgZW1iZWRkaW5nIGZyb20gaW50ZXJhY3Rpb24gaGlzdG9yeVxyXG4gICAqL1xyXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVVc2VyRW1iZWRkaW5nKHVzZXJJZDogc3RyaW5nLCBpbnRlcmFjdGlvbnM6IFVzZXJJbnRlcmFjdGlvbltdKTogUHJvbWlzZTxudW1iZXJbXT4ge1xyXG4gICAgY29uc3QgZW1iZWRkaW5nID0gbmV3IEFycmF5KHRoaXMuRU1CRURESU5HX1NJWkUpLmZpbGwoMCk7XHJcbiAgICBcclxuICAgIC8vIFNpbXBsZSBhcHByb2FjaDogYWdncmVnYXRlIGludGVyYWN0aW9uIHBhdHRlcm5zXHJcbiAgICBjb25zdCBpbnRlcmFjdGlvbkNvdW50cyA9IG5ldyBNYXA8SW50ZXJhY3Rpb25UeXBlLCBudW1iZXI+KCk7XHJcbiAgICBjb25zdCBjb3Vyc2VDb3VudHMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xyXG4gICAgXHJcbiAgICBpbnRlcmFjdGlvbnMuZm9yRWFjaChpbnRlcmFjdGlvbiA9PiB7XHJcbiAgICAgIGludGVyYWN0aW9uQ291bnRzLnNldChcclxuICAgICAgICBpbnRlcmFjdGlvbi5pbnRlcmFjdGlvblR5cGUsXHJcbiAgICAgICAgKGludGVyYWN0aW9uQ291bnRzLmdldChpbnRlcmFjdGlvbi5pbnRlcmFjdGlvblR5cGUpIHx8IDApICsgMVxyXG4gICAgICApO1xyXG4gICAgICBcclxuICAgICAgaWYgKGludGVyYWN0aW9uLmNvdXJzZUlkKSB7XHJcbiAgICAgICAgY291cnNlQ291bnRzLnNldChcclxuICAgICAgICAgIGludGVyYWN0aW9uLmNvdXJzZUlkLFxyXG4gICAgICAgICAgKGNvdXJzZUNvdW50cy5nZXQoaW50ZXJhY3Rpb24uY291cnNlSWQpIHx8IDApICsgMVxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEVuY29kZSBpbnRlcmFjdGlvbiBwYXR0ZXJucyBpbnRvIGVtYmVkZGluZ1xyXG4gICAgbGV0IGlkeCA9IDA7XHJcbiAgICBmb3IgKGNvbnN0IFt0eXBlLCBjb3VudF0gb2YgaW50ZXJhY3Rpb25Db3VudHMuZW50cmllcygpKSB7XHJcbiAgICAgIGlmIChpZHggPCB0aGlzLkVNQkVERElOR19TSVpFKSB7XHJcbiAgICAgICAgZW1iZWRkaW5nW2lkeF0gPSBNYXRoLmxvZyhjb3VudCArIDEpIC8gMTA7IC8vIE5vcm1hbGl6ZVxyXG4gICAgICAgIGlkeCsrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQWRkIHJhbmRvbW5lc3MgZm9yIGRpdmVyc2l0eSAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiwgdGhpcyB3b3VsZCBiZSBsZWFybmVkKVxyXG4gICAgZm9yIChsZXQgaSA9IGlkeDsgaSA8IHRoaXMuRU1CRURESU5HX1NJWkU7IGkrKykge1xyXG4gICAgICBlbWJlZGRpbmdbaV0gPSAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiAwLjE7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGVtYmVkZGluZztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdlbmVyYXRlIGNvbnRlbnQgZW1iZWRkaW5nIGZvciBjb3Vyc2VzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZW5lcmF0ZUNvbnRlbnRFbWJlZGRpbmcoY291cnNlOiBDb3Vyc2UpOiBudW1iZXJbXSB7XHJcbiAgICBjb25zdCBlbWJlZGRpbmcgPSBuZXcgQXJyYXkodGhpcy5FTUJFRERJTkdfU0laRSkuZmlsbCgwKTtcclxuICAgIFxyXG4gICAgLy8gRW5jb2RlIGNvdXJzZSBwcm9wZXJ0aWVzXHJcbiAgICBlbWJlZGRpbmdbMF0gPSBjb3Vyc2UuZGlmZmljdWx0eSA9PT0gJ2JlZ2lubmVyJyA/IDAuMiA6IGNvdXJzZS5kaWZmaWN1bHR5ID09PSAnaW50ZXJtZWRpYXRlJyA/IDAuNSA6IDAuODtcclxuICAgIGVtYmVkZGluZ1sxXSA9IE1hdGgubG9nKChjb3Vyc2UuZHVyYXRpb24gfHwgNjApICsgMSkgLyAxMDtcclxuICAgIGVtYmVkZGluZ1syXSA9IChjb3Vyc2UucmF0aW5nIHx8IDApIC8gNTtcclxuICAgIGVtYmVkZGluZ1szXSA9IGNvdXJzZS5pc1BhaWQgPyAxIDogMDtcclxuICAgIFxyXG4gICAgLy8gRW5jb2RlIHRhZ3MvY2F0ZWdvcmllcyAoc2ltcGxpZmllZClcclxuICAgIGNvbnN0IHRhZ3MgPSBjb3Vyc2UudGFncyB8fCBbXTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTWF0aC5taW4odGFncy5sZW5ndGgsIDEwKTsgaSsrKSB7XHJcbiAgICAgIGVtYmVkZGluZ1s0ICsgaV0gPSB0aGlzLmhhc2hTdHJpbmdUb0Zsb2F0KHRhZ3NbaV0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEZpbGwgcmVtYWluaW5nIHdpdGggY291cnNlLXNwZWNpZmljIGZlYXR1cmVzXHJcbiAgICBmb3IgKGxldCBpID0gMTQ7IGkgPCB0aGlzLkVNQkVERElOR19TSVpFOyBpKyspIHtcclxuICAgICAgZW1iZWRkaW5nW2ldID0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMC4xO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBlbWJlZGRpbmc7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZW5lcmF0ZSBza2lsbCB2ZWN0b3JcclxuICAgKi9cclxuICBwcml2YXRlIGdlbmVyYXRlU2tpbGxWZWN0b3Ioc2tpbGxzOiBzdHJpbmdbXSk6IG51bWJlcltdIHtcclxuICAgIGNvbnN0IHZlY3RvciA9IG5ldyBBcnJheSh0aGlzLlNLSUxMX1ZFQ1RPUl9TSVpFKS5maWxsKDApO1xyXG4gICAgXHJcbiAgICAvLyBNYXAgc2tpbGxzIHRvIHZlY3RvciBwb3NpdGlvbnMgKHNpbXBsaWZpZWQpXHJcbiAgICBza2lsbHMuZm9yRWFjaChza2lsbCA9PiB7XHJcbiAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5oYXNoU3RyaW5nVG9JbmRleChza2lsbCwgdGhpcy5TS0lMTF9WRUNUT1JfU0laRSk7XHJcbiAgICAgIHZlY3RvcltpbmRleF0gPSBNYXRoLm1pbih2ZWN0b3JbaW5kZXhdICsgMC4yLCAxLjApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHZlY3RvcjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdlbmVyYXRlIHByZWZlcmVuY2UgdmVjdG9yIGZyb20gdXNlciBiZWhhdmlvclxyXG4gICAqL1xyXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVQcmVmZXJlbmNlVmVjdG9yKHVzZXJJZDogc3RyaW5nLCBpbnRlcmFjdGlvbnM6IFVzZXJJbnRlcmFjdGlvbltdKTogUHJvbWlzZTxudW1iZXJbXT4ge1xyXG4gICAgY29uc3QgdmVjdG9yID0gbmV3IEFycmF5KHRoaXMuUFJFRkVSRU5DRV9WRUNUT1JfU0laRSkuZmlsbCgwKTtcclxuICAgIFxyXG4gICAgLy8gQW5hbHl6ZSBpbnRlcmFjdGlvbiBwYXR0ZXJucyB0byBpbmZlciBwcmVmZXJlbmNlc1xyXG4gICAgY29uc3QgcHJlZmVyZW5jZXMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xyXG4gICAgXHJcbiAgICBpbnRlcmFjdGlvbnMuZm9yRWFjaChpbnRlcmFjdGlvbiA9PiB7XHJcbiAgICAgIGNvbnN0IHdlaWdodCA9IGludGVyYWN0aW9uLndlaWdodGVkVmFsdWU7XHJcbiAgICAgIGNvbnN0IGNvdXJzZSA9IGludGVyYWN0aW9uLmNvdXJzZTtcclxuICAgICAgXHJcbiAgICAgIGlmIChjb3Vyc2U/LnRhZ3MpIHtcclxuICAgICAgICBjb3Vyc2UudGFncy5mb3JFYWNoKHRhZyA9PiB7XHJcbiAgICAgICAgICBwcmVmZXJlbmNlcy5zZXQodGFnLCAocHJlZmVyZW5jZXMuZ2V0KHRhZykgfHwgMCkgKyB3ZWlnaHQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBDb252ZXJ0IHByZWZlcmVuY2VzIHRvIHZlY3RvclxyXG4gICAgbGV0IGlkeCA9IDA7XHJcbiAgICBmb3IgKGNvbnN0IFtwcmVmZXJlbmNlLCBzY29yZV0gb2YgcHJlZmVyZW5jZXMuZW50cmllcygpKSB7XHJcbiAgICAgIGlmIChpZHggPCB0aGlzLlBSRUZFUkVOQ0VfVkVDVE9SX1NJWkUpIHtcclxuICAgICAgICB2ZWN0b3JbaWR4XSA9IE1hdGgudGFuaChzY29yZSAvIDEwKTsgLy8gTm9ybWFsaXplXHJcbiAgICAgICAgaWR4Kys7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdmVjdG9yO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2VuZXJhdGUgaW50ZXJhY3Rpb24gaGlzdG9yeSBmZWF0dXJlc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2VuZXJhdGVJbnRlcmFjdGlvbkhpc3RvcnlGZWF0dXJlcyhpbnRlcmFjdGlvbnM6IFVzZXJJbnRlcmFjdGlvbltdKTogUmVjb3JkPHN0cmluZywgbnVtYmVyPiB7XHJcbiAgICBjb25zdCBmZWF0dXJlczogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9O1xyXG4gICAgXHJcbiAgICAvLyBDb3VudCBpbnRlcmFjdGlvbnMgYnkgdHlwZVxyXG4gICAgT2JqZWN0LnZhbHVlcyhJbnRlcmFjdGlvblR5cGUpLmZvckVhY2godHlwZSA9PiB7XHJcbiAgICAgIGZlYXR1cmVzW2Ake3R5cGV9X2NvdW50YF0gPSBpbnRlcmFjdGlvbnMuZmlsdGVyKGkgPT4gaS5pbnRlcmFjdGlvblR5cGUgPT09IHR5cGUpLmxlbmd0aDtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIFRpbWUtYmFzZWQgZmVhdHVyZXNcclxuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XHJcbiAgICBmZWF0dXJlcy5yZWNlbnRfYWN0aXZpdHkgPSBpbnRlcmFjdGlvbnMuZmlsdGVyKGkgPT4gXHJcbiAgICAgIChub3cuZ2V0VGltZSgpIC0gaS5jcmVhdGVkQXQuZ2V0VGltZSgpKSA8IDcgKiAyNCAqIDYwICogNjAgKiAxMDAwXHJcbiAgICApLmxlbmd0aDtcclxuXHJcbiAgICBmZWF0dXJlcy50b3RhbF9pbnRlcmFjdGlvbnMgPSBpbnRlcmFjdGlvbnMubGVuZ3RoO1xyXG4gICAgZmVhdHVyZXMuYXZnX3Nlc3Npb25fbGVuZ3RoID0gdGhpcy5jYWxjdWxhdGVBdmVyYWdlU2Vzc2lvbkxlbmd0aChpbnRlcmFjdGlvbnMpO1xyXG4gICAgZmVhdHVyZXMuY29tcGxldGlvbl9yYXRlID0gdGhpcy5jYWxjdWxhdGVDb21wbGV0aW9uUmF0ZShpbnRlcmFjdGlvbnMpO1xyXG5cclxuICAgIHJldHVybiBmZWF0dXJlcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdlbmVyYXRlIGNvbnRleHR1YWwgZmVhdHVyZXNcclxuICAgKi9cclxuICBwcml2YXRlIGdlbmVyYXRlQ29udGV4dHVhbEZlYXR1cmVzKGNvbnRleHQ6IFJlY29tbWVuZGF0aW9uQ29udGV4dCk6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4ge1xyXG4gICAgY29uc3QgZmVhdHVyZXM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcclxuICAgIFxyXG4gICAgZmVhdHVyZXMudGltZV9vZl9kYXkgPSBuZXcgRGF0ZSgpLmdldEhvdXJzKCkgLyAyNDtcclxuICAgIGZlYXR1cmVzLmRheV9vZl93ZWVrID0gbmV3IERhdGUoKS5nZXREYXkoKSAvIDc7XHJcbiAgICBmZWF0dXJlcy5pc19tb2JpbGUgPSBjb250ZXh0LmRldmljZVR5cGUgPT09ICdtb2JpbGUnID8gMSA6IDA7XHJcbiAgICBmZWF0dXJlcy5zZXNzaW9uX2xlbmd0aCA9IE1hdGgucmFuZG9tKCk7IC8vIFBsYWNlaG9sZGVyXHJcbiAgICBcclxuICAgIHJldHVybiBmZWF0dXJlcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBjYW5kaWRhdGUgY291cnNlcyBmb3IgcmVjb21tZW5kYXRpb25cclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIGdldENhbmRpZGF0ZUNvdXJzZXMoY29udGV4dDogUmVjb21tZW5kYXRpb25Db250ZXh0LCBsaW1pdDogbnVtYmVyKTogUHJvbWlzZTxDb3Vyc2VbXT4ge1xyXG4gICAgLy8gR2V0IGNvdXJzZXMgdXNlciBoYXNuJ3QgaW50ZXJhY3RlZCB3aXRoIHJlY2VudGx5XHJcbiAgICBjb25zdCByZWNlbnRDb3Vyc2VJZHMgPSBjb250ZXh0LnJlY2VudEludGVyYWN0aW9uc1xyXG4gICAgICA/LmZpbHRlcihpID0+IGkuY291cnNlSWQpXHJcbiAgICAgIC5tYXAoaSA9PiBpLmNvdXJzZUlkKSB8fCBbXTtcclxuXHJcbiAgICBjb25zdCBxdWVyeUJ1aWxkZXIgPSB0aGlzLmNvdXJzZVJlcG9zaXRvcnkuY3JlYXRlUXVlcnlCdWlsZGVyKCdjb3Vyc2UnKVxyXG4gICAgICAud2hlcmUoJ2NvdXJzZS5pc0FjdGl2ZSA9IDppc0FjdGl2ZScsIHsgaXNBY3RpdmU6IHRydWUgfSk7XHJcblxyXG4gICAgaWYgKHJlY2VudENvdXJzZUlkcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHF1ZXJ5QnVpbGRlci5hbmRXaGVyZSgnY291cnNlLmlkIE5PVCBJTiAoOi4uLnJlY2VudENvdXJzZUlkcyknLCB7IHJlY2VudENvdXJzZUlkcyB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcXVlcnlCdWlsZGVyXHJcbiAgICAgIC5vcmRlckJ5KCdSQU5ET00oKScpXHJcbiAgICAgIC50YWtlKGxpbWl0KVxyXG4gICAgICAuZ2V0TWFueSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSW5pdGlhbGl6ZSBNTCBtb2RlbFxyXG4gICAqL1xyXG4gIHByaXZhdGUgaW5pdGlhbGl6ZU1vZGVsKCk6IHZvaWQge1xyXG4gICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIGxvYWQgYSB0cmFpbmVkIG1vZGVsXHJcbiAgICAvLyBGb3Igbm93LCB3ZSdsbCB1c2UgYSBzaW1wbGUgcGxhY2Vob2xkZXIgbW9kZWxcclxuICAgIHRoaXMubW9kZWwgPSB7XHJcbiAgICAgIHZlcnNpb246ICd2MS4wJyxcclxuICAgICAgd2VpZ2h0czogQXJyYXkoMTAwKS5maWxsKDApLm1hcCgoKSA9PiBBcnJheSgxMCkuZmlsbCgwKS5tYXAoKCkgPT4gTWF0aC5yYW5kb20oKSAtIDAuNSkpLFxyXG4gICAgICBiaWFzZXM6IEFycmF5KDEwKS5maWxsKDApLm1hcCgoKSA9PiBNYXRoLnJhbmRvbSgpIC0gMC41KSxcclxuICAgICAgZmVhdHVyZU5hbWVzOiBbJ3VzZXJfZW1iZWRkaW5nJywgJ2NvbnRlbnRfZW1iZWRkaW5nJywgJ3NraWxsX2FsaWdubWVudCcsICdwcmVmZXJlbmNlX21hdGNoJ10sXHJcbiAgICAgIGxhc3RUcmFpbmVkOiBuZXcgRGF0ZSgpLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbnZlcnQgZmVhdHVyZXMgdG8gaW5wdXQgdmVjdG9yIGZvciBNTCBtb2RlbFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZmVhdHVyZXNUb1ZlY3RvcihmZWF0dXJlczogTUxGZWF0dXJlcyk6IG51bWJlcltdIHtcclxuICAgIGNvbnN0IHZlY3RvcjogbnVtYmVyW10gPSBbXTtcclxuICAgIFxyXG4gICAgLy8gQWRkIHVzZXIgZW1iZWRkaW5nIChmaXJzdCAxMCBkaW1lbnNpb25zKVxyXG4gICAgdmVjdG9yLnB1c2goLi4uZmVhdHVyZXMudXNlckVtYmVkZGluZy5zbGljZSgwLCAxMCkpO1xyXG4gICAgXHJcbiAgICAvLyBBZGQgY29udGVudCBlbWJlZGRpbmcgKGZpcnN0IDEwIGRpbWVuc2lvbnMpXHJcbiAgICB2ZWN0b3IucHVzaCguLi5mZWF0dXJlcy5jb250ZW50RW1iZWRkaW5nLnNsaWNlKDAsIDEwKSk7XHJcbiAgICBcclxuICAgIC8vIEFkZCBza2lsbCB2ZWN0b3IgKGZpcnN0IDEwIGRpbWVuc2lvbnMpXHJcbiAgICB2ZWN0b3IucHVzaCguLi5mZWF0dXJlcy5za2lsbFZlY3Rvci5zbGljZSgwLCAxMCkpO1xyXG4gICAgXHJcbiAgICAvLyBBZGQgcHJlZmVyZW5jZSB2ZWN0b3IgKGZpcnN0IDEwIGRpbWVuc2lvbnMpXHJcbiAgICB2ZWN0b3IucHVzaCguLi5mZWF0dXJlcy5wcmVmZXJlbmNlVmVjdG9yLnNsaWNlKDAsIDEwKSk7XHJcbiAgICBcclxuICAgIC8vIEFkZCBjb250ZXh0dWFsIGZlYXR1cmVzXHJcbiAgICBjb25zdCBjb250ZXh0VmFsdWVzID0gT2JqZWN0LnZhbHVlcyhmZWF0dXJlcy5jb250ZXh0dWFsRmVhdHVyZXMpO1xyXG4gICAgdmVjdG9yLnB1c2goLi4uY29udGV4dFZhbHVlcy5zbGljZSgwLCAxMCkpO1xyXG4gICAgXHJcbiAgICAvLyBQYWQgdG8gZml4ZWQgc2l6ZVxyXG4gICAgd2hpbGUgKHZlY3Rvci5sZW5ndGggPCA1MCkge1xyXG4gICAgICB2ZWN0b3IucHVzaCgwKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIHZlY3Rvci5zbGljZSgwLCA1MCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDYWxjdWxhdGUgaGV1cmlzdGljIHNjb3JlIGFzIGZhbGxiYWNrXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjYWxjdWxhdGVIZXVyaXN0aWNTY29yZShmZWF0dXJlczogTUxGZWF0dXJlcyk6IG51bWJlciB7XHJcbiAgICBsZXQgc2NvcmUgPSAwLjU7IC8vIEJhc2Ugc2NvcmVcclxuICAgIFxyXG4gICAgLy8gU2tpbGwgYWxpZ25tZW50IGJvb3N0XHJcbiAgICBjb25zdCBza2lsbEFsaWdubWVudCA9IGZlYXR1cmVzLmNvbnRleHR1YWxGZWF0dXJlcy5za2lsbEFsaWdubWVudCB8fCAwO1xyXG4gICAgc2NvcmUgKz0gc2tpbGxBbGlnbm1lbnQgKiAwLjM7XHJcbiAgICBcclxuICAgIC8vIFVzZXIgZXhwZXJpZW5jZSBmYWN0b3JcclxuICAgIGNvbnN0IHVzZXJFeHBlcmllbmNlID0gZmVhdHVyZXMuY29udGV4dHVhbEZlYXR1cmVzLnVzZXJFeHBlcmllbmNlIHx8IDAuNTtcclxuICAgIHNjb3JlICs9ICh1c2VyRXhwZXJpZW5jZSAtIDAuNSkgKiAwLjI7XHJcbiAgICBcclxuICAgIC8vIENvbnRlbnQgcG9wdWxhcml0eVxyXG4gICAgY29uc3QgcG9wdWxhcml0eSA9IGZlYXR1cmVzLmNvbnRleHR1YWxGZWF0dXJlcy5jb250ZW50UG9wdWxhcml0eSB8fCAwLjU7XHJcbiAgICBzY29yZSArPSBwb3B1bGFyaXR5ICogMC4xO1xyXG4gICAgXHJcbiAgICByZXR1cm4gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgc2NvcmUpKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFV0aWxpdHkgZnVuY3Rpb25zXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBoYXNoU3RyaW5nVG9GbG9hdChzdHI6IHN0cmluZyk6IG51bWJlciB7XHJcbiAgICBsZXQgaGFzaCA9IDA7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCBjaGFyID0gc3RyLmNoYXJDb2RlQXQoaSk7XHJcbiAgICAgIGhhc2ggPSAoKGhhc2ggPDwgNSkgLSBoYXNoKSArIGNoYXI7XHJcbiAgICAgIGhhc2ggPSBoYXNoICYgaGFzaDsgLy8gQ29udmVydCB0byAzMi1iaXQgaW50ZWdlclxyXG4gICAgfVxyXG4gICAgcmV0dXJuIE1hdGguYWJzKGhhc2gpIC8gMjE0NzQ4MzY0NzsgLy8gTm9ybWFsaXplIHRvIFswLCAxXVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBoYXNoU3RyaW5nVG9JbmRleChzdHI6IHN0cmluZywgbWF4SW5kZXg6IG51bWJlcik6IG51bWJlciB7XHJcbiAgICByZXR1cm4gTWF0aC5mbG9vcih0aGlzLmhhc2hTdHJpbmdUb0Zsb2F0KHN0cikgKiBtYXhJbmRleCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNvbWJpbmVTa2lsbFZlY3RvcnModXNlclNraWxsczogbnVtYmVyW10sIGNvbnRlbnRTa2lsbHM6IG51bWJlcltdKTogbnVtYmVyW10ge1xyXG4gICAgY29uc3QgY29tYmluZWQgPSBuZXcgQXJyYXkoTWF0aC5tYXgodXNlclNraWxscy5sZW5ndGgsIGNvbnRlbnRTa2lsbHMubGVuZ3RoKSkuZmlsbCgwKTtcclxuICAgIFxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb21iaW5lZC5sZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCB1c2VyVmFsID0gdXNlclNraWxsc1tpXSB8fCAwO1xyXG4gICAgICBjb25zdCBjb250ZW50VmFsID0gY29udGVudFNraWxsc1tpXSB8fCAwO1xyXG4gICAgICBjb21iaW5lZFtpXSA9ICh1c2VyVmFsICsgY29udGVudFZhbCkgLyAyO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gY29tYmluZWQ7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNhbGN1bGF0ZVNraWxsQWxpZ25tZW50KHVzZXJTa2lsbHM6IG51bWJlcltdLCBjb250ZW50U2tpbGxzOiBudW1iZXJbXSk6IG51bWJlciB7XHJcbiAgICBpZiAodXNlclNraWxscy5sZW5ndGggPT09IDAgfHwgY29udGVudFNraWxscy5sZW5ndGggPT09IDApIHJldHVybiAwO1xyXG4gICAgXHJcbiAgICBsZXQgZG90UHJvZHVjdCA9IDA7XHJcbiAgICBsZXQgdXNlck5vcm0gPSAwO1xyXG4gICAgbGV0IGNvbnRlbnROb3JtID0gMDtcclxuICAgIFxyXG4gICAgY29uc3QgbWluTGVuZ3RoID0gTWF0aC5taW4odXNlclNraWxscy5sZW5ndGgsIGNvbnRlbnRTa2lsbHMubGVuZ3RoKTtcclxuICAgIFxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtaW5MZW5ndGg7IGkrKykge1xyXG4gICAgICBkb3RQcm9kdWN0ICs9IHVzZXJTa2lsbHNbaV0gKiBjb250ZW50U2tpbGxzW2ldO1xyXG4gICAgICB1c2VyTm9ybSArPSB1c2VyU2tpbGxzW2ldICogdXNlclNraWxsc1tpXTtcclxuICAgICAgY29udGVudE5vcm0gKz0gY29udGVudFNraWxsc1tpXSAqIGNvbnRlbnRTa2lsbHNbaV07XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlmICh1c2VyTm9ybSA9PT0gMCB8fCBjb250ZW50Tm9ybSA9PT0gMCkgcmV0dXJuIDA7XHJcbiAgICBcclxuICAgIHJldHVybiBkb3RQcm9kdWN0IC8gKE1hdGguc3FydCh1c2VyTm9ybSkgKiBNYXRoLnNxcnQoY29udGVudE5vcm0pKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2FsY3VsYXRlVXNlckV4cGVyaWVuY2UoY29udGV4dDogUmVjb21tZW5kYXRpb25Db250ZXh0KTogbnVtYmVyIHtcclxuICAgIGNvbnN0IGludGVyYWN0aW9ucyA9IGNvbnRleHQucmVjZW50SW50ZXJhY3Rpb25zIHx8IFtdO1xyXG4gICAgaWYgKGludGVyYWN0aW9ucy5sZW5ndGggPT09IDApIHJldHVybiAwLjE7IC8vIE5ldyB1c2VyXHJcbiAgICBcclxuICAgIGNvbnN0IGNvbXBsZXRpb25zID0gaW50ZXJhY3Rpb25zLmZpbHRlcihpID0+IGkuaW50ZXJhY3Rpb25UeXBlID09PSBJbnRlcmFjdGlvblR5cGUuQ09NUExFVEUpLmxlbmd0aDtcclxuICAgIGNvbnN0IGVucm9sbG1lbnRzID0gaW50ZXJhY3Rpb25zLmZpbHRlcihpID0+IGkuaW50ZXJhY3Rpb25UeXBlID09PSBJbnRlcmFjdGlvblR5cGUuRU5ST0xMKS5sZW5ndGg7XHJcbiAgICBcclxuICAgIGlmIChlbnJvbGxtZW50cyA9PT0gMCkgcmV0dXJuIDAuMztcclxuICAgIFxyXG4gICAgY29uc3QgY29tcGxldGlvblJhdGUgPSBjb21wbGV0aW9ucyAvIGVucm9sbG1lbnRzO1xyXG4gICAgcmV0dXJuIE1hdGgubWluKDAuOSwgMC4zICsgY29tcGxldGlvblJhdGUgKiAwLjYpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjYWxjdWxhdGVBdmVyYWdlU2Vzc2lvbkxlbmd0aChpbnRlcmFjdGlvbnM6IFVzZXJJbnRlcmFjdGlvbltdKTogbnVtYmVyIHtcclxuICAgIGNvbnN0IHNlc3Npb25zID0gbmV3IE1hcDxzdHJpbmcsIFVzZXJJbnRlcmFjdGlvbltdPigpO1xyXG4gICAgXHJcbiAgICBpbnRlcmFjdGlvbnMuZm9yRWFjaChpbnRlcmFjdGlvbiA9PiB7XHJcbiAgICAgIGNvbnN0IHNlc3Npb25JZCA9IGludGVyYWN0aW9uLnNlc3Npb25JZCB8fCAnZGVmYXVsdCc7XHJcbiAgICAgIGlmICghc2Vzc2lvbnMuaGFzKHNlc3Npb25JZCkpIHtcclxuICAgICAgICBzZXNzaW9ucy5zZXQoc2Vzc2lvbklkLCBbXSk7XHJcbiAgICAgIH1cclxuICAgICAgc2Vzc2lvbnMuZ2V0KHNlc3Npb25JZCkhLnB1c2goaW50ZXJhY3Rpb24pO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGxldCB0b3RhbExlbmd0aCA9IDA7XHJcbiAgICBsZXQgc2Vzc2lvbkNvdW50ID0gMDtcclxuICAgIFxyXG4gICAgZm9yIChjb25zdCBzZXNzaW9uSW50ZXJhY3Rpb25zIG9mIHNlc3Npb25zLnZhbHVlcygpKSB7XHJcbiAgICAgIGlmIChzZXNzaW9uSW50ZXJhY3Rpb25zLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICBjb25zdCBzdGFydCA9IE1hdGgubWluKC4uLnNlc3Npb25JbnRlcmFjdGlvbnMubWFwKGkgPT4gaS5jcmVhdGVkQXQuZ2V0VGltZSgpKSk7XHJcbiAgICAgICAgY29uc3QgZW5kID0gTWF0aC5tYXgoLi4uc2Vzc2lvbkludGVyYWN0aW9ucy5tYXAoaSA9PiBpLmNyZWF0ZWRBdC5nZXRUaW1lKCkpKTtcclxuICAgICAgICB0b3RhbExlbmd0aCArPSAoZW5kIC0gc3RhcnQpIC8gMTAwMCAvIDYwOyAvLyBDb252ZXJ0IHRvIG1pbnV0ZXNcclxuICAgICAgICBzZXNzaW9uQ291bnQrKztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gc2Vzc2lvbkNvdW50ID4gMCA/IHRvdGFsTGVuZ3RoIC8gc2Vzc2lvbkNvdW50IDogNTsgLy8gRGVmYXVsdCA1IG1pbnV0ZXNcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2FsY3VsYXRlQ29tcGxldGlvblJhdGUoaW50ZXJhY3Rpb25zOiBVc2VySW50ZXJhY3Rpb25bXSk6IG51bWJlciB7XHJcbiAgICBjb25zdCBlbnJvbGxtZW50cyA9IGludGVyYWN0aW9ucy5maWx0ZXIoaSA9PiBpLmludGVyYWN0aW9uVHlwZSA9PT0gSW50ZXJhY3Rpb25UeXBlLkVOUk9MTCkubGVuZ3RoO1xyXG4gICAgY29uc3QgY29tcGxldGlvbnMgPSBpbnRlcmFjdGlvbnMuZmlsdGVyKGkgPT4gaS5pbnRlcmFjdGlvblR5cGUgPT09IEludGVyYWN0aW9uVHlwZS5DT01QTEVURSkubGVuZ3RoO1xyXG4gICAgXHJcbiAgICByZXR1cm4gZW5yb2xsbWVudHMgPiAwID8gY29tcGxldGlvbnMgLyBlbnJvbGxtZW50cyA6IDA7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGRldGVybWluZVJlY29tbWVuZGF0aW9uUmVhc29uKGZlYXR1cmVzOiBNTEZlYXR1cmVzLCBjb250ZXh0OiBSZWNvbW1lbmRhdGlvbkNvbnRleHQpOiBSZWNvbW1lbmRhdGlvblJlYXNvbiB7XHJcbiAgICBjb25zdCBza2lsbEFsaWdubWVudCA9IGZlYXR1cmVzLmNvbnRleHR1YWxGZWF0dXJlcy5za2lsbEFsaWdubWVudCB8fCAwO1xyXG4gICAgXHJcbiAgICBpZiAoc2tpbGxBbGlnbm1lbnQgPiAwLjcpIHtcclxuICAgICAgcmV0dXJuIFJlY29tbWVuZGF0aW9uUmVhc29uLlNLSUxMX0dBUDtcclxuICAgIH0gZWxzZSBpZiAoY29udGV4dC5yZWNlbnRJbnRlcmFjdGlvbnM/Lmxlbmd0aCAmJiBjb250ZXh0LnJlY2VudEludGVyYWN0aW9ucy5sZW5ndGggPiAxMCkge1xyXG4gICAgICByZXR1cm4gUmVjb21tZW5kYXRpb25SZWFzb24uTEVBUk5JTkdfSElTVE9SWTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBSZWNvbW1lbmRhdGlvblJlYXNvbi5JTlRFUkVTVF9CQVNFRDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2FsY3VsYXRlTUxQcmlvcml0eShzY29yZTogbnVtYmVyLCBmZWF0dXJlczogTUxGZWF0dXJlcyk6IG51bWJlciB7XHJcbiAgICBsZXQgcHJpb3JpdHkgPSBNYXRoLmZsb29yKHNjb3JlICogNSk7IC8vIEJhc2UgcHJpb3JpdHkgZnJvbSBzY29yZVxyXG4gICAgXHJcbiAgICAvLyBCb29zdCBmb3IgaGlnaCBza2lsbCBhbGlnbm1lbnRcclxuICAgIGlmICgoZmVhdHVyZXMuY29udGV4dHVhbEZlYXR1cmVzLnNraWxsQWxpZ25tZW50IHx8IDApID4gMC44KSB7XHJcbiAgICAgIHByaW9yaXR5ICs9IDI7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiBNYXRoLm1pbihwcmlvcml0eSwgMTApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZW5lcmF0ZUV4cGxhbmF0aW9uKGNvdXJzZTogQ291cnNlLCBmZWF0dXJlczogTUxGZWF0dXJlcywgc2NvcmU6IG51bWJlcik6IHN0cmluZyB7XHJcbiAgICBjb25zdCBza2lsbEFsaWdubWVudCA9IGZlYXR1cmVzLmNvbnRleHR1YWxGZWF0dXJlcy5za2lsbEFsaWdubWVudCB8fCAwO1xyXG4gICAgXHJcbiAgICBpZiAoc2tpbGxBbGlnbm1lbnQgPiAwLjcpIHtcclxuICAgICAgcmV0dXJuIGBUaGlzIGNvdXJzZSBhbGlnbnMgd2VsbCB3aXRoIHlvdXIgc2tpbGwgZGV2ZWxvcG1lbnQgZ29hbHNgO1xyXG4gICAgfSBlbHNlIGlmIChzY29yZSA+IDAuOCkge1xyXG4gICAgICByZXR1cm4gYEhpZ2hseSByZWNvbW1lbmRlZCBiYXNlZCBvbiB5b3VyIGxlYXJuaW5nIHBhdHRlcm5zYDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBgUmVjb21tZW5kZWQgYmFzZWQgb24geW91ciBpbnRlcmVzdHMgYW5kIGFjdGl2aXR5YDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0VG9wU2tpbGxzRnJvbVZlY3Rvcihza2lsbFZlY3RvcjogbnVtYmVyW10pOiBzdHJpbmdbXSB7XHJcbiAgICAvLyBUaGlzIHdvdWxkIG1hcCB2ZWN0b3IgaW5kaWNlcyBiYWNrIHRvIHNraWxsIG5hbWVzIGluIGEgcmVhbCBpbXBsZW1lbnRhdGlvblxyXG4gICAgcmV0dXJuIFsnSmF2YVNjcmlwdCcsICdSZWFjdCcsICdOb2RlLmpzJ10uc2xpY2UoMCwgMyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldFRvcFByZWZlcmVuY2VzRnJvbVZlY3RvcihwcmVmZXJlbmNlVmVjdG9yOiBudW1iZXJbXSk6IHN0cmluZ1tdIHtcclxuICAgIC8vIFRoaXMgd291bGQgbWFwIHZlY3RvciBpbmRpY2VzIGJhY2sgdG8gcHJlZmVyZW5jZSBuYW1lcyBpbiBhIHJlYWwgaW1wbGVtZW50YXRpb25cclxuICAgIHJldHVybiBbJ1dlYiBEZXZlbG9wbWVudCcsICdGcm9udGVuZCcsICdCYWNrZW5kJ10uc2xpY2UoMCwgMyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIHN0b3JlRmVlZGJhY2tGb3JUcmFpbmluZyh1c2VySWQ6IHN0cmluZywgcmVjb21tZW5kYXRpb25JZDogc3RyaW5nLCBzY29yZTogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAvLyBTdG9yZSBmZWVkYmFjayBpbiBhIHRyYWluaW5nIGRhdGEgdGFibGUgKGltcGxlbWVudGF0aW9uIHdvdWxkIGRlcGVuZCBvbiB5b3VyIHNldHVwKVxyXG4gICAgdGhpcy5sb2dnZXIubG9nKGBTdG9yaW5nIGZlZWRiYWNrOiB1c2VyPSR7dXNlcklkfSwgcmVjPSR7cmVjb21tZW5kYXRpb25JZH0sIHNjb3JlPSR7c2NvcmV9YCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGdldEZlZWRiYWNrQ291bnQoKTogUHJvbWlzZTxudW1iZXI+IHtcclxuICAgIC8vIFJldHVybiBjb3VudCBvZiBmZWVkYmFjayByZWNvcmRzIGZvciByZXRyYWluaW5nIGRlY2lzaW9uXHJcbiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjAwMCk7IC8vIFBsYWNlaG9sZGVyXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIHJldHJhaW5Nb2RlbCgpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHRoaXMubG9nZ2VyLmxvZygnVHJpZ2dlcmluZyBtb2RlbCByZXRyYWluaW5nLi4uJyk7XHJcbiAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHRoaXMgd291bGQgdHJpZ2dlciBhbiBNTCBwaXBlbGluZVxyXG4gICAgLy8gRm9yIG5vdywganVzdCB1cGRhdGUgdGhlIG1vZGVsIHRpbWVzdGFtcFxyXG4gICAgaWYgKHRoaXMubW9kZWwpIHtcclxuICAgICAgdGhpcy5tb2RlbC5sYXN0VHJhaW5lZCA9IG5ldyBEYXRlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdLCJ2ZXJzaW9uIjozfQ==