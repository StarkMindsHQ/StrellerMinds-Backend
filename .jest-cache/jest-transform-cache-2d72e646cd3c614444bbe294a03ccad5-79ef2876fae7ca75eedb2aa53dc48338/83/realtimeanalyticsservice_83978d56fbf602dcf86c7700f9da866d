1d9db9e12cdfde6d6e73aa75f8d11879
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var RealTimeAnalyticsService_1;
Object.defineProperty(exports, "__esModule", { value: true });
exports.RealTimeAnalyticsService = void 0;
const common_1 = require("@nestjs/common");
let RealTimeAnalyticsService = RealTimeAnalyticsService_1 = class RealTimeAnalyticsService {
    constructor(analyticsGateway) {
        this.analyticsGateway = analyticsGateway;
        this.logger = new common_1.Logger(RealTimeAnalyticsService_1.name);
        this.metricsBuffer = new Map();
        this.bufferFlushInterval = 5000; // 5 seconds
        // Flush metrics buffer periodically
        setInterval(() => {
            this.flushMetricsBuffer();
        }, this.bufferFlushInterval);
    }
    async processRealTimeEvent(eventData) {
        try {
            // Update real-time counters
            this.updateRealTimeCounters(eventData);
            // Emit to connected clients
            this.analyticsGateway.emitRealTimeEvent({
                type: "event",
                data: eventData,
                timestamp: new Date(),
            });
            this.logger.debug(`Processed real-time event: ${eventData.eventName}`);
        }
        catch (error) {
            this.logger.error(`Failed to process real-time event: ${error.message}`, error.stack);
        }
    }
    updateRealTimeCounters(eventData) {
        const timestamp = new Date();
        // Event count
        this.incrementMetric("events_per_second", 1, timestamp);
        // User activity
        if (eventData.userId) {
            this.incrementMetric("active_users", 1, timestamp, {
                userId: eventData.userId,
            });
        }
        // Event type counters
        this.incrementMetric(`events_${eventData.eventType}`, 1, timestamp);
        // Source/Channel counters
        if (eventData.source) {
            this.incrementMetric("events_by_source", 1, timestamp, {
                source: eventData.source,
            });
        }
        if (eventData.channel) {
            this.incrementMetric("events_by_channel", 1, timestamp, {
                channel: eventData.channel,
            });
        }
    }
    incrementMetric(name, value, timestamp, dimensions) {
        const key = `${name}_${JSON.stringify(dimensions || {})}`;
        const existing = this.metricsBuffer.get(key);
        if (existing) {
            existing.value += value;
            existing.timestamp = timestamp;
        }
        else {
            this.metricsBuffer.set(key, {
                name,
                value,
                timestamp,
                dimensions,
            });
        }
    }
    flushMetricsBuffer() {
        if (this.metricsBuffer.size === 0) {
            return;
        }
        const metrics = Array.from(this.metricsBuffer.values());
        this.metricsBuffer.clear();
        // Emit aggregated metrics
        this.analyticsGateway.emitRealTimeMetrics(metrics);
        this.logger.debug(`Flushed ${metrics.length} real-time metrics`);
    }
    async getCurrentMetrics() {
        return Array.from(this.metricsBuffer.values());
    }
    async getActiveUsers() {
        const activeUserMetrics = Array.from(this.metricsBuffer.values()).filter((metric) => metric.name === "active_users");
        return new Set(activeUserMetrics.map((metric) => metric.dimensions?.userId).filter(Boolean)).size;
    }
    async getEventsPerSecond() {
        const eventsMetric = this.metricsBuffer.get("events_per_second_{}");
        return eventsMetric?.value || 0;
    }
};
exports.RealTimeAnalyticsService = RealTimeAnalyticsService;
exports.RealTimeAnalyticsService = RealTimeAnalyticsService = RealTimeAnalyticsService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [Object])
], RealTimeAnalyticsService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxnLWVrb2hcXERlc2t0b3BcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFxhbmFseXRpY1xcc2VydmljZXNcXHJlYWwtdGltZS1hbmFseXRpY3Muc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUEsMkNBQW1EO0FBWTVDLElBQU0sd0JBQXdCLGdDQUE5QixNQUFNLHdCQUF3QjtJQUtuQyxZQUE2QixnQkFBa0M7UUFBbEMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUo5QyxXQUFNLEdBQUcsSUFBSSxlQUFNLENBQUMsMEJBQXdCLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDbEQsa0JBQWEsR0FBRyxJQUFJLEdBQUcsRUFBMEIsQ0FBQTtRQUNqRCx3QkFBbUIsR0FBRyxJQUFJLENBQUEsQ0FBQyxZQUFZO1FBR3RELG9DQUFvQztRQUNwQyxXQUFXLENBQUMsR0FBRyxFQUFFO1lBQ2YsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUE7UUFDM0IsQ0FBQyxFQUFFLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFBO0lBQzlCLENBQUM7SUFFRCxLQUFLLENBQUMsb0JBQW9CLENBQUMsU0FBb0I7UUFDN0MsSUFBSSxDQUFDO1lBQ0gsNEJBQTRCO1lBQzVCLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxTQUFTLENBQUMsQ0FBQTtZQUV0Qyw0QkFBNEI7WUFDNUIsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDO2dCQUN0QyxJQUFJLEVBQUUsT0FBTztnQkFDYixJQUFJLEVBQUUsU0FBUztnQkFDZixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7YUFDdEIsQ0FBQyxDQUFBO1lBRUYsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsOEJBQThCLFNBQVMsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFBO1FBQ3hFLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsc0NBQXNDLEtB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QUMsTUFBTSxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLGNBQWMsQ0FBQyxDQUFBO1FBRXBILE9BQU8sSUFBSSxHQUFHLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQTtJQUNuRyxDQUFDO0lBRUQsS0FBSyxDQUFDLGtCQUFrQjtRQUN0QixNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFBO1FBQ25FLE9BQU8sWUFBWSxFQUFFLEtBQUssSUFBSSxDQUFDLENBQUE7SUFDakMsQ0FBQztDQUNGLENBQUE7QUF6R1ksNERBQXdCO21DQUF4Qix3QkFBd0I7SUFEcEMsSUFBQSxtQkFBVSxHQUFFOztHQUNBLHdCQUF3QixDQXlHcEMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxnLWVrb2hcXERlc2t0b3BcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFxhbmFseXRpY1xcc2VydmljZXNcXHJlYWwtdGltZS1hbmFseXRpY3Muc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBMb2dnZXIgfSBmcm9tIFwiQG5lc3Rqcy9jb21tb25cIlxyXG5pbXBvcnQgdHlwZSB7IEFuYWx5dGljc0dhdGV3YXkgfSBmcm9tIFwiLi4vZ2F0ZXdheXMvYW5hbHl0aWNzLmdhdGV3YXlcIlxyXG5pbXBvcnQgdHlwZSB7IEV2ZW50RGF0YSB9IGZyb20gXCIuL2RhdGEtY29sbGVjdGlvbi5zZXJ2aWNlXCJcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgUmVhbFRpbWVNZXRyaWMge1xyXG4gIG5hbWU6IHN0cmluZ1xyXG4gIHZhbHVlOiBudW1iZXJcclxuICB0aW1lc3RhbXA6IERhdGVcclxuICBkaW1lbnNpb25zPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPlxyXG59XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBSZWFsVGltZUFuYWx5dGljc1NlcnZpY2Uge1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgbG9nZ2VyID0gbmV3IExvZ2dlcihSZWFsVGltZUFuYWx5dGljc1NlcnZpY2UubmFtZSlcclxuICBwcml2YXRlIHJlYWRvbmx5IG1ldHJpY3NCdWZmZXIgPSBuZXcgTWFwPHN0cmluZywgUmVhbFRpbWVNZXRyaWM+KClcclxuICBwcml2YXRlIHJlYWRvbmx5IGJ1ZmZlckZsdXNoSW50ZXJ2YWwgPSA1MDAwIC8vIDUgc2Vjb25kc1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGFuYWx5dGljc0dhdGV3YXk6IEFuYWx5dGljc0dhdGV3YXkpIHtcclxuICAgIC8vIEZsdXNoIG1ldHJpY3MgYnVmZmVyIHBlcmlvZGljYWxseVxyXG4gICAgc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICB0aGlzLmZsdXNoTWV0cmljc0J1ZmZlcigpXHJcbiAgICB9LCB0aGlzLmJ1ZmZlckZsdXNoSW50ZXJ2YWwpXHJcbiAgfVxyXG5cclxuICBhc3luYyBwcm9jZXNzUmVhbFRpbWVFdmVudChldmVudERhdGE6IEV2ZW50RGF0YSk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gVXBkYXRlIHJlYWwtdGltZSBjb3VudGVyc1xyXG4gICAgICB0aGlzLnVwZGF0ZVJlYWxUaW1lQ291bnRlcnMoZXZlbnREYXRhKVxyXG5cclxuICAgICAgLy8gRW1pdCB0byBjb25uZWN0ZWQgY2xpZW50c1xyXG4gICAgICB0aGlzLmFuYWx5dGljc0dhdGV3YXkuZW1pdFJlYWxUaW1lRXZlbnQoe1xyXG4gICAgICAgIHR5cGU6IFwiZXZlbnRcIixcclxuICAgICAgICBkYXRhOiBldmVudERhdGEsXHJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxyXG4gICAgICB9KVxyXG5cclxuICAgICAgdGhpcy5sb2dnZXIuZGVidWcoYFByb2Nlc3NlZCByZWFsLXRpbWUgZXZlbnQ6ICR7ZXZlbnREYXRhLmV2ZW50TmFtZX1gKVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEZhaWxlZCB0byBwcm9jZXNzIHJlYWwtdGltZSBldmVudDogJHtlcnJvci5tZXNzYWdlfWAsIGVycm9yLnN0YWNrKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB1cGRhdGVSZWFsVGltZUNvdW50ZXJzKGV2ZW50RGF0YTogRXZlbnREYXRhKTogdm9pZCB7XHJcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpXHJcblxyXG4gICAgLy8gRXZlbnQgY291bnRcclxuICAgIHRoaXMuaW5jcmVtZW50TWV0cmljKFwiZXZlbnRzX3Blcl9zZWNvbmRcIiwgMSwgdGltZXN0YW1wKVxyXG5cclxuICAgIC8vIFVzZXIgYWN0aXZpdHlcclxuICAgIGlmIChldmVudERhdGEudXNlcklkKSB7XHJcbiAgICAgIHRoaXMuaW5jcmVtZW50TWV0cmljKFwiYWN0aXZlX3VzZXJzXCIsIDEsIHRpbWVzdGFtcCwge1xyXG4gICAgICAgIHVzZXJJZDogZXZlbnREYXRhLnVzZXJJZCxcclxuICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICAvLyBFdmVudCB0eXBlIGNvdW50ZXJzXHJcbiAgICB0aGlzLmluY3JlbWVudE1ldHJpYyhgZXZlbnRzXyR7ZXZlbnREYXRhLmV2ZW50VHlwZX1gLCAxLCB0aW1lc3RhbXApXHJcblxyXG4gICAgLy8gU291cmNlL0NoYW5uZWwgY291bnRlcnNcclxuICAgIGlmIChldmVudERhdGEuc291cmNlKSB7XHJcbiAgICAgIHRoaXMuaW5jcmVtZW50TWV0cmljKFwiZXZlbnRzX2J5X3NvdXJjZVwiLCAxLCB0aW1lc3RhbXAsIHtcclxuICAgICAgICBzb3VyY2U6IGV2ZW50RGF0YS5zb3VyY2UsXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGV2ZW50RGF0YS5jaGFubmVsKSB7XHJcbiAgICAgIHRoaXMuaW5jcmVtZW50TWV0cmljKFwiZXZlbnRzX2J5X2NoYW5uZWxcIiwgMSwgdGltZXN0YW1wLCB7XHJcbiAgICAgICAgY2hhbm5lbDogZXZlbnREYXRhLmNoYW5uZWwsXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGluY3JlbWVudE1ldHJpYyhuYW1lOiBzdHJpbmcsIHZhbHVlOiBudW1iZXIsIHRpbWVzdGFtcDogRGF0ZSwgZGltZW5zaW9ucz86IFJlY29yZDxzdHJpbmcsIHN0cmluZz4pOiB2b2lkIHtcclxuICAgIGNvbnN0IGtleSA9IGAke25hbWV9XyR7SlNPTi5zdHJpbmdpZnkoZGltZW5zaW9ucyB8fCB7fSl9YFxyXG4gICAgY29uc3QgZXhpc3RpbmcgPSB0aGlzLm1ldHJpY3NCdWZmZXIuZ2V0KGtleSlcclxuXHJcbiAgICBpZiAoZXhpc3RpbmcpIHtcclxuICAgICAgZXhpc3RpbmcudmFsdWUgKz0gdmFsdWVcclxuICAgICAgZXhpc3RpbmcudGltZXN0YW1wID0gdGltZXN0YW1wXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLm1ldHJpY3NCdWZmZXIuc2V0KGtleSwge1xyXG4gICAgICAgIG5hbWUsXHJcbiAgICAgICAgdmFsdWUsXHJcbiAgICAgICAgdGltZXN0YW1wLFxyXG4gICAgICAgIGRpbWVuc2lvbnMsXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGZsdXNoTWV0cmljc0J1ZmZlcigpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLm1ldHJpY3NCdWZmZXIuc2l6ZSA9PT0gMCkge1xyXG4gICAgICByZXR1cm5cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBtZXRyaWNzID0gQXJyYXkuZnJvbSh0aGlzLm1ldHJpY3NCdWZmZXIudmFsdWVzKCkpXHJcbiAgICB0aGlzLm1ldHJpY3NCdWZmZXIuY2xlYXIoKVxyXG5cclxuICAgIC8vIEVtaXQgYWdncmVnYXRlZCBtZXRyaWNzXHJcbiAgICB0aGlzLmFuYWx5dGljc0dhdGV3YXkuZW1pdFJlYWxUaW1lTWV0cmljcyhtZXRyaWNzKVxyXG5cclxuICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBGbHVzaGVkICR7bWV0cmljcy5sZW5ndGh9IHJlYWwtdGltZSBtZXRyaWNzYClcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldEN1cnJlbnRNZXRyaWNzKCk6IFByb21pc2U8UmVhbFRpbWVNZXRyaWNbXT4ge1xyXG4gICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5tZXRyaWNzQnVmZmVyLnZhbHVlcygpKVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0QWN0aXZlVXNlcnMoKTogUHJvbWlzZTxudW1iZXI+IHtcclxuICAgIGNvbnN0IGFjdGl2ZVVzZXJNZXRyaWNzID0gQXJyYXkuZnJvbSh0aGlzLm1ldHJpY3NCdWZmZXIudmFsdWVzKCkpLmZpbHRlcigobWV0cmljKSA9PiBtZXRyaWMubmFtZSA9PT0gXCJhY3RpdmVfdXNlcnNcIilcclxuXHJcbiAgICByZXR1cm4gbmV3IFNldChhY3RpdmVVc2VyTWV0cmljcy5tYXAoKG1ldHJpYykgPT4gbWV0cmljLmRpbWVuc2lvbnM/LnVzZXJJZCkuZmlsdGVyKEJvb2xlYW4pKS5zaXplXHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRFdmVudHNQZXJTZWNvbmQoKTogUHJvbWlzZTxudW1iZXI+IHtcclxuICAgIGNvbnN0IGV2ZW50c01ldHJpYyA9IHRoaXMubWV0cmljc0J1ZmZlci5nZXQoXCJldmVudHNfcGVyX3NlY29uZF97fVwiKVxyXG4gICAgcmV0dXJuIGV2ZW50c01ldHJpYz8udmFsdWUgfHwgMFxyXG4gIH1cclxufVxyXG4iXSwidmVyc2lvbiI6M30=