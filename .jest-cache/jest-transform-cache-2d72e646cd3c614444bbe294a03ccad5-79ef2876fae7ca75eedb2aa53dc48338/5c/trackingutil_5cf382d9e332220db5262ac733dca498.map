{"file":"C:\\Users\\g-ekoh\\Desktop\\StrellerMinds-Backend\\src\\email\\utils\\tracking.util.ts","mappings":";;AAEA,gDAmBC;AAED,0CAEC;AAzBD,+BAAmC;AAEnC,SAAgB,kBAAkB,CAAC,IAAY,EAAE,OAAe,EAAE,OAAe;IAC/E,+BAA+B;IAC/B,MAAM,aAAa,GAAG,aAAa,OAAO,qBAAqB,OAAO,sDAAsD,CAAA;IAE5H,4BAA4B;IAC5B,IAAI,YAAY,GAAG,IAAI,CAAC,OAAO,CAAC,4CAA4C,EAAE,CAAC,KAAK,EAAE,GAAG,EAAE,EAAE;QAC3F,gCAAgC;QAChC,IAAI,GAAG,CAAC,QAAQ,CAAC,cAAc,CAAC,IAAI,GAAG,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAE,CAAC;YACjE,OAAO,KAAK,CAAA;QACd,CAAC;QAED,MAAM,WAAW,GAAG,GAAG,OAAO,sBAAsB,OAAO,QAAQ,kBAAkB,CAAC,GAAG,CAAC,EAAE,CAAA;QAC5F,OAAO,KAAK,CAAC,OAAO,CAAC,GAAG,EAAE,WAAW,CAAC,CAAA;IACxC,CAAC,CAAC,CAAA;IAEF,6CAA6C;IAC7C,YAAY,GAAG,YAAY,CAAC,OAAO,CAAC,SAAS,EAAE,GAAG,aAAa,SAAS,CAAC,CAAA;IAEzE,OAAO,YAAY,CAAA;AACrB,CAAC;AAED,SAAgB,eAAe;IAC7B,OAAO,IAAA,SAAM,GAAE,CAAA;AACjB,CAAC","names":[],"sources":["C:\\Users\\g-ekoh\\Desktop\\StrellerMinds-Backend\\src\\email\\utils\\tracking.util.ts"],"sourcesContent":["import { v4 as uuidv4 } from \"uuid\"\r\n\r\nexport function addTrackingToEmail(html: string, emailId: string, baseUrl: string): string {\r\n  // Add tracking pixel for opens\r\n  const trackingPixel = `<img src=\"${baseUrl}/email/track/open/${emailId}\" width=\"1\" height=\"1\" alt=\"\" style=\"display:none;\">`\r\n\r\n  // Add tracking to all links\r\n  let modifiedHtml = html.replace(/<a\\s+(?:[^>]*?\\s+)?href=[\"']([^\"']*)[\"']/gi, (match, url) => {\r\n    // Don't track unsubscribe links\r\n    if (url.includes(\"/unsubscribe\") || url.includes(\"/preferences\")) {\r\n      return match\r\n    }\r\n\r\n    const trackingUrl = `${baseUrl}/email/track/click/${emailId}?url=${encodeURIComponent(url)}`\r\n    return match.replace(url, trackingUrl)\r\n  })\r\n\r\n  // Add tracking pixel at the end of the email\r\n  modifiedHtml = modifiedHtml.replace(\"</body>\", `${trackingPixel}</body>`)\r\n\r\n  return modifiedHtml\r\n}\r\n\r\nexport function generateEmailId(): string {\r\n  return uuidv4()\r\n}\r\n\r\n"],"version":3}