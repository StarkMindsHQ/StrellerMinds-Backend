25a8bd229eceb65359f23d78953f68b3
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var DataQualityReportingService_1;
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", { value: true });
exports.DataQualityReportingService = void 0;
const common_1 = require("@nestjs/common");
const schedule_1 = require("@nestjs/schedule");
const data_quality_report_entity_1 = require("../entities/data-quality-report.entity");
let DataQualityReportingService = DataQualityReportingService_1 = class DataQualityReportingService {
    constructor(reportRepository, metricRepository, issueRepository, monitoringService) {
        this.reportRepository = reportRepository;
        this.metricRepository = metricRepository;
        this.issueRepository = issueRepository;
        this.monitoringService = monitoringService;
        this.logger = new common_1.Logger(DataQualityReportingService_1.name);
    }
    async generateReport(reportType, startDate, endDate) {
        try {
            const report = this.reportRepository.create({
                name: `Data Quality Report - ${reportType}`,
                reportType,
                status: data_quality_report_entity_1.ReportStatus.GENERATING,
                reportDate: new Date(),
                startDate,
                endDate,
                summary: {},
                metrics: {},
            });
            const savedReport = await this.reportRepository.save(report);
            // Generate report content
            const reportData = await this.generateReportData(startDate, endDate);
            savedReport.summary = reportData.summary;
            savedReport.metrics = reportData.metrics;
            savedReport.issues = reportData.issues;
            savedReport.recommendations = reportData.recommendations;
            savedReport.status = data_quality_report_entity_1.ReportStatus.COMPLETED;
            return this.reportRepository.save(savedReport);
        }
        catch (error) {
            this.logger.error(`Report generation failed: ${error.message}`, error.stack);
            throw error;
        }
    }
    async generateReportData(startDate, endDate) {
        // Get overall metrics
        const overallScore = await this.calculateOverallScore(startDate, endDate);
        const categoryScores = await this.calculateCategoryScores(startDate, endDate);
        // Get issue statistics
        const totalIssues = await this.issueRepository.count({
            where: {
                createdAt: new Date(startDate.getTime()),
            },
        });
        const resolvedIssues = await this.issueRepository.count({
            where: {
                status: "resolved",
                resolvedAt: new Date(startDate.getTime()),
            },
        });
        const criticalIssues = await this.issueRepository.count({
            where: {
                priority: "critical",
                status: "open",
            },
        });
        // Get top issues
        const topIssues = await this.issueRepository.find({
            where: {
                createdAt: new Date(startDate.getTime()),
            },
            order: { occurrenceCount: "DESC" },
            take: 10,
        });
        // Get metric trends
        const metricTrends = await this.getMetricTrends(startDate, endDate);
        // Generate recommendations
        const recommendations = this.generateRecommendations(overallScore, categoryScores, criticalIssues);
        return {
            summary: {
                reportPeriod: {
                    startDate: startDate.toISOString(),
                    endDate: endDate.toISOString(),
                },
                overallScore,
                totalIssues,
                resolvedIssues,
                criticalIssues,
                resolutionRate: totalIssues > 0 ? (resolvedIssues / totalIssues) * 100 : 100,
            },
            metrics: {
                categoryScores,
                trends: metricTrends,
                topPerformingCategories: this.getTopCategories(categoryScores, true),
                underPerformingCategories: this.getTopCategories(categoryScores, false),
            },
            issues: {
                topIssues: topIssues.map((issue) => ({
                    id: issue.id,
                    title: issue.title,
                    priority: issue.priority,
                    occurrenceCount: issue.occurrenceCount,
                    entityType: issue.entityType,
                })),
                issuesByCategory: await this.getIssuesByCategory(startDate, endDate),
                issuesByPriority: await this.getIssuesByPriority(startDate, endDate),
            },
            recommendations: {
                immediate: recommendations.immediate,
                shortTerm: recommendations.shortTerm,
                longTerm: recommendations.longTerm,
            },
        };
    }
    async calculateOverallScore(startDate, endDate) {
        const result = await this.metricRepository
            .createQueryBuilder("metric")
            .select("AVG(metric.value)", "avgScore")
            .where("metric.timestamp >= :startDate", { startDate })
            .andWhere("metric.timestamp <= :endDate", { endDate })
            .getRawOne();
        return Number.parseFloat(result.avgScore) || 0;
    }
    async calculateCategoryScores(startDate, endDate) {
        const results = await this.metricRepository
            .createQueryBuilder("metric")
            .select("metric.metricCategory", "category")
            .addSelect("AVG(metric.value)", "avgScore")
            .where("metric.timestamp >= :startDate", { startDate })
            .andWhere("metric.timestamp <= :endDate", { endDate })
            .groupBy("metric.metricCategory")
            .getRawMany();
        const categoryScores = {};
        for (const result of results) {
            categoryScores[result.category] = Number.parseFloat(result.avgScore) || 0;
        }
        return categoryScores;
    }
    async getMetricTrends(startDate, endDate) {
        const results = await this.metricRepository
            .createQueryBuilder("metric")
            .select("DATE(metric.timestamp)", "date")
            .addSelect("metric.metricCategory", "category")
            .addSelect("AVG(metric.value)", "score")
            .where("metric.timestamp >= :startDate", { startDate })
            .andWhere("metric.timestamp <= :endDate", { endDate })
            .groupBy("DATE(metric.timestamp), metric.metricCategory")
            .orderBy("DATE(metric.timestamp)", "ASC")
            .getRawMany();
        return results.map((result) => ({
            date: result.date,
            category: result.category,
            score: Number.parseFloat(result.score) || 0,
        }));
    }
    getTopCategories(categoryScores, topPerforming) {
        const sorted = Object.entries(categoryScores)
            .map(([category, score]) => ({ category, score }))
            .sort((a, b) => (topPerforming ? b.score - a.score : a.score - b.score));
        return sorted.slice(0, 3);
    }
    async getIssuesByCategory(startDate, endDate) {
        const results = await this.issueRepository
            .createQueryBuilder("issue")
            .select("issue.entityType", "category")
            .addSelect("COUNT(*)", "count")
            .where("issue.createdAt >= :startDate", { startDate })
            .andWhere("issue.createdAt <= :endDate", { endDate })
            .groupBy("issue.entityType")
            .getRawMany();
        const issuesByCategory = {};
        for (const result of results) {
            issuesByCategory[result.category] = Number.parseInt(result.count);
        }
        return issuesByCategory;
    }
    async getIssuesByPriority(startDate, endDate) {
        const results = await this.issueRepository
            .createQueryBuilder("issue")
            .select("issue.priority", "priority")
            .addSelect("COUNT(*)", "count")
            .where("issue.createdAt >= :startDate", { startDate })
            .andWhere("issue.createdAt <= :endDate", { endDate })
            .groupBy("issue.priority")
            .getRawMany();
        const issuesByPriority = {};
        for (const result of results) {
            issuesByPriority[result.priority] = Number.parseInt(result.count);
        }
        return issuesByPriority;
    }
    generateRecommendations(overallScore, categoryScores, criticalIssues) {
        const recommendations = {
            immediate: [],
            shortTerm: [],
            longTerm: [],
        };
        // Immediate recommendations
        if (criticalIssues > 0) {
            recommendations.immediate.push(`Address ${criticalIssues} critical data quality issues immediately`);
        }
        if (overallScore < 70) {
            recommendations.immediate.push("Overall data quality score is below acceptable threshold (70%)");
        }
        // Short-term recommendations
        const underPerformingCategories = Object.entries(categoryScores)
            .filter(([, score]) => score < 80)
            .map(([category]) => category);
        if (underPerformingCategories.length > 0) {
            recommendations.shortTerm.push(`Focus on improving ${underPerformingCategories.join(", ")} categories`);
        }
        recommendations.shortTerm.push("Implement automated data quality monitoring");
        recommendations.shortTerm.push("Establish data quality SLAs and thresholds");
        // Long-term recommendations
        recommendations.longTerm.push("Develop comprehensive data governance framework");
        recommendations.longTerm.push("Implement data quality training for data stewards");
        recommendations.longTerm.push("Establish data quality metrics and KPIs");
        recommendations.longTerm.push("Create data quality dashboard for stakeholders");
        return recommendations;
    }
    async getReports(filters) {
        const query = this.reportRepository.createQueryBuilder("report");
        if (filters.reportType) {
            query.andWhere("report.reportType = :reportType", { reportType: filters.reportType });
        }
        if (filters.status) {
            query.andWhere("report.status = :status", { status: filters.status });
        }
        if (filters.startDate) {
            query.andWhere("report.createdAt >= :startDate", { startDate: filters.startDate });
        }
        if (filters.endDate) {
            query.andWhere("report.createdAt <= :endDate", { endDate: filters.endDate });
        }
        return query.orderBy("report.createdAt", "DESC").getMany();
    }
    async generateDailyReport() {
        this.logger.log("Generating daily data quality report");
        try {
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - 1);
            await this.generateReport(data_quality_report_entity_1.ReportType.DAILY, startDate, endDate);
            this.logger.log("Daily report generated successfully");
        }
        catch (error) {
            this.logger.error(`Daily report generation failed: ${error.message}`, error.stack);
        }
    }
    async generateWeeklyReport() {
        this.logger.log("Generating weekly data quality report");
        try {
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - 7);
            await this.generateReport(data_quality_report_entity_1.ReportType.WEEKLY, startDate, endDate);
            this.logger.log("Weekly report generated successfully");
        }
        catch (error) {
            this.logger.error(`Weekly report generation failed: ${error.message}`, error.stack);
        }
    }
    async generateMonthlyReport() {
        this.logger.log("Generating monthly data quality report");
        try {
            const endDate = new Date();
            const startDate = new Date();
            startDate.setMonth(startDate.getMonth() - 1);
            await this.generateReport(data_quality_report_entity_1.ReportType.MONTHLY, startDate, endDate);
            this.logger.log("Monthly report generated successfully");
        }
        catch (error) {
            this.logger.error(`Monthly report generation failed: ${error.message}`, error.stack);
        }
    }
};
exports.DataQualityReportingService = DataQualityReportingService;
__decorate([
    (0, schedule_1.Cron)(schedule_1.CronExpression.EVERY_DAY_AT_MIDNIGHT),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", typeof (_a = typeof Promise !== "undefined" && Promise) === "function" ? _a : Object)
], DataQualityReportingService.prototype, "generateDailyReport", null);
__decorate([
    (0, schedule_1.Cron)(schedule_1.CronExpression.EVERY_WEEK),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", typeof (_b = typeof Promise !== "undefined" && Promise) === "function" ? _b : Object)
], DataQualityReportingService.prototype, "generateWeeklyReport", null);
__decorate([
    (0, schedule_1.Cron)(schedule_1.CronExpression.EVERY_1ST_DAY_OF_MONTH_AT_MIDNIGHT),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", typeof (_c = typeof Promise !== "undefined" && Promise) === "function" ? _c : Object)
], DataQualityReportingService.prototype, "generateMonthlyReport", null);
exports.DataQualityReportingService = DataQualityReportingService = DataQualityReportingService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [Object, Object, Object, Object])
], DataQualityReportingService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxnLWVrb2hcXERlc2t0b3BcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFxkYXRhLXF1YWxpdHlcXHNlcnZpY2VzXFxkYXRhLXF1YWxpdHktcmVwb3J0aW5nLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FBbUQ7QUFFbkQsK0NBQXVEO0FBRXZELHVGQUF5RztBQU1sRyxJQUFNLDJCQUEyQixtQ0FBakMsTUFBTSwyQkFBMkI7SUFHdEMsWUFDbUIsZ0JBQStDLEVBQy9DLGdCQUErQyxFQUMvQyxlQUE2QyxFQUM3QyxpQkFBK0M7UUFIL0MscUJBQWdCLEdBQWhCLGdCQUFnQixDQUErQjtRQUMvQyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQStCO1FBQy9DLG9CQUFlLEdBQWYsZUFBZSxDQUE4QjtRQUM3QyxzQkFBaUIsR0FBakIsaUJBQWlCLENBQThCO1FBTmpELFdBQU0sR0FBRyxJQUFJLGVBQU0sQ0FBQyw2QkFBMkIsQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQU9uRSxDQUFDO0lBRUosS0FBSyxDQUFDLGNBQWMsQ0FBQyxVQUFzQixFQUFFLFNBQWUsRUFBRSxPQUFhO1FBQ3pFLElBQUksQ0FBQztZQUNILE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUM7Z0JBQzFDLElBQUksRUFBRSx5QkFBeUIsVUFBVSxFQUFFO2dCQUMzQyxVQUFVO2dCQUNWLE1BQU0sRUFBRSx5Q0FBWSxDQUFDLFVBQVU7Z0JBQy9CLFVBQVUsRUFBRSxJQUFJLElBQUksRUFBRTtnQkFDdEIsU0FBUztnQkFDVCxPQUFPO2dCQUNQLE9BQU8sRUFBRSxFQUFFO2dCQUNYLE9BQU8sRUFBRSxFQUFFO2FBQ1osQ0FBQyxDQUFBO1lBRUYsTUFBTSxXQUFXLEdBQUcsTUFBTSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO1lBRTVELDBCQUEwQjtZQUMxQixNQUFNLFVBQVUsR0FBRyxNQUFNLElBQUks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O3NFQWFuQztBQUdLO0lBREwsSUFBQSxlQUFJLEVBQUMseUJBQWMsQ0FBQyxVQUFVLENBQUM7Ozt3REFDRixPQUFPLG9CQUFQLE9BQU87dUVBYXBDO0FBR0s7SUFETCxJQUFBLGVBQUksRUFBQyx5QkFBYyxDQUFDLGtDQUFrQyxDQUFDOzs7d0RBQ3pCLE9BQU8sb0JBQVAsT0FBTzt3RUFhckM7c0NBaFdVLDJCQUEyQjtJQUR2QyxJQUFBLG1CQUFVLEdBQUU7O0dBQ0EsMkJBQTJCLENBaVd2QyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGctZWtvaFxcRGVza3RvcFxcU3RyZWxsZXJNaW5kcy1CYWNrZW5kXFxzcmNcXGRhdGEtcXVhbGl0eVxcc2VydmljZXNcXGRhdGEtcXVhbGl0eS1yZXBvcnRpbmcuc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBMb2dnZXIgfSBmcm9tIFwiQG5lc3Rqcy9jb21tb25cIlxyXG5pbXBvcnQgdHlwZSB7IFJlcG9zaXRvcnkgfSBmcm9tIFwidHlwZW9ybVwiXHJcbmltcG9ydCB7IENyb24sIENyb25FeHByZXNzaW9uIH0gZnJvbSBcIkBuZXN0anMvc2NoZWR1bGVcIlxyXG5cclxuaW1wb3J0IHsgdHlwZSBEYXRhUXVhbGl0eVJlcG9ydCwgUmVwb3J0VHlwZSwgUmVwb3J0U3RhdHVzIH0gZnJvbSBcIi4uL2VudGl0aWVzL2RhdGEtcXVhbGl0eS1yZXBvcnQuZW50aXR5XCJcclxuaW1wb3J0IHR5cGUgeyBEYXRhUXVhbGl0eU1ldHJpYyB9IGZyb20gXCIuLi9lbnRpdGllcy9kYXRhLXF1YWxpdHktbWV0cmljLmVudGl0eVwiXHJcbmltcG9ydCB0eXBlIHsgRGF0YVF1YWxpdHlJc3N1ZSB9IGZyb20gXCIuLi9lbnRpdGllcy9kYXRhLXF1YWxpdHktaXNzdWUuZW50aXR5XCJcclxuaW1wb3J0IHR5cGUgeyBEYXRhUXVhbGl0eU1vbml0b3JpbmdTZXJ2aWNlIH0gZnJvbSBcIi4vZGF0YS1xdWFsaXR5LW1vbml0b3Jpbmcuc2VydmljZVwiXHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBEYXRhUXVhbGl0eVJlcG9ydGluZ1NlcnZpY2Uge1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgbG9nZ2VyID0gbmV3IExvZ2dlcihEYXRhUXVhbGl0eVJlcG9ydGluZ1NlcnZpY2UubmFtZSlcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IHJlcG9ydFJlcG9zaXRvcnk6IFJlcG9zaXRvcnk8RGF0YVF1YWxpdHlSZXBvcnQ+LFxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBtZXRyaWNSZXBvc2l0b3J5OiBSZXBvc2l0b3J5PERhdGFRdWFsaXR5TWV0cmljPixcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgaXNzdWVSZXBvc2l0b3J5OiBSZXBvc2l0b3J5PERhdGFRdWFsaXR5SXNzdWU+LFxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBtb25pdG9yaW5nU2VydmljZTogRGF0YVF1YWxpdHlNb25pdG9yaW5nU2VydmljZSxcclxuICApIHt9XHJcblxyXG4gIGFzeW5jIGdlbmVyYXRlUmVwb3J0KHJlcG9ydFR5cGU6IFJlcG9ydFR5cGUsIHN0YXJ0RGF0ZTogRGF0ZSwgZW5kRGF0ZTogRGF0ZSk6IFByb21pc2U8RGF0YVF1YWxpdHlSZXBvcnQ+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHJlcG9ydCA9IHRoaXMucmVwb3J0UmVwb3NpdG9yeS5jcmVhdGUoe1xyXG4gICAgICAgIG5hbWU6IGBEYXRhIFF1YWxpdHkgUmVwb3J0IC0gJHtyZXBvcnRUeXBlfWAsXHJcbiAgICAgICAgcmVwb3J0VHlwZSxcclxuICAgICAgICBzdGF0dXM6IFJlcG9ydFN0YXR1cy5HRU5FUkFUSU5HLFxyXG4gICAgICAgIHJlcG9ydERhdGU6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgc3RhcnREYXRlLFxyXG4gICAgICAgIGVuZERhdGUsXHJcbiAgICAgICAgc3VtbWFyeToge30sXHJcbiAgICAgICAgbWV0cmljczoge30sXHJcbiAgICAgIH0pXHJcblxyXG4gICAgICBjb25zdCBzYXZlZFJlcG9ydCA9IGF3YWl0IHRoaXMucmVwb3J0UmVwb3NpdG9yeS5zYXZlKHJlcG9ydClcclxuXHJcbiAgICAgIC8vIEdlbmVyYXRlIHJlcG9ydCBjb250ZW50XHJcbiAgICAgIGNvbnN0IHJlcG9ydERhdGEgPSBhd2FpdCB0aGlzLmdlbmVyYXRlUmVwb3J0RGF0YShzdGFydERhdGUsIGVuZERhdGUpXHJcblxyXG4gICAgICBzYXZlZFJlcG9ydC5zdW1tYXJ5ID0gcmVwb3J0RGF0YS5zdW1tYXJ5XHJcbiAgICAgIHNhdmVkUmVwb3J0Lm1ldHJpY3MgPSByZXBvcnREYXRhLm1ldHJpY3NcclxuICAgICAgc2F2ZWRSZXBvcnQuaXNzdWVzID0gcmVwb3J0RGF0YS5pc3N1ZXNcclxuICAgICAgc2F2ZWRSZXBvcnQucmVjb21tZW5kYXRpb25zID0gcmVwb3J0RGF0YS5yZWNvbW1lbmRhdGlvbnNcclxuICAgICAgc2F2ZWRSZXBvcnQuc3RhdHVzID0gUmVwb3J0U3RhdHVzLkNPTVBMRVRFRFxyXG5cclxuICAgICAgcmV0dXJuIHRoaXMucmVwb3J0UmVwb3NpdG9yeS5zYXZlKHNhdmVkUmVwb3J0KVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYFJlcG9ydCBnZW5lcmF0aW9uIGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWAsIGVycm9yLnN0YWNrKVxyXG4gICAgICB0aHJvdyBlcnJvclxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZVJlcG9ydERhdGEoXHJcbiAgICBzdGFydERhdGU6IERhdGUsXHJcbiAgICBlbmREYXRlOiBEYXRlLFxyXG4gICk6IFByb21pc2U8e1xyXG4gICAgc3VtbWFyeTogUmVjb3JkPHN0cmluZywgYW55PlxyXG4gICAgbWV0cmljczogUmVjb3JkPHN0cmluZywgYW55PlxyXG4gICAgaXNzdWVzOiBSZWNvcmQ8c3RyaW5nLCBhbnk+XHJcbiAgICByZWNvbW1lbmRhdGlvbnM6IFJlY29yZDxzdHJpbmcsIGFueT5cclxuICB9PiB7XHJcbiAgICAvLyBHZXQgb3ZlcmFsbCBtZXRyaWNzXHJcbiAgICBjb25zdCBvdmVyYWxsU2NvcmUgPSBhd2FpdCB0aGlzLmNhbGN1bGF0ZU92ZXJhbGxTY29yZShzdGFydERhdGUsIGVuZERhdGUpXHJcbiAgICBjb25zdCBjYXRlZ29yeVNjb3JlcyA9IGF3YWl0IHRoaXMuY2FsY3VsYXRlQ2F0ZWdvcnlTY29yZXMoc3RhcnREYXRlLCBlbmREYXRlKVxyXG5cclxuICAgIC8vIEdldCBpc3N1ZSBzdGF0aXN0aWNzXHJcbiAgICBjb25zdCB0b3RhbElzc3VlcyA9IGF3YWl0IHRoaXMuaXNzdWVSZXBvc2l0b3J5LmNvdW50KHtcclxuICAgICAgd2hlcmU6IHtcclxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKHN0YXJ0RGF0ZS5nZXRUaW1lKCkpLFxyXG4gICAgICB9LFxyXG4gICAgfSlcclxuXHJcbiAgICBjb25zdCByZXNvbHZlZElzc3VlcyA9IGF3YWl0IHRoaXMuaXNzdWVSZXBvc2l0b3J5LmNvdW50KHtcclxuICAgICAgd2hlcmU6IHtcclxuICAgICAgICBzdGF0dXM6IFwicmVzb2x2ZWRcIixcclxuICAgICAgICByZXNvbHZlZEF0OiBuZXcgRGF0ZShzdGFydERhdGUuZ2V0VGltZSgpKSxcclxuICAgICAgfSxcclxuICAgIH0pXHJcblxyXG4gICAgY29uc3QgY3JpdGljYWxJc3N1ZXMgPSBhd2FpdCB0aGlzLmlzc3VlUmVwb3NpdG9yeS5jb3VudCh7XHJcbiAgICAgIHdoZXJlOiB7XHJcbiAgICAgICAgcHJpb3JpdHk6IFwiY3JpdGljYWxcIixcclxuICAgICAgICBzdGF0dXM6IFwib3BlblwiLFxyXG4gICAgICB9LFxyXG4gICAgfSlcclxuXHJcbiAgICAvLyBHZXQgdG9wIGlzc3Vlc1xyXG4gICAgY29uc3QgdG9wSXNzdWVzID0gYXdhaXQgdGhpcy5pc3N1ZVJlcG9zaXRvcnkuZmluZCh7XHJcbiAgICAgIHdoZXJlOiB7XHJcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZShzdGFydERhdGUuZ2V0VGltZSgpKSxcclxuICAgICAgfSxcclxuICAgICAgb3JkZXI6IHsgb2NjdXJyZW5jZUNvdW50OiBcIkRFU0NcIiB9LFxyXG4gICAgICB0YWtlOiAxMCxcclxuICAgIH0pXHJcblxyXG4gICAgLy8gR2V0IG1ldHJpYyB0cmVuZHNcclxuICAgIGNvbnN0IG1ldHJpY1RyZW5kcyA9IGF3YWl0IHRoaXMuZ2V0TWV0cmljVHJlbmRzKHN0YXJ0RGF0ZSwgZW5kRGF0ZSlcclxuXHJcbiAgICAvLyBHZW5lcmF0ZSByZWNvbW1lbmRhdGlvbnNcclxuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9ucyA9IHRoaXMuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMob3ZlcmFsbFNjb3JlLCBjYXRlZ29yeVNjb3JlcywgY3JpdGljYWxJc3N1ZXMpXHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VtbWFyeToge1xyXG4gICAgICAgIHJlcG9ydFBlcmlvZDoge1xyXG4gICAgICAgICAgc3RhcnREYXRlOiBzdGFydERhdGUudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgIGVuZERhdGU6IGVuZERhdGUudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIG92ZXJhbGxTY29yZSxcclxuICAgICAgICB0b3RhbElzc3VlcyxcclxuICAgICAgICByZXNvbHZlZElzc3VlcyxcclxuICAgICAgICBjcml0aWNhbElzc3VlcyxcclxuICAgICAgICByZXNvbHV0aW9uUmF0ZTogdG90YWxJc3N1ZXMgPiAwID8gKHJlc29sdmVkSXNzdWVzIC8gdG90YWxJc3N1ZXMpICogMTAwIDogMTAwLFxyXG4gICAgICB9LFxyXG4gICAgICBtZXRyaWNzOiB7XHJcbiAgICAgICAgY2F0ZWdvcnlTY29yZXMsXHJcbiAgICAgICAgdHJlbmRzOiBtZXRyaWNUcmVuZHMsXHJcbiAgICAgICAgdG9wUGVyZm9ybWluZ0NhdGVnb3JpZXM6IHRoaXMuZ2V0VG9wQ2F0ZWdvcmllcyhjYXRlZ29yeVNjb3JlcywgdHJ1ZSksXHJcbiAgICAgICAgdW5kZXJQZXJmb3JtaW5nQ2F0ZWdvcmllczogdGhpcy5nZXRUb3BDYXRlZ29yaWVzKGNhdGVnb3J5U2NvcmVzLCBmYWxzZSksXHJcbiAgICAgIH0sXHJcbiAgICAgIGlzc3Vlczoge1xyXG4gICAgICAgIHRvcElzc3VlczogdG9wSXNzdWVzLm1hcCgoaXNzdWUpID0+ICh7XHJcbiAgICAgICAgICBpZDogaXNzdWUuaWQsXHJcbiAgICAgICAgICB0aXRsZTogaXNzdWUudGl0bGUsXHJcbiAgICAgICAgICBwcmlvcml0eTogaXNzdWUucHJpb3JpdHksXHJcbiAgICAgICAgICBvY2N1cnJlbmNlQ291bnQ6IGlzc3VlLm9jY3VycmVuY2VDb3VudCxcclxuICAgICAgICAgIGVudGl0eVR5cGU6IGlzc3VlLmVudGl0eVR5cGUsXHJcbiAgICAgICAgfSkpLFxyXG4gICAgICAgIGlzc3Vlc0J5Q2F0ZWdvcnk6IGF3YWl0IHRoaXMuZ2V0SXNzdWVzQnlDYXRlZ29yeShzdGFydERhdGUsIGVuZERhdGUpLFxyXG4gICAgICAgIGlzc3Vlc0J5UHJpb3JpdHk6IGF3YWl0IHRoaXMuZ2V0SXNzdWVzQnlQcmlvcml0eShzdGFydERhdGUsIGVuZERhdGUpLFxyXG4gICAgICB9LFxyXG4gICAgICByZWNvbW1lbmRhdGlvbnM6IHtcclxuICAgICAgICBpbW1lZGlhdGU6IHJlY29tbWVuZGF0aW9ucy5pbW1lZGlhdGUsXHJcbiAgICAgICAgc2hvcnRUZXJtOiByZWNvbW1lbmRhdGlvbnMuc2hvcnRUZXJtLFxyXG4gICAgICAgIGxvbmdUZXJtOiByZWNvbW1lbmRhdGlvbnMubG9uZ1Rlcm0sXHJcbiAgICAgIH0sXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGNhbGN1bGF0ZU92ZXJhbGxTY29yZShzdGFydERhdGU6IERhdGUsIGVuZERhdGU6IERhdGUpOiBQcm9taXNlPG51bWJlcj4ge1xyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5tZXRyaWNSZXBvc2l0b3J5XHJcbiAgICAgIC5jcmVhdGVRdWVyeUJ1aWxkZXIoXCJtZXRyaWNcIilcclxuICAgICAgLnNlbGVjdChcIkFWRyhtZXRyaWMudmFsdWUpXCIsIFwiYXZnU2NvcmVcIilcclxuICAgICAgLndoZXJlKFwibWV0cmljLnRpbWVzdGFtcCA+PSA6c3RhcnREYXRlXCIsIHsgc3RhcnREYXRlIH0pXHJcbiAgICAgIC5hbmRXaGVyZShcIm1ldHJpYy50aW1lc3RhbXAgPD0gOmVuZERhdGVcIiwgeyBlbmREYXRlIH0pXHJcbiAgICAgIC5nZXRSYXdPbmUoKVxyXG5cclxuICAgIHJldHVybiBOdW1iZXIucGFyc2VGbG9hdChyZXN1bHQuYXZnU2NvcmUpIHx8IDBcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgY2FsY3VsYXRlQ2F0ZWdvcnlTY29yZXMoc3RhcnREYXRlOiBEYXRlLCBlbmREYXRlOiBEYXRlKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XHJcbiAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgdGhpcy5tZXRyaWNSZXBvc2l0b3J5XHJcbiAgICAgIC5jcmVhdGVRdWVyeUJ1aWxkZXIoXCJtZXRyaWNcIilcclxuICAgICAgLnNlbGVjdChcIm1ldHJpYy5tZXRyaWNDYXRlZ29yeVwiLCBcImNhdGVnb3J5XCIpXHJcbiAgICAgIC5hZGRTZWxlY3QoXCJBVkcobWV0cmljLnZhbHVlKVwiLCBcImF2Z1Njb3JlXCIpXHJcbiAgICAgIC53aGVyZShcIm1ldHJpYy50aW1lc3RhbXAgPj0gOnN0YXJ0RGF0ZVwiLCB7IHN0YXJ0RGF0ZSB9KVxyXG4gICAgICAuYW5kV2hlcmUoXCJtZXRyaWMudGltZXN0YW1wIDw9IDplbmREYXRlXCIsIHsgZW5kRGF0ZSB9KVxyXG4gICAgICAuZ3JvdXBCeShcIm1ldHJpYy5tZXRyaWNDYXRlZ29yeVwiKVxyXG4gICAgICAuZ2V0UmF3TWFueSgpXHJcblxyXG4gICAgY29uc3QgY2F0ZWdvcnlTY29yZXM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fVxyXG4gICAgZm9yIChjb25zdCByZXN1bHQgb2YgcmVzdWx0cykge1xyXG4gICAgICBjYXRlZ29yeVNjb3Jlc1tyZXN1bHQuY2F0ZWdvcnldID0gTnVtYmVyLnBhcnNlRmxvYXQocmVzdWx0LmF2Z1Njb3JlKSB8fCAwXHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGNhdGVnb3J5U2NvcmVzXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGdldE1ldHJpY1RyZW5kcyhcclxuICAgIHN0YXJ0RGF0ZTogRGF0ZSxcclxuICAgIGVuZERhdGU6IERhdGUsXHJcbiAgKTogUHJvbWlzZTxcclxuICAgIEFycmF5PHtcclxuICAgICAgZGF0ZTogc3RyaW5nXHJcbiAgICAgIGNhdGVnb3J5OiBzdHJpbmdcclxuICAgICAgc2NvcmU6IG51bWJlclxyXG4gICAgfT5cclxuICA+IHtcclxuICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCB0aGlzLm1ldHJpY1JlcG9zaXRvcnlcclxuICAgICAgLmNyZWF0ZVF1ZXJ5QnVpbGRlcihcIm1ldHJpY1wiKVxyXG4gICAgICAuc2VsZWN0KFwiREFURShtZXRyaWMudGltZXN0YW1wKVwiLCBcImRhdGVcIilcclxuICAgICAgLmFkZFNlbGVjdChcIm1ldHJpYy5tZXRyaWNDYXRlZ29yeVwiLCBcImNhdGVnb3J5XCIpXHJcbiAgICAgIC5hZGRTZWxlY3QoXCJBVkcobWV0cmljLnZhbHVlKVwiLCBcInNjb3JlXCIpXHJcbiAgICAgIC53aGVyZShcIm1ldHJpYy50aW1lc3RhbXAgPj0gOnN0YXJ0RGF0ZVwiLCB7IHN0YXJ0RGF0ZSB9KVxyXG4gICAgICAuYW5kV2hlcmUoXCJtZXRyaWMudGltZXN0YW1wIDw9IDplbmREYXRlXCIsIHsgZW5kRGF0ZSB9KVxyXG4gICAgICAuZ3JvdXBCeShcIkRBVEUobWV0cmljLnRpbWVzdGFtcCksIG1ldHJpYy5tZXRyaWNDYXRlZ29yeVwiKVxyXG4gICAgICAub3JkZXJCeShcIkRBVEUobWV0cmljLnRpbWVzdGFtcClcIiwgXCJBU0NcIilcclxuICAgICAgLmdldFJhd01hbnkoKVxyXG5cclxuICAgIHJldHVybiByZXN1bHRzLm1hcCgocmVzdWx0KSA9PiAoe1xyXG4gICAgICBkYXRlOiByZXN1bHQuZGF0ZSxcclxuICAgICAgY2F0ZWdvcnk6IHJlc3VsdC5jYXRlZ29yeSxcclxuICAgICAgc2NvcmU6IE51bWJlci5wYXJzZUZsb2F0KHJlc3VsdC5zY29yZSkgfHwgMCxcclxuICAgIH0pKVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRUb3BDYXRlZ29yaWVzKFxyXG4gICAgY2F0ZWdvcnlTY29yZXM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4sXHJcbiAgICB0b3BQZXJmb3JtaW5nOiBib29sZWFuLFxyXG4gICk6IEFycmF5PHtcclxuICAgIGNhdGVnb3J5OiBzdHJpbmdcclxuICAgIHNjb3JlOiBudW1iZXJcclxuICB9PiB7XHJcbiAgICBjb25zdCBzb3J0ZWQgPSBPYmplY3QuZW50cmllcyhjYXRlZ29yeVNjb3JlcylcclxuICAgICAgLm1hcCgoW2NhdGVnb3J5LCBzY29yZV0pID0+ICh7IGNhdGVnb3J5LCBzY29yZSB9KSlcclxuICAgICAgLnNvcnQoKGEsIGIpID0+ICh0b3BQZXJmb3JtaW5nID8gYi5zY29yZSAtIGEuc2NvcmUgOiBhLnNjb3JlIC0gYi5zY29yZSkpXHJcblxyXG4gICAgcmV0dXJuIHNvcnRlZC5zbGljZSgwLCAzKVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBnZXRJc3N1ZXNCeUNhdGVnb3J5KHN0YXJ0RGF0ZTogRGF0ZSwgZW5kRGF0ZTogRGF0ZSk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xyXG4gICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHRoaXMuaXNzdWVSZXBvc2l0b3J5XHJcbiAgICAgIC5jcmVhdGVRdWVyeUJ1aWxkZXIoXCJpc3N1ZVwiKVxyXG4gICAgICAuc2VsZWN0KFwiaXNzdWUuZW50aXR5VHlwZVwiLCBcImNhdGVnb3J5XCIpXHJcbiAgICAgIC5hZGRTZWxlY3QoXCJDT1VOVCgqKVwiLCBcImNvdW50XCIpXHJcbiAgICAgIC53aGVyZShcImlzc3VlLmNyZWF0ZWRBdCA+PSA6c3RhcnREYXRlXCIsIHsgc3RhcnREYXRlIH0pXHJcbiAgICAgIC5hbmRXaGVyZShcImlzc3VlLmNyZWF0ZWRBdCA8PSA6ZW5kRGF0ZVwiLCB7IGVuZERhdGUgfSlcclxuICAgICAgLmdyb3VwQnkoXCJpc3N1ZS5lbnRpdHlUeXBlXCIpXHJcbiAgICAgIC5nZXRSYXdNYW55KClcclxuXHJcbiAgICBjb25zdCBpc3N1ZXNCeUNhdGVnb3J5OiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge31cclxuICAgIGZvciAoY29uc3QgcmVzdWx0IG9mIHJlc3VsdHMpIHtcclxuICAgICAgaXNzdWVzQnlDYXRlZ29yeVtyZXN1bHQuY2F0ZWdvcnldID0gTnVtYmVyLnBhcnNlSW50KHJlc3VsdC5jb3VudClcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gaXNzdWVzQnlDYXRlZ29yeVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBnZXRJc3N1ZXNCeVByaW9yaXR5KHN0YXJ0RGF0ZTogRGF0ZSwgZW5kRGF0ZTogRGF0ZSk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xyXG4gICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHRoaXMuaXNzdWVSZXBvc2l0b3J5XHJcbiAgICAgIC5jcmVhdGVRdWVyeUJ1aWxkZXIoXCJpc3N1ZVwiKVxyXG4gICAgICAuc2VsZWN0KFwiaXNzdWUucHJpb3JpdHlcIiwgXCJwcmlvcml0eVwiKVxyXG4gICAgICAuYWRkU2VsZWN0KFwiQ09VTlQoKilcIiwgXCJjb3VudFwiKVxyXG4gICAgICAud2hlcmUoXCJpc3N1ZS5jcmVhdGVkQXQgPj0gOnN0YXJ0RGF0ZVwiLCB7IHN0YXJ0RGF0ZSB9KVxyXG4gICAgICAuYW5kV2hlcmUoXCJpc3N1ZS5jcmVhdGVkQXQgPD0gOmVuZERhdGVcIiwgeyBlbmREYXRlIH0pXHJcbiAgICAgIC5ncm91cEJ5KFwiaXNzdWUucHJpb3JpdHlcIilcclxuICAgICAgLmdldFJhd01hbnkoKVxyXG5cclxuICAgIGNvbnN0IGlzc3Vlc0J5UHJpb3JpdHk6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fVxyXG4gICAgZm9yIChjb25zdCByZXN1bHQgb2YgcmVzdWx0cykge1xyXG4gICAgICBpc3N1ZXNCeVByaW9yaXR5W3Jlc3VsdC5wcmlvcml0eV0gPSBOdW1iZXIucGFyc2VJbnQocmVzdWx0LmNvdW50KVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBpc3N1ZXNCeVByaW9yaXR5XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdlbmVyYXRlUmVjb21tZW5kYXRpb25zKFxyXG4gICAgb3ZlcmFsbFNjb3JlOiBudW1iZXIsXHJcbiAgICBjYXRlZ29yeVNjb3JlczogUmVjb3JkPHN0cmluZywgbnVtYmVyPixcclxuICAgIGNyaXRpY2FsSXNzdWVzOiBudW1iZXIsXHJcbiAgKToge1xyXG4gICAgaW1tZWRpYXRlOiBzdHJpbmdbXVxyXG4gICAgc2hvcnRUZXJtOiBzdHJpbmdbXVxyXG4gICAgbG9uZ1Rlcm06IHN0cmluZ1tdXHJcbiAgfSB7XHJcbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbnMgPSB7XHJcbiAgICAgIGltbWVkaWF0ZTogW10sXHJcbiAgICAgIHNob3J0VGVybTogW10sXHJcbiAgICAgIGxvbmdUZXJtOiBbXSxcclxuICAgIH1cclxuXHJcbiAgICAvLyBJbW1lZGlhdGUgcmVjb21tZW5kYXRpb25zXHJcbiAgICBpZiAoY3JpdGljYWxJc3N1ZXMgPiAwKSB7XHJcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5pbW1lZGlhdGUucHVzaChgQWRkcmVzcyAke2NyaXRpY2FsSXNzdWVzfSBjcml0aWNhbCBkYXRhIHF1YWxpdHkgaXNzdWVzIGltbWVkaWF0ZWx5YClcclxuICAgIH1cclxuXHJcbiAgICBpZiAob3ZlcmFsbFNjb3JlIDwgNzApIHtcclxuICAgICAgcmVjb21tZW5kYXRpb25zLmltbWVkaWF0ZS5wdXNoKFwiT3ZlcmFsbCBkYXRhIHF1YWxpdHkgc2NvcmUgaXMgYmVsb3cgYWNjZXB0YWJsZSB0aHJlc2hvbGQgKDcwJSlcIilcclxuICAgIH1cclxuXHJcbiAgICAvLyBTaG9ydC10ZXJtIHJlY29tbWVuZGF0aW9uc1xyXG4gICAgY29uc3QgdW5kZXJQZXJmb3JtaW5nQ2F0ZWdvcmllcyA9IE9iamVjdC5lbnRyaWVzKGNhdGVnb3J5U2NvcmVzKVxyXG4gICAgICAuZmlsdGVyKChbLCBzY29yZV0pID0+IHNjb3JlIDwgODApXHJcbiAgICAgIC5tYXAoKFtjYXRlZ29yeV0pID0+IGNhdGVnb3J5KVxyXG5cclxuICAgIGlmICh1bmRlclBlcmZvcm1pbmdDYXRlZ29yaWVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgcmVjb21tZW5kYXRpb25zLnNob3J0VGVybS5wdXNoKGBGb2N1cyBvbiBpbXByb3ZpbmcgJHt1bmRlclBlcmZvcm1pbmdDYXRlZ29yaWVzLmpvaW4oXCIsIFwiKX0gY2F0ZWdvcmllc2ApXHJcbiAgICB9XHJcblxyXG4gICAgcmVjb21tZW5kYXRpb25zLnNob3J0VGVybS5wdXNoKFwiSW1wbGVtZW50IGF1dG9tYXRlZCBkYXRhIHF1YWxpdHkgbW9uaXRvcmluZ1wiKVxyXG4gICAgcmVjb21tZW5kYXRpb25zLnNob3J0VGVybS5wdXNoKFwiRXN0YWJsaXNoIGRhdGEgcXVhbGl0eSBTTEFzIGFuZCB0aHJlc2hvbGRzXCIpXHJcblxyXG4gICAgLy8gTG9uZy10ZXJtIHJlY29tbWVuZGF0aW9uc1xyXG4gICAgcmVjb21tZW5kYXRpb25zLmxvbmdUZXJtLnB1c2goXCJEZXZlbG9wIGNvbXByZWhlbnNpdmUgZGF0YSBnb3Zlcm5hbmNlIGZyYW1ld29ya1wiKVxyXG4gICAgcmVjb21tZW5kYXRpb25zLmxvbmdUZXJtLnB1c2goXCJJbXBsZW1lbnQgZGF0YSBxdWFsaXR5IHRyYWluaW5nIGZvciBkYXRhIHN0ZXdhcmRzXCIpXHJcbiAgICByZWNvbW1lbmRhdGlvbnMubG9uZ1Rlcm0ucHVzaChcIkVzdGFibGlzaCBkYXRhIHF1YWxpdHkgbWV0cmljcyBhbmQgS1BJc1wiKVxyXG4gICAgcmVjb21tZW5kYXRpb25zLmxvbmdUZXJtLnB1c2goXCJDcmVhdGUgZGF0YSBxdWFsaXR5IGRhc2hib2FyZCBmb3Igc3Rha2Vob2xkZXJzXCIpXHJcblxyXG4gICAgcmV0dXJuIHJlY29tbWVuZGF0aW9uc1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0UmVwb3J0cyhmaWx0ZXJzOiB7XHJcbiAgICByZXBvcnRUeXBlPzogUmVwb3J0VHlwZVxyXG4gICAgc3RhdHVzPzogUmVwb3J0U3RhdHVzXHJcbiAgICBzdGFydERhdGU/OiBEYXRlXHJcbiAgICBlbmREYXRlPzogRGF0ZVxyXG4gIH0pOiBQcm9taXNlPERhdGFRdWFsaXR5UmVwb3J0W10+IHtcclxuICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy5yZXBvcnRSZXBvc2l0b3J5LmNyZWF0ZVF1ZXJ5QnVpbGRlcihcInJlcG9ydFwiKVxyXG5cclxuICAgIGlmIChmaWx0ZXJzLnJlcG9ydFR5cGUpIHtcclxuICAgICAgcXVlcnkuYW5kV2hlcmUoXCJyZXBvcnQucmVwb3J0VHlwZSA9IDpyZXBvcnRUeXBlXCIsIHsgcmVwb3J0VHlwZTogZmlsdGVycy5yZXBvcnRUeXBlIH0pXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGZpbHRlcnMuc3RhdHVzKSB7XHJcbiAgICAgIHF1ZXJ5LmFuZFdoZXJlKFwicmVwb3J0LnN0YXR1cyA9IDpzdGF0dXNcIiwgeyBzdGF0dXM6IGZpbHRlcnMuc3RhdHVzIH0pXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGZpbHRlcnMuc3RhcnREYXRlKSB7XHJcbiAgICAgIHF1ZXJ5LmFuZFdoZXJlKFwicmVwb3J0LmNyZWF0ZWRBdCA+PSA6c3RhcnREYXRlXCIsIHsgc3RhcnREYXRlOiBmaWx0ZXJzLnN0YXJ0RGF0ZSB9KVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChmaWx0ZXJzLmVuZERhdGUpIHtcclxuICAgICAgcXVlcnkuYW5kV2hlcmUoXCJyZXBvcnQuY3JlYXRlZEF0IDw9IDplbmREYXRlXCIsIHsgZW5kRGF0ZTogZmlsdGVycy5lbmREYXRlIH0pXHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHF1ZXJ5Lm9yZGVyQnkoXCJyZXBvcnQuY3JlYXRlZEF0XCIsIFwiREVTQ1wiKS5nZXRNYW55KClcclxuICB9XHJcblxyXG4gIEBDcm9uKENyb25FeHByZXNzaW9uLkVWRVJZX0RBWV9BVF9NSUROSUdIVClcclxuICBhc3luYyBnZW5lcmF0ZURhaWx5UmVwb3J0KCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgdGhpcy5sb2dnZXIubG9nKFwiR2VuZXJhdGluZyBkYWlseSBkYXRhIHF1YWxpdHkgcmVwb3J0XCIpXHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZW5kRGF0ZSA9IG5ldyBEYXRlKClcclxuICAgICAgY29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoKVxyXG4gICAgICBzdGFydERhdGUuc2V0RGF0ZShzdGFydERhdGUuZ2V0RGF0ZSgpIC0gMSlcclxuXHJcbiAgICAgIGF3YWl0IHRoaXMuZ2VuZXJhdGVSZXBvcnQoUmVwb3J0VHlwZS5EQUlMWSwgc3RhcnREYXRlLCBlbmREYXRlKVxyXG4gICAgICB0aGlzLmxvZ2dlci5sb2coXCJEYWlseSByZXBvcnQgZ2VuZXJhdGVkIHN1Y2Nlc3NmdWxseVwiKVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYERhaWx5IHJlcG9ydCBnZW5lcmF0aW9uIGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWAsIGVycm9yLnN0YWNrKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgQENyb24oQ3JvbkV4cHJlc3Npb24uRVZFUllfV0VFSylcclxuICBhc3luYyBnZW5lcmF0ZVdlZWtseVJlcG9ydCgpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHRoaXMubG9nZ2VyLmxvZyhcIkdlbmVyYXRpbmcgd2Vla2x5IGRhdGEgcXVhbGl0eSByZXBvcnRcIilcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBlbmREYXRlID0gbmV3IERhdGUoKVxyXG4gICAgICBjb25zdCBzdGFydERhdGUgPSBuZXcgRGF0ZSgpXHJcbiAgICAgIHN0YXJ0RGF0ZS5zZXREYXRlKHN0YXJ0RGF0ZS5nZXREYXRlKCkgLSA3KVxyXG5cclxuICAgICAgYXdhaXQgdGhpcy5nZW5lcmF0ZVJlcG9ydChSZXBvcnRUeXBlLldFRUtMWSwgc3RhcnREYXRlLCBlbmREYXRlKVxyXG4gICAgICB0aGlzLmxvZ2dlci5sb2coXCJXZWVrbHkgcmVwb3J0IGdlbmVyYXRlZCBzdWNjZXNzZnVsbHlcIilcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKGBXZWVrbHkgcmVwb3J0IGdlbmVyYXRpb24gZmFpbGVkOiAke2Vycm9yLm1lc3NhZ2V9YCwgZXJyb3Iuc3RhY2spXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBAQ3JvbihDcm9uRXhwcmVzc2lvbi5FVkVSWV8xU1RfREFZX09GX01PTlRIX0FUX01JRE5JR0hUKVxyXG4gIGFzeW5jIGdlbmVyYXRlTW9udGhseVJlcG9ydCgpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHRoaXMubG9nZ2VyLmxvZyhcIkdlbmVyYXRpbmcgbW9udGhseSBkYXRhIHF1YWxpdHkgcmVwb3J0XCIpXHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZW5kRGF0ZSA9IG5ldyBEYXRlKClcclxuICAgICAgY29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoKVxyXG4gICAgICBzdGFydERhdGUuc2V0TW9udGgoc3RhcnREYXRlLmdldE1vbnRoKCkgLSAxKVxyXG5cclxuICAgICAgYXdhaXQgdGhpcy5nZW5lcmF0ZVJlcG9ydChSZXBvcnRUeXBlLk1PTlRITFksIHN0YXJ0RGF0ZSwgZW5kRGF0ZSlcclxuICAgICAgdGhpcy5sb2dnZXIubG9nKFwiTW9udGhseSByZXBvcnQgZ2VuZXJhdGVkIHN1Y2Nlc3NmdWxseVwiKVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYE1vbnRobHkgcmVwb3J0IGdlbmVyYXRpb24gZmFpbGVkOiAke2Vycm9yLm1lc3NhZ2V9YCwgZXJyb3Iuc3RhY2spXHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdLCJ2ZXJzaW9uIjozfQ==