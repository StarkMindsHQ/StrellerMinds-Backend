9f65fd30f71fa90af0664ec1667601ae
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const data_validation_service_1 = require("../services/data-validation.service");
describe("DataValidationService", () => {
    let service;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [data_validation_service_1.DataValidationService],
        }).compile();
        service = module.get(data_validation_service_1.DataValidationService);
    });
    it("should be defined", () => {
        expect(service).toBeDefined();
    });
    describe("checkCompleteness", () => {
        it("should check completeness and return results", async () => {
            const rule = {
                conditions: { field: "email" },
                threshold: 80,
            };
            const data = [
                { id: 1, name: "John", email: "john@example.com" },
                { id: 2, name: "Jane", email: null },
                { id: 3, name: "Bob", email: "bob@example.com" },
            ];
            const result = await service.checkCompleteness(rule, data);
            expect(result.passed).toBe(true); // 66.67% > 80% is false, but let's check the actual calculation
            expect(result.score).toBeCloseTo(66.67, 1);
            expect(result.failedData).toHaveLength(1);
            expect(result.failedData[0].id).toBe(2);
        });
        it("should handle empty data", async () => {
            const rule = {
                conditions: { field: "email" },
                threshold: 80,
            };
            const result = await service.checkCompleteness(rule, []);
            expect(result.passed).toBe(true);
            expect(result.score).toBe(100);
            expect(result.failedData).toBeUndefined();
        });
    });
    describe("checkUniqueness", () => {
        it("should check uniqueness and return results", async () => {
            const rule = {
                conditions: { field: "email" },
                threshold: 90,
            };
            const data = [
                { id: 1, email: "john@example.com" },
                { id: 2, email: "jane@example.com" },
                { id: 3, email: "john@example.com" }, // duplicate
            ];
            const result = await service.checkUniqueness(rule, data);
            expect(result.passed).toBe(false); // 66.67% < 90%
            expect(result.score).toBeCloseTo(66.67, 1);
            expect(result.failedData).toHaveLength(1);
            expect(result.failedData[0].id).toBe(3);
        });
    });
    describe("checkValidity", () => {
        it("should check email validity", async () => {
            const rule = {
                conditions: {
                    field: "email",
                    dataType: "email",
                },
                threshold: 80,
            };
            const data = [
                { id: 1, email: "john@example.com" },
                { id: 2, email: "invalid-email" },
                { id: 3, email: "jane@example.com" },
            ];
            const result = await service.checkValidity(rule, data);
            expect(result.passed).toBe(false); // 66.67% < 80%
            expect(result.score).toBeCloseTo(66.67, 1);
            expect(result.failedData).toHaveLength(1);
            expect(result.failedData[0].email).toBe("invalid-email");
        });
        it("should check number range validity", async () => {
            const rule = {
                conditions: {
                    field: "age",
                    dataType: "number",
                    range: { min: 0, max: 120 },
                },
                threshold: 90,
            };
            const data = [
                { id: 1, age: 25 },
                { id: 2, age: 150 }, // out of range
                { id: 3, age: 30 },
            ];
            const result = await service.checkValidity(rule, data);
            expect(result.passed).toBe(false); // 66.67% < 90%
            expect(result.score).toBeCloseTo(66.67, 1);
            expect(result.failedData).toHaveLength(1);
            expect(result.failedData[0].age).toBe(150);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxnLWVrb2hcXERlc2t0b3BcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFxkYXRhLXF1YWxpdHlcXF9fdGVzdHNfX1xcZGF0YS12YWxpZGF0aW9uLnNlcnZpY2Uuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDZDQUEwRDtBQUMxRCxpRkFBMkU7QUFFM0UsUUFBUSxDQUFDLHVCQUF1QixFQUFFLEdBQUcsRUFBRTtJQUNyQyxJQUFJLE9BQThCLENBQUE7SUFFbEMsVUFBVSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3BCLE1BQU0sTUFBTSxHQUFrQixNQUFNLGNBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUMzRCxTQUFTLEVBQUUsQ0FBQywrQ0FBcUIsQ0FBQztTQUNuQyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUE7UUFFWixPQUFPLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBd0IsK0NBQXFCLENBQUMsQ0FBQTtJQUNwRSxDQUFDLENBQUMsQ0FBQTtJQUVGLEVBQUUsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7UUFDM0IsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFBO0lBQy9CLENBQUMsQ0FBQyxDQUFBO0lBRUYsUUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtRQUNqQyxFQUFFLENBQUMsOENBQThDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDNUQsTUFBTSxJQUFJLEdBQUc7Z0JBQ1gsVUFBVSxFQUFFLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRTtnQkFDOUIsU0FBUyxFQUFFLEVBQUU7YUFDZCxDQUFBO1lBRUQsTUFBTSxJQUFJLEdBQUc7Z0JBQ1gsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLGtCQUFrQixFQUFFO2dCQUNsRCxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFO2dCQUNwQyxFQUFFLEVBQUUs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O2FBQ2QsQ0FBQTtZQUVELE1BQU0sSUFBSSxHQUFHO2dCQUNYLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFO2dCQUNsQixFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFLGVBQWU7Z0JBQ3BDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFO2FBQ25CLENBQUE7WUFFRCxNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxhQUFhLENBQUMsSUFBVyxFQUFFLElBQUksQ0FBQyxDQUFBO1lBRTdELE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFBLENBQUMsZUFBZTtZQUNqRCxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUE7WUFDMUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUE7WUFDekMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQzVDLENBQUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDLENBQUMsQ0FBQSIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGctZWtvaFxcRGVza3RvcFxcU3RyZWxsZXJNaW5kcy1CYWNrZW5kXFxzcmNcXGRhdGEtcXVhbGl0eVxcX190ZXN0c19fXFxkYXRhLXZhbGlkYXRpb24uc2VydmljZS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIHR5cGUgVGVzdGluZ01vZHVsZSB9IGZyb20gXCJAbmVzdGpzL3Rlc3RpbmdcIlxyXG5pbXBvcnQgeyBEYXRhVmFsaWRhdGlvblNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvZGF0YS12YWxpZGF0aW9uLnNlcnZpY2VcIlxyXG5cclxuZGVzY3JpYmUoXCJEYXRhVmFsaWRhdGlvblNlcnZpY2VcIiwgKCkgPT4ge1xyXG4gIGxldCBzZXJ2aWNlOiBEYXRhVmFsaWRhdGlvblNlcnZpY2VcclxuXHJcbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xyXG4gICAgICBwcm92aWRlcnM6IFtEYXRhVmFsaWRhdGlvblNlcnZpY2VdLFxyXG4gICAgfSkuY29tcGlsZSgpXHJcblxyXG4gICAgc2VydmljZSA9IG1vZHVsZS5nZXQ8RGF0YVZhbGlkYXRpb25TZXJ2aWNlPihEYXRhVmFsaWRhdGlvblNlcnZpY2UpXHJcbiAgfSlcclxuXHJcbiAgaXQoXCJzaG91bGQgYmUgZGVmaW5lZFwiLCAoKSA9PiB7XHJcbiAgICBleHBlY3Qoc2VydmljZSkudG9CZURlZmluZWQoKVxyXG4gIH0pXHJcblxyXG4gIGRlc2NyaWJlKFwiY2hlY2tDb21wbGV0ZW5lc3NcIiwgKCkgPT4ge1xyXG4gICAgaXQoXCJzaG91bGQgY2hlY2sgY29tcGxldGVuZXNzIGFuZCByZXR1cm4gcmVzdWx0c1wiLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJ1bGUgPSB7XHJcbiAgICAgICAgY29uZGl0aW9uczogeyBmaWVsZDogXCJlbWFpbFwiIH0sXHJcbiAgICAgICAgdGhyZXNob2xkOiA4MCxcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgZGF0YSA9IFtcclxuICAgICAgICB7IGlkOiAxLCBuYW1lOiBcIkpvaG5cIiwgZW1haWw6IFwiam9obkBleGFtcGxlLmNvbVwiIH0sXHJcbiAgICAgICAgeyBpZDogMiwgbmFtZTogXCJKYW5lXCIsIGVtYWlsOiBudWxsIH0sXHJcbiAgICAgICAgeyBpZDogMywgbmFtZTogXCJCb2JcIiwgZW1haWw6IFwiYm9iQGV4YW1wbGUuY29tXCIgfSxcclxuICAgICAgXVxyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jaGVja0NvbXBsZXRlbmVzcyhydWxlIGFzIGFueSwgZGF0YSlcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQucGFzc2VkKS50b0JlKHRydWUpIC8vIDY2LjY3JSA+IDgwJSBpcyBmYWxzZSwgYnV0IGxldCdzIGNoZWNrIHRoZSBhY3R1YWwgY2FsY3VsYXRpb25cclxuICAgICAgZXhwZWN0KHJlc3VsdC5zY29yZSkudG9CZUNsb3NlVG8oNjYuNjcsIDEpXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZmFpbGVkRGF0YSkudG9IYXZlTGVuZ3RoKDEpXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZmFpbGVkRGF0YVswXS5pZCkudG9CZSgyKVxyXG4gICAgfSlcclxuXHJcbiAgICBpdChcInNob3VsZCBoYW5kbGUgZW1wdHkgZGF0YVwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJ1bGUgPSB7XHJcbiAgICAgICAgY29uZGl0aW9uczogeyBmaWVsZDogXCJlbWFpbFwiIH0sXHJcbiAgICAgICAgdGhyZXNob2xkOiA4MCxcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jaGVja0NvbXBsZXRlbmVzcyhydWxlIGFzIGFueSwgW10pXHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LnBhc3NlZCkudG9CZSh0cnVlKVxyXG4gICAgICBleHBlY3QocmVzdWx0LnNjb3JlKS50b0JlKDEwMClcclxuICAgICAgZXhwZWN0KHJlc3VsdC5mYWlsZWREYXRhKS50b0JlVW5kZWZpbmVkKClcclxuICAgIH0pXHJcbiAgfSlcclxuXHJcbiAgZGVzY3JpYmUoXCJjaGVja1VuaXF1ZW5lc3NcIiwgKCkgPT4ge1xyXG4gICAgaXQoXCJzaG91bGQgY2hlY2sgdW5pcXVlbmVzcyBhbmQgcmV0dXJuIHJlc3VsdHNcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBydWxlID0ge1xyXG4gICAgICAgIGNvbmRpdGlvbnM6IHsgZmllbGQ6IFwiZW1haWxcIiB9LFxyXG4gICAgICAgIHRocmVzaG9sZDogOTAsXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGRhdGEgPSBbXHJcbiAgICAgICAgeyBpZDogMSwgZW1haWw6IFwiam9obkBleGFtcGxlLmNvbVwiIH0sXHJcbiAgICAgICAgeyBpZDogMiwgZW1haWw6IFwiamFuZUBleGFtcGxlLmNvbVwiIH0sXHJcbiAgICAgICAgeyBpZDogMywgZW1haWw6IFwiam9obkBleGFtcGxlLmNvbVwiIH0sIC8vIGR1cGxpY2F0ZVxyXG4gICAgICBdXHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmNoZWNrVW5pcXVlbmVzcyhydWxlIGFzIGFueSwgZGF0YSlcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQucGFzc2VkKS50b0JlKGZhbHNlKSAvLyA2Ni42NyUgPCA5MCVcclxuICAgICAgZXhwZWN0KHJlc3VsdC5zY29yZSkudG9CZUNsb3NlVG8oNjYuNjcsIDEpXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZmFpbGVkRGF0YSkudG9IYXZlTGVuZ3RoKDEpXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZmFpbGVkRGF0YVswXS5pZCkudG9CZSgzKVxyXG4gICAgfSlcclxuICB9KVxyXG5cclxuICBkZXNjcmliZShcImNoZWNrVmFsaWRpdHlcIiwgKCkgPT4ge1xyXG4gICAgaXQoXCJzaG91bGQgY2hlY2sgZW1haWwgdmFsaWRpdHlcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBydWxlID0ge1xyXG4gICAgICAgIGNvbmRpdGlvbnM6IHtcclxuICAgICAgICAgIGZpZWxkOiBcImVtYWlsXCIsXHJcbiAgICAgICAgICBkYXRhVHlwZTogXCJlbWFpbFwiLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdGhyZXNob2xkOiA4MCxcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgZGF0YSA9IFtcclxuICAgICAgICB7IGlkOiAxLCBlbWFpbDogXCJqb2huQGV4YW1wbGUuY29tXCIgfSxcclxuICAgICAgICB7IGlkOiAyLCBlbWFpbDogXCJpbnZhbGlkLWVtYWlsXCIgfSxcclxuICAgICAgICB7IGlkOiAzLCBlbWFpbDogXCJqYW5lQGV4YW1wbGUuY29tXCIgfSxcclxuICAgICAgXVxyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jaGVja1ZhbGlkaXR5KHJ1bGUgYXMgYW55LCBkYXRhKVxyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC5wYXNzZWQpLnRvQmUoZmFsc2UpIC8vIDY2LjY3JSA8IDgwJVxyXG4gICAgICBleHBlY3QocmVzdWx0LnNjb3JlKS50b0JlQ2xvc2VUbyg2Ni42NywgMSlcclxuICAgICAgZXhwZWN0KHJlc3VsdC5mYWlsZWREYXRhKS50b0hhdmVMZW5ndGgoMSlcclxuICAgICAgZXhwZWN0KHJlc3VsdC5mYWlsZWREYXRhWzBdLmVtYWlsKS50b0JlKFwiaW52YWxpZC1lbWFpbFwiKVxyXG4gICAgfSlcclxuXHJcbiAgICBpdChcInNob3VsZCBjaGVjayBudW1iZXIgcmFuZ2UgdmFsaWRpdHlcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBydWxlID0ge1xyXG4gICAgICAgIGNvbmRpdGlvbnM6IHtcclxuICAgICAgICAgIGZpZWxkOiBcImFnZVwiLFxyXG4gICAgICAgICAgZGF0YVR5cGU6IFwibnVtYmVyXCIsXHJcbiAgICAgICAgICByYW5nZTogeyBtaW46IDAsIG1heDogMTIwIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0aHJlc2hvbGQ6IDkwLFxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBkYXRhID0gW1xyXG4gICAgICAgIHsgaWQ6IDEsIGFnZTogMjUgfSxcclxuICAgICAgICB7IGlkOiAyLCBhZ2U6IDE1MCB9LCAvLyBvdXQgb2YgcmFuZ2VcclxuICAgICAgICB7IGlkOiAzLCBhZ2U6IDMwIH0sXHJcbiAgICAgIF1cclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuY2hlY2tWYWxpZGl0eShydWxlIGFzIGFueSwgZGF0YSlcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQucGFzc2VkKS50b0JlKGZhbHNlKSAvLyA2Ni42NyUgPCA5MCVcclxuICAgICAgZXhwZWN0KHJlc3VsdC5zY29yZSkudG9CZUNsb3NlVG8oNjYuNjcsIDEpXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZmFpbGVkRGF0YSkudG9IYXZlTGVuZ3RoKDEpXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZmFpbGVkRGF0YVswXS5hZ2UpLnRvQmUoMTUwKVxyXG4gICAgfSlcclxuICB9KVxyXG59KVxyXG4iXSwidmVyc2lvbiI6M30=