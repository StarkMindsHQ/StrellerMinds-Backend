d8f94618e09524cd771c403c3efef918
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DataQualitySeverity = exports.DataQualityRuleType = exports.DATA_QUALITY_ENTITY_KEY = exports.DATA_QUALITY_RULES_KEY = void 0;
exports.DataQualityRule = DataQualityRule;
exports.DataQualityEntity = DataQualityEntity;
exports.RequiredField = RequiredField;
exports.OptionalField = OptionalField;
exports.ValidEmail = ValidEmail;
exports.ValidString = ValidString;
exports.ValidNumber = ValidNumber;
exports.ValidDate = ValidDate;
exports.ValidUUID = ValidUUID;
exports.ValidBoolean = ValidBoolean;
exports.ValidPattern = ValidPattern;
exports.ValidEnum = ValidEnum;
exports.UniqueField = UniqueField;
exports.TimelyField = TimelyField;
exports.ConsistentWith = ConsistentWith;
exports.ValidNested = ValidNested;
exports.ValidPhoneNumber = ValidPhoneNumber;
exports.ValidURL = ValidURL;
exports.ValidCreditCard = ValidCreditCard;
exports.ValidSSN = ValidSSN;
exports.ValidIPAddress = ValidIPAddress;
const common_1 = require("@nestjs/common");
const class_validator_1 = require("class-validator");
const class_transformer_1 = require("class-transformer");
// Metadata keys for data quality rules
exports.DATA_QUALITY_RULES_KEY = 'data_quality_rules';
exports.DATA_QUALITY_ENTITY_KEY = 'data_quality_entity';
// Data quality rule types
var DataQualityRuleType;
(function (DataQualityRuleType) {
    DataQualityRuleType["COMPLETENESS"] = "completeness";
    DataQualityRuleType["ACCURACY"] = "accuracy";
    DataQualityRuleType["CONSISTENCY"] = "consistency";
    DataQualityRuleType["VALIDITY"] = "validity";
    DataQualityRuleType["UNIQUENESS"] = "uniqueness";
    DataQualityRuleType["TIMELINESS"] = "timeliness";
    DataQualityRuleType["CONFORMITY"] = "conformity";
})(DataQualityRuleType || (exports.DataQualityRuleType = DataQualityRuleType = {}));
// Data quality severity levels
var DataQualitySeverity;
(function (DataQualitySeverity) {
    DataQualitySeverity["LOW"] = "low";
    DataQualitySeverity["MEDIUM"] = "medium";
    DataQualitySeverity["HIGH"] = "high";
    DataQualitySeverity["CRITICAL"] = "critical";
})(DataQualitySeverity || (exports.DataQualitySeverity = DataQualitySeverity = {}));
// Base decorator for data quality rules
function DataQualityRule(metadata) {
    return (0, common_1.SetMetadata)(exports.DATA_QUALITY_RULES_KEY, metadata);
}
// Mark entity for data quality monitoring
function DataQualityEntity(entityType) {
    return (0, common_1.SetMetadata)(exports.DATA_QUALITY_ENTITY_KEY, entityType);
}
// Completeness decorators
function RequiredField(message, severity = DataQualitySeverity.HIGH) {
    return (0, common_1.applyDecorators)((0, class_validator_1.IsNotEmpty)({ message: message || 'Field is required' }), DataQualityRule({
        ruleType: DataQualityRuleType.COMPLETENESS,
        severity,
        threshold: 100,
        message: message || 'Field must not be empty',
    }));
}
function OptionalField() {
    return (0, class_validator_1.IsOptional)();
}
// Accuracy decorators
function ValidEmail(severity = DataQualitySeverity.HIGH) {
    return (0, common_1.applyDecorators)((0, class_validator_1.IsEmail)({}, { message: 'Must be a valid email address' }), DataQualityRule({
        ruleType: DataQualityRuleType.ACCURACY,
        severity,
        threshold: 100,
        message: 'Email format is invalid',
    }));
}
function ValidString(minLength, maxLength, severity = DataQualitySeverity.MEDIUM) {
    const decorators = [
        (0, class_validator_1.IsString)({ message: 'Must be a string' }),
        DataQualityRule({
            ruleType: DataQualityRuleType.ACCURACY,
            severity,
            threshold: 100,
            message: 'String format is invalid',
        })
    ];
    if (minLength !== undefined || maxLength !== undefined) {
        decorators.push((0, class_validator_1.Length)(minLength || 0, maxLength || 1000, {
            message: `String length must be between ${minLength || 0} and ${maxLength || 1000} characters`
        }));
    }
    return (0, common_1.applyDecorators)(...decorators);
}
function ValidNumber(min, max, severity = DataQualitySeverity.MEDIUM) {
    const decorators = [
        (0, class_validator_1.IsNumber)({}, { message: 'Must be a number' }),
        DataQualityRule({
            ruleType: DataQualityRuleType.ACCURACY,
            severity,
            threshold: 100,
            message: 'Number format is invalid',
        })
    ];
    if (min !== undefined) {
        decorators.push((0, class_validator_1.Min)(min, { message: `Number must be at least ${min}` }));
    }
    if (max !== undefined) {
        decorators.push((0, class_validator_1.Max)(max, { message: `Number must not exceed ${max}` }));
    }
    return (0, common_1.applyDecorators)(...decorators);
}
function ValidDate(severity = DataQualitySeverity.MEDIUM) {
    return (0, common_1.applyDecorators)((0, class_validator_1.IsDate)({ message: 'Must be a valid date' }), (0, class_transformer_1.Type)(() => Date), (0, class_transformer_1.Transform)(({ value }) => value instanceof Date ? value : new Date(value)), DataQualityRule({
        ruleType: DataQualityRuleType.ACCURACY,
        severity,
        threshold: 100,
        message: 'Date format is invalid',
    }));
}
function ValidUUID(severity = DataQualitySeverity.HIGH) {
    return (0, common_1.applyDecorators)((0, class_validator_1.IsUUID)('4', { message: 'Must be a valid UUID' }), DataQualityRule({
        ruleType: DataQualityRuleType.ACCURACY,
        severity,
        threshold: 100,
        message: 'UUID format is invalid',
    }));
}
function ValidBoolean(severity = DataQualitySeverity.LOW) {
    return (0, common_1.applyDecorators)((0, class_validator_1.IsBoolean)({ message: 'Must be a boolean value' }), DataQualityRule({
        ruleType: DataQualityRuleType.ACCURACY,
        severity,
        threshold: 100,
        message: 'Boolean format is invalid',
    }));
}
// Pattern matching decorator
function ValidPattern(pattern, message, severity = DataQualitySeverity.MEDIUM) {
    return (0, common_1.applyDecorators)((0, class_validator_1.Matches)(pattern, { message: message || 'Does not match required pattern' }), DataQualityRule({
        ruleType: DataQualityRuleType.CONFORMITY,
        severity,
        threshold: 100,
        message: message || 'Pattern validation failed',
        conditions: { pattern: pattern.source },
    }));
}
// Enum validation decorator
function ValidEnum(enumObject, severity = DataQualitySeverity.MEDIUM) {
    return (0, common_1.applyDecorators)((0, class_validator_1.IsEnum)(enumObject, { message: 'Must be a valid enum value' }), DataQualityRule({
        ruleType: DataQualityRuleType.VALIDITY,
        severity,
        threshold: 100,
        message: 'Enum validation failed',
        conditions: { allowedValues: Object.values(enumObject) },
    }));
}
// Uniqueness decorator (for use with custom validation)
function UniqueField(scope, severity = DataQualitySeverity.HIGH) {
    return DataQualityRule({
        ruleType: DataQualityRuleType.UNIQUENESS,
        severity,
        threshold: 100,
        message: 'Field value must be unique',
        conditions: { scope: scope || [] },
    });
}
// Timeliness decorator
function TimelyField(maxAgeHours, severity = DataQualitySeverity.MEDIUM) {
    return DataQualityRule({
        ruleType: DataQualityRuleType.TIMELINESS,
        severity,
        threshold: 100,
        message: `Field value is too old (max age: ${maxAgeHours} hours)`,
        conditions: { maxAge: maxAgeHours },
    });
}
// Consistency decorators
function ConsistentWith(relatedField, operator = 'equals', severity = DataQualitySeverity.MEDIUM) {
    return DataQualityRule({
        ruleType: DataQualityRuleType.CONSISTENCY,
        severity,
        threshold: 100,
        message: `Field must be consistent with ${relatedField}`,
        conditions: {
            rules: [{
                    field1: 'current_field',
                    field2: relatedField,
                    operator,
                }],
        },
    });
}
// Nested object validation
function ValidNested(severity = DataQualitySeverity.MEDIUM) {
    return (0, common_1.applyDecorators)((0, class_validator_1.ValidateNested)(), DataQualityRule({
        ruleType: DataQualityRuleType.CONFORMITY,
        severity,
        threshold: 100,
        message: 'Nested object validation failed',
    }));
}
// Phone number validation
function ValidPhoneNumber(severity = DataQualitySeverity.MEDIUM) {
    const phonePattern = /^[\+]?[1-9][\d]{0,15}$/;
    return (0, common_1.applyDecorators)((0, class_validator_1.Matches)(phonePattern, { message: 'Must be a valid phone number' }), DataQualityRule({
        ruleType: DataQualityRuleType.ACCURACY,
        severity,
        threshold: 100,
        message: 'Phone number format is invalid',
        conditions: { pattern: phonePattern.source },
    }));
}
// URL validation
function ValidURL(severity = DataQualitySeverity.MEDIUM) {
    const urlPattern = /^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/;
    return (0, common_1.applyDecorators)((0, class_validator_1.Matches)(urlPattern, { message: 'Must be a valid URL' }), DataQualityRule({
        ruleType: DataQualityRuleType.ACCURACY,
        severity,
        threshold: 100,
        message: 'URL format is invalid',
        conditions: { pattern: urlPattern.source },
    }));
}
// Credit card validation
function ValidCreditCard(severity = DataQualitySeverity.HIGH) {
    const ccPattern = /^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|3[47][0-9]{13}|3[0-9]{13}|6(?:011|5[0-9]{2})[0-9]{12})$/;
    return (0, common_1.applyDecorators)((0, class_validator_1.Matches)(ccPattern, { message: 'Must be a valid credit card number' }), DataQualityRule({
        ruleType: DataQualityRuleType.ACCURACY,
        severity,
        threshold: 100,
        message: 'Credit card format is invalid',
        conditions: { pattern: ccPattern.source },
    }));
}
// Social Security Number validation (US format)
function ValidSSN(severity = DataQualitySeverity.CRITICAL) {
    const ssnPattern = /^(?!666|000|9\\d{2})\\d{3}-(?!00)\\d{2}-(?!0{4})\\d{4}$/;
    return (0, common_1.applyDecorators)((0, class_validator_1.Matches)(ssnPattern, { message: 'Must be a valid SSN format (XXX-XX-XXXX)' }), DataQualityRule({
        ruleType: DataQualityRuleType.ACCURACY,
        severity,
        threshold: 100,
        message: 'SSN format is invalid',
        conditions: { pattern: ssnPattern.source },
    }));
}
// IP Address validation
function ValidIPAddress(severity = DataQualitySeverity.MEDIUM) {
    const ipPattern = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
    return (0, common_1.applyDecorators)((0, class_validator_1.Matches)(ipPattern, { message: 'Must be a valid IP address' }), DataQualityRule({
        ruleType: DataQualityRuleType.ACCURACY,
        severity,
        threshold: 100,
        message: 'IP address format is invalid',
        conditions: { pattern: ipPattern.source },
    }));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxnLWVrb2hcXERlc2t0b3BcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFxkYXRhLXF1YWxpdHlcXGRlY29yYXRvcnNcXGRhdGEtcXVhbGl0eS5kZWNvcmF0b3JzLnRzIiwibWFwcGluZ3MiOiI7OztBQXNDQSwwQ0FFQztBQUdELDhDQUVDO0FBR0Qsc0NBVUM7QUFFRCxzQ0FFQztBQUdELGdDQVVDO0FBRUQsa0NBa0JDO0FBRUQsa0NBb0JDO0FBRUQsOEJBWUM7QUFFRCw4QkFVQztBQUVELG9DQVVDO0FBR0Qsb0NBV0M7QUFHRCw4QkFXQztBQUdELGtDQVFDO0FBR0Qsa0NBUUM7QUFHRCx3Q0FjQztBQUdELGtDQVVDO0FBR0QsNENBWUM7QUFHRCw0QkFZQztBQUdELDBDQVlDO0FBR0QsNEJBWUM7QUFHRCx3Q0FZQztBQXRURCwyQ0FBOEQ7QUFDOUQscURBQW9LO0FBQ3BLLHlEQUFvRDtBQUVwRCx1Q0FBdUM7QUFDMUIsUUFBQSxzQkFBc0IsR0FBRyxvQkFBb0IsQ0FBQztBQUM5QyxRQUFBLHVCQUF1QixHQUFHLHFCQUFxQixDQUFDO0FBRTdELDBCQUEwQjtBQUMxQixJQUFZLG1CQVFYO0FBUkQsV0FBWSxtQkFBbUI7SUFDN0Isb0RBQTZCLENBQUE7SUFDN0IsNENBQXFCLENBQUE7SUFDckIsa0RBQTJCLENBQUE7SUFDM0IsNENBQXFCLENBQUE7SUFDckIsZ0RBQXlCLENBQUE7SUFDekIsZ0RBQXlCLENBQUE7SUFDekIsZ0RBQXlCLENBQUE7QUFDM0IsQ0FBQyxFQVJXLG1CQUFtQixtQ0FBbkIsbUJBQW1CLFFBUTlCO0FBRUQsK0JBQStCO0FBQy9CLElBQVksbUJBS1g7QUFMRCxXQUFZLG1CQUFtQjtJQUM3QixrQ0FBVyxDQUFBO0lBQ1gsd0NBQWlCLENBQUE7SUFDakIsb0NBQWEsQ0FBQTtJQUNiLDRDQUFxQixDQUFBO0FBQ3ZCLENBQUMsRUFMVyxtQkFBbUIsbUNBQW5CLG1CQUFtQixRQUs5QjtBQVlELHdDQUF3QztBQUN4QyxTQUFnQixlQUFlLENBQUMsUUFB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RUFBRSxFQUFFLE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxDQUFDLEVBQzdELGVBQWUsQ0FBQztRQUNkLFFBQVEsRUFBRSxtQkFBbUIsQ0FBQyxRQUFRO1FBQ3RDLFFBQVE7UUFDUixTQUFTLEVBQUUsR0FBRztRQUNkLE9BQU8sRUFBRSw4QkFBOEI7UUFDdkMsVUFBVSxFQUFFLEVBQUUsT0FBTyxFQUFFLFNBQVMsQ0FBQyxNQUFNLEVBQUU7S0FDMUMsQ0FBQyxDQUNILENBQUM7QUFDSixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZy1la29oXFxEZXNrdG9wXFxTdHJlbGxlck1pbmRzLUJhY2tlbmRcXHNyY1xcZGF0YS1xdWFsaXR5XFxkZWNvcmF0b3JzXFxkYXRhLXF1YWxpdHkuZGVjb3JhdG9ycy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhcHBseURlY29yYXRvcnMsIFNldE1ldGFkYXRhIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xyXG5pbXBvcnQgeyBJc05vdEVtcHR5LCBJc0VtYWlsLCBJc1N0cmluZywgSXNOdW1iZXIsIElzRGF0ZSwgSXNPcHRpb25hbCwgVmFsaWRhdGVOZXN0ZWQsIElzRW51bSwgSXNVVUlELCBJc0Jvb2xlYW4sIE1pbiwgTWF4LCBMZW5ndGgsIE1hdGNoZXMgfSBmcm9tICdjbGFzcy12YWxpZGF0b3InO1xyXG5pbXBvcnQgeyBUcmFuc2Zvcm0sIFR5cGUgfSBmcm9tICdjbGFzcy10cmFuc2Zvcm1lcic7XHJcblxyXG4vLyBNZXRhZGF0YSBrZXlzIGZvciBkYXRhIHF1YWxpdHkgcnVsZXNcclxuZXhwb3J0IGNvbnN0IERBVEFfUVVBTElUWV9SVUxFU19LRVkgPSAnZGF0YV9xdWFsaXR5X3J1bGVzJztcclxuZXhwb3J0IGNvbnN0IERBVEFfUVVBTElUWV9FTlRJVFlfS0VZID0gJ2RhdGFfcXVhbGl0eV9lbnRpdHknO1xyXG5cclxuLy8gRGF0YSBxdWFsaXR5IHJ1bGUgdHlwZXNcclxuZXhwb3J0IGVudW0gRGF0YVF1YWxpdHlSdWxlVHlwZSB7XHJcbiAgQ09NUExFVEVORVNTID0gJ2NvbXBsZXRlbmVzcycsXHJcbiAgQUNDVVJBQ1kgPSAnYWNjdXJhY3knLFxyXG4gIENPTlNJU1RFTkNZID0gJ2NvbnNpc3RlbmN5JyxcclxuICBWQUxJRElUWSA9ICd2YWxpZGl0eScsXHJcbiAgVU5JUVVFTkVTUyA9ICd1bmlxdWVuZXNzJyxcclxuICBUSU1FTElORVNTID0gJ3RpbWVsaW5lc3MnLFxyXG4gIENPTkZPUk1JVFkgPSAnY29uZm9ybWl0eScsXHJcbn1cclxuXHJcbi8vIERhdGEgcXVhbGl0eSBzZXZlcml0eSBsZXZlbHNcclxuZXhwb3J0IGVudW0gRGF0YVF1YWxpdHlTZXZlcml0eSB7XHJcbiAgTE9XID0gJ2xvdycsXHJcbiAgTUVESVVNID0gJ21lZGl1bScsXHJcbiAgSElHSCA9ICdoaWdoJyxcclxuICBDUklUSUNBTCA9ICdjcml0aWNhbCcsXHJcbn1cclxuXHJcbi8vIEludGVyZmFjZSBmb3IgZGF0YSBxdWFsaXR5IHJ1bGUgbWV0YWRhdGFcclxuZXhwb3J0IGludGVyZmFjZSBEYXRhUXVhbGl0eVJ1bGVNZXRhZGF0YSB7XHJcbiAgcnVsZVR5cGU6IERhdGFRdWFsaXR5UnVsZVR5cGU7XHJcbiAgc2V2ZXJpdHk6IERhdGFRdWFsaXR5U2V2ZXJpdHk7XHJcbiAgdGhyZXNob2xkPzogbnVtYmVyO1xyXG4gIG1lc3NhZ2U/OiBzdHJpbmc7XHJcbiAgYXV0b0ZpeD86IGJvb2xlYW47XHJcbiAgY29uZGl0aW9ucz86IFJlY29yZDxzdHJpbmcsIGFueT47XHJcbn1cclxuXHJcbi8vIEJhc2UgZGVjb3JhdG9yIGZvciBkYXRhIHF1YWxpdHkgcnVsZXNcclxuZXhwb3J0IGZ1bmN0aW9uIERhdGFRdWFsaXR5UnVsZShtZXRhZGF0YTogRGF0YVF1YWxpdHlSdWxlTWV0YWRhdGEpIHtcclxuICByZXR1cm4gU2V0TWV0YWRhdGEoREFUQV9RVUFMSVRZX1JVTEVTX0tFWSwgbWV0YWRhdGEpO1xyXG59XHJcblxyXG4vLyBNYXJrIGVudGl0eSBmb3IgZGF0YSBxdWFsaXR5IG1vbml0b3JpbmdcclxuZXhwb3J0IGZ1bmN0aW9uIERhdGFRdWFsaXR5RW50aXR5KGVudGl0eVR5cGU6IHN0cmluZykge1xyXG4gIHJldHVybiBTZXRNZXRhZGF0YShEQVRBX1FVQUxJVFlfRU5USVRZX0tFWSwgZW50aXR5VHlwZSk7XHJcbn1cclxuXHJcbi8vIENvbXBsZXRlbmVzcyBkZWNvcmF0b3JzXHJcbmV4cG9ydCBmdW5jdGlvbiBSZXF1aXJlZEZpZWxkKG1lc3NhZ2U/OiBzdHJpbmcsIHNldmVyaXR5OiBEYXRhUXVhbGl0eVNldmVyaXR5ID0gRGF0YVF1YWxpdHlTZXZlcml0eS5ISUdIKSB7XHJcbiAgcmV0dXJuIGFwcGx5RGVjb3JhdG9ycyhcclxuICAgIElzTm90RW1wdHkoeyBtZXNzYWdlOiBtZXNzYWdlIHx8ICdGaWVsZCBpcyByZXF1aXJlZCcgfSksXHJcbiAgICBEYXRhUXVhbGl0eVJ1bGUoe1xyXG4gICAgICBydWxlVHlwZTogRGF0YVF1YWxpdHlSdWxlVHlwZS5DT01QTEVURU5FU1MsXHJcbiAgICAgIHNldmVyaXR5LFxyXG4gICAgICB0aHJlc2hvbGQ6IDEwMCxcclxuICAgICAgbWVzc2FnZTogbWVzc2FnZSB8fCAnRmllbGQgbXVzdCBub3QgYmUgZW1wdHknLFxyXG4gICAgfSlcclxuICApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gT3B0aW9uYWxGaWVsZCgpIHtcclxuICByZXR1cm4gSXNPcHRpb25hbCgpO1xyXG59XHJcblxyXG4vLyBBY2N1cmFjeSBkZWNvcmF0b3JzXHJcbmV4cG9ydCBmdW5jdGlvbiBWYWxpZEVtYWlsKHNldmVyaXR5OiBEYXRhUXVhbGl0eVNldmVyaXR5ID0gRGF0YVF1YWxpdHlTZXZlcml0eS5ISUdIKSB7XHJcbiAgcmV0dXJuIGFwcGx5RGVjb3JhdG9ycyhcclxuICAgIElzRW1haWwoe30sIHsgbWVzc2FnZTogJ011c3QgYmUgYSB2YWxpZCBlbWFpbCBhZGRyZXNzJyB9KSxcclxuICAgIERhdGFRdWFsaXR5UnVsZSh7XHJcbiAgICAgIHJ1bGVUeXBlOiBEYXRhUXVhbGl0eVJ1bGVUeXBlLkFDQ1VSQUNZLFxyXG4gICAgICBzZXZlcml0eSxcclxuICAgICAgdGhyZXNob2xkOiAxMDAsXHJcbiAgICAgIG1lc3NhZ2U6ICdFbWFpbCBmb3JtYXQgaXMgaW52YWxpZCcsXHJcbiAgICB9KVxyXG4gICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBWYWxpZFN0cmluZyhtaW5MZW5ndGg/OiBudW1iZXIsIG1heExlbmd0aD86IG51bWJlciwgc2V2ZXJpdHk6IERhdGFRdWFsaXR5U2V2ZXJpdHkgPSBEYXRhUXVhbGl0eVNldmVyaXR5Lk1FRElVTSkge1xyXG4gIGNvbnN0IGRlY29yYXRvcnMgPSBbXHJcbiAgICBJc1N0cmluZyh7IG1lc3NhZ2U6ICdNdXN0IGJlIGEgc3RyaW5nJyB9KSxcclxuICAgIERhdGFRdWFsaXR5UnVsZSh7XHJcbiAgICAgIHJ1bGVUeXBlOiBEYXRhUXVhbGl0eVJ1bGVUeXBlLkFDQ1VSQUNZLFxyXG4gICAgICBzZXZlcml0eSxcclxuICAgICAgdGhyZXNob2xkOiAxMDAsXHJcbiAgICAgIG1lc3NhZ2U6ICdTdHJpbmcgZm9ybWF0IGlzIGludmFsaWQnLFxyXG4gICAgfSlcclxuICBdO1xyXG5cclxuICBpZiAobWluTGVuZ3RoICE9PSB1bmRlZmluZWQgfHwgbWF4TGVuZ3RoICE9PSB1bmRlZmluZWQpIHtcclxuICAgIGRlY29yYXRvcnMucHVzaChMZW5ndGgobWluTGVuZ3RoIHx8IDAsIG1heExlbmd0aCB8fCAxMDAwLCB7XHJcbiAgICAgIG1lc3NhZ2U6IGBTdHJpbmcgbGVuZ3RoIG11c3QgYmUgYmV0d2VlbiAke21pbkxlbmd0aCB8fCAwfSBhbmQgJHttYXhMZW5ndGggfHwgMTAwMH0gY2hhcmFjdGVyc2BcclxuICAgIH0pKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBhcHBseURlY29yYXRvcnMoLi4uZGVjb3JhdG9ycyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBWYWxpZE51bWJlcihtaW4/OiBudW1iZXIsIG1heD86IG51bWJlciwgc2V2ZXJpdHk6IERhdGFRdWFsaXR5U2V2ZXJpdHkgPSBEYXRhUXVhbGl0eVNldmVyaXR5Lk1FRElVTSkge1xyXG4gIGNvbnN0IGRlY29yYXRvcnMgPSBbXHJcbiAgICBJc051bWJlcih7fSwgeyBtZXNzYWdlOiAnTXVzdCBiZSBhIG51bWJlcicgfSksXHJcbiAgICBEYXRhUXVhbGl0eVJ1bGUoe1xyXG4gICAgICBydWxlVHlwZTogRGF0YVF1YWxpdHlSdWxlVHlwZS5BQ0NVUkFDWSxcclxuICAgICAgc2V2ZXJpdHksXHJcbiAgICAgIHRocmVzaG9sZDogMTAwLFxyXG4gICAgICBtZXNzYWdlOiAnTnVtYmVyIGZvcm1hdCBpcyBpbnZhbGlkJyxcclxuICAgIH0pXHJcbiAgXTtcclxuXHJcbiAgaWYgKG1pbiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICBkZWNvcmF0b3JzLnB1c2goTWluKG1pbiwgeyBtZXNzYWdlOiBgTnVtYmVyIG11c3QgYmUgYXQgbGVhc3QgJHttaW59YCB9KSk7XHJcbiAgfVxyXG5cclxuICBpZiAobWF4ICE9PSB1bmRlZmluZWQpIHtcclxuICAgIGRlY29yYXRvcnMucHVzaChNYXgobWF4LCB7IG1lc3NhZ2U6IGBOdW1iZXIgbXVzdCBub3QgZXhjZWVkICR7bWF4fWAgfSkpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGFwcGx5RGVjb3JhdG9ycyguLi5kZWNvcmF0b3JzKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIFZhbGlkRGF0ZShzZXZlcml0eTogRGF0YVF1YWxpdHlTZXZlcml0eSA9IERhdGFRdWFsaXR5U2V2ZXJpdHkuTUVESVVNKSB7XHJcbiAgcmV0dXJuIGFwcGx5RGVjb3JhdG9ycyhcclxuICAgIElzRGF0ZSh7IG1lc3NhZ2U6ICdNdXN0IGJlIGEgdmFsaWQgZGF0ZScgfSksXHJcbiAgICBUeXBlKCgpID0+IERhdGUpLFxyXG4gICAgVHJhbnNmb3JtKCh7IHZhbHVlIH0pID0+IHZhbHVlIGluc3RhbmNlb2YgRGF0ZSA/IHZhbHVlIDogbmV3IERhdGUodmFsdWUpKSxcclxuICAgIERhdGFRdWFsaXR5UnVsZSh7XHJcbiAgICAgIHJ1bGVUeXBlOiBEYXRhUXVhbGl0eVJ1bGVUeXBlLkFDQ1VSQUNZLFxyXG4gICAgICBzZXZlcml0eSxcclxuICAgICAgdGhyZXNob2xkOiAxMDAsXHJcbiAgICAgIG1lc3NhZ2U6ICdEYXRlIGZvcm1hdCBpcyBpbnZhbGlkJyxcclxuICAgIH0pXHJcbiAgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIFZhbGlkVVVJRChzZXZlcml0eTogRGF0YVF1YWxpdHlTZXZlcml0eSA9IERhdGFRdWFsaXR5U2V2ZXJpdHkuSElHSCkge1xyXG4gIHJldHVybiBhcHBseURlY29yYXRvcnMoXHJcbiAgICBJc1VVSUQoJzQnLCB7IG1lc3NhZ2U6ICdNdXN0IGJlIGEgdmFsaWQgVVVJRCcgfSksXHJcbiAgICBEYXRhUXVhbGl0eVJ1bGUoe1xyXG4gICAgICBydWxlVHlwZTogRGF0YVF1YWxpdHlSdWxlVHlwZS5BQ0NVUkFDWSxcclxuICAgICAgc2V2ZXJpdHksXHJcbiAgICAgIHRocmVzaG9sZDogMTAwLFxyXG4gICAgICBtZXNzYWdlOiAnVVVJRCBmb3JtYXQgaXMgaW52YWxpZCcsXHJcbiAgICB9KVxyXG4gICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBWYWxpZEJvb2xlYW4oc2V2ZXJpdHk6IERhdGFRdWFsaXR5U2V2ZXJpdHkgPSBEYXRhUXVhbGl0eVNldmVyaXR5LkxPVykge1xyXG4gIHJldHVybiBhcHBseURlY29yYXRvcnMoXHJcbiAgICBJc0Jvb2xlYW4oeyBtZXNzYWdlOiAnTXVzdCBiZSBhIGJvb2xlYW4gdmFsdWUnIH0pLFxyXG4gICAgRGF0YVF1YWxpdHlSdWxlKHtcclxuICAgICAgcnVsZVR5cGU6IERhdGFRdWFsaXR5UnVsZVR5cGUuQUNDVVJBQ1ksXHJcbiAgICAgIHNldmVyaXR5LFxyXG4gICAgICB0aHJlc2hvbGQ6IDEwMCxcclxuICAgICAgbWVzc2FnZTogJ0Jvb2xlYW4gZm9ybWF0IGlzIGludmFsaWQnLFxyXG4gICAgfSlcclxuICApO1xyXG59XHJcblxyXG4vLyBQYXR0ZXJuIG1hdGNoaW5nIGRlY29yYXRvclxyXG5leHBvcnQgZnVuY3Rpb24gVmFsaWRQYXR0ZXJuKHBhdHRlcm46IFJlZ0V4cCwgbWVzc2FnZT86IHN0cmluZywgc2V2ZXJpdHk6IERhdGFRdWFsaXR5U2V2ZXJpdHkgPSBEYXRhUXVhbGl0eVNldmVyaXR5Lk1FRElVTSkge1xyXG4gIHJldHVybiBhcHBseURlY29yYXRvcnMoXHJcbiAgICBNYXRjaGVzKHBhdHRlcm4sIHsgbWVzc2FnZTogbWVzc2FnZSB8fCAnRG9lcyBub3QgbWF0Y2ggcmVxdWlyZWQgcGF0dGVybicgfSksXHJcbiAgICBEYXRhUXVhbGl0eVJ1bGUoe1xyXG4gICAgICBydWxlVHlwZTogRGF0YVF1YWxpdHlSdWxlVHlwZS5DT05GT1JNSVRZLFxyXG4gICAgICBzZXZlcml0eSxcclxuICAgICAgdGhyZXNob2xkOiAxMDAsXHJcbiAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UgfHwgJ1BhdHRlcm4gdmFsaWRhdGlvbiBmYWlsZWQnLFxyXG4gICAgICBjb25kaXRpb25zOiB7IHBhdHRlcm46IHBhdHRlcm4uc291cmNlIH0sXHJcbiAgICB9KVxyXG4gICk7XHJcbn1cclxuXHJcbi8vIEVudW0gdmFsaWRhdGlvbiBkZWNvcmF0b3JcclxuZXhwb3J0IGZ1bmN0aW9uIFZhbGlkRW51bTxUPihlbnVtT2JqZWN0OiBULCBzZXZlcml0eTogRGF0YVF1YWxpdHlTZXZlcml0eSA9IERhdGFRdWFsaXR5U2V2ZXJpdHkuTUVESVVNKSB7XHJcbiAgcmV0dXJuIGFwcGx5RGVjb3JhdG9ycyhcclxuICAgIElzRW51bShlbnVtT2JqZWN0LCB7IG1lc3NhZ2U6ICdNdXN0IGJlIGEgdmFsaWQgZW51bSB2YWx1ZScgfSksXHJcbiAgICBEYXRhUXVhbGl0eVJ1bGUoe1xyXG4gICAgICBydWxlVHlwZTogRGF0YVF1YWxpdHlSdWxlVHlwZS5WQUxJRElUWSxcclxuICAgICAgc2V2ZXJpdHksXHJcbiAgICAgIHRocmVzaG9sZDogMTAwLFxyXG4gICAgICBtZXNzYWdlOiAnRW51bSB2YWxpZGF0aW9uIGZhaWxlZCcsXHJcbiAgICAgIGNvbmRpdGlvbnM6IHsgYWxsb3dlZFZhbHVlczogT2JqZWN0LnZhbHVlcyhlbnVtT2JqZWN0IGFzIGFueSkgfSxcclxuICAgIH0pXHJcbiAgKTtcclxufVxyXG5cclxuLy8gVW5pcXVlbmVzcyBkZWNvcmF0b3IgKGZvciB1c2Ugd2l0aCBjdXN0b20gdmFsaWRhdGlvbilcclxuZXhwb3J0IGZ1bmN0aW9uIFVuaXF1ZUZpZWxkKHNjb3BlPzogc3RyaW5nW10sIHNldmVyaXR5OiBEYXRhUXVhbGl0eVNldmVyaXR5ID0gRGF0YVF1YWxpdHlTZXZlcml0eS5ISUdIKSB7XHJcbiAgcmV0dXJuIERhdGFRdWFsaXR5UnVsZSh7XHJcbiAgICBydWxlVHlwZTogRGF0YVF1YWxpdHlSdWxlVHlwZS5VTklRVUVORVNTLFxyXG4gICAgc2V2ZXJpdHksXHJcbiAgICB0aHJlc2hvbGQ6IDEwMCxcclxuICAgIG1lc3NhZ2U6ICdGaWVsZCB2YWx1ZSBtdXN0IGJlIHVuaXF1ZScsXHJcbiAgICBjb25kaXRpb25zOiB7IHNjb3BlOiBzY29wZSB8fCBbXSB9LFxyXG4gIH0pO1xyXG59XHJcblxyXG4vLyBUaW1lbGluZXNzIGRlY29yYXRvclxyXG5leHBvcnQgZnVuY3Rpb24gVGltZWx5RmllbGQobWF4QWdlSG91cnM6IG51bWJlciwgc2V2ZXJpdHk6IERhdGFRdWFsaXR5U2V2ZXJpdHkgPSBEYXRhUXVhbGl0eVNldmVyaXR5Lk1FRElVTSkge1xyXG4gIHJldHVybiBEYXRhUXVhbGl0eVJ1bGUoe1xyXG4gICAgcnVsZVR5cGU6IERhdGFRdWFsaXR5UnVsZVR5cGUuVElNRUxJTkVTUyxcclxuICAgIHNldmVyaXR5LFxyXG4gICAgdGhyZXNob2xkOiAxMDAsXHJcbiAgICBtZXNzYWdlOiBgRmllbGQgdmFsdWUgaXMgdG9vIG9sZCAobWF4IGFnZTogJHttYXhBZ2VIb3Vyc30gaG91cnMpYCxcclxuICAgIGNvbmRpdGlvbnM6IHsgbWF4QWdlOiBtYXhBZ2VIb3VycyB9LFxyXG4gIH0pO1xyXG59XHJcblxyXG4vLyBDb25zaXN0ZW5jeSBkZWNvcmF0b3JzXHJcbmV4cG9ydCBmdW5jdGlvbiBDb25zaXN0ZW50V2l0aChyZWxhdGVkRmllbGQ6IHN0cmluZywgb3BlcmF0b3I6ICdlcXVhbHMnIHwgJ2dyZWF0ZXJfdGhhbicgfCAnbGVzc190aGFuJyA9ICdlcXVhbHMnLCBzZXZlcml0eTogRGF0YVF1YWxpdHlTZXZlcml0eSA9IERhdGFRdWFsaXR5U2V2ZXJpdHkuTUVESVVNKSB7XHJcbiAgcmV0dXJuIERhdGFRdWFsaXR5UnVsZSh7XHJcbiAgICBydWxlVHlwZTogRGF0YVF1YWxpdHlSdWxlVHlwZS5DT05TSVNURU5DWSxcclxuICAgIHNldmVyaXR5LFxyXG4gICAgdGhyZXNob2xkOiAxMDAsXHJcbiAgICBtZXNzYWdlOiBgRmllbGQgbXVzdCBiZSBjb25zaXN0ZW50IHdpdGggJHtyZWxhdGVkRmllbGR9YCxcclxuICAgIGNvbmRpdGlvbnM6IHtcclxuICAgICAgcnVsZXM6IFt7XHJcbiAgICAgICAgZmllbGQxOiAnY3VycmVudF9maWVsZCcsXHJcbiAgICAgICAgZmllbGQyOiByZWxhdGVkRmllbGQsXHJcbiAgICAgICAgb3BlcmF0b3IsXHJcbiAgICAgIH1dLFxyXG4gICAgfSxcclxuICB9KTtcclxufVxyXG5cclxuLy8gTmVzdGVkIG9iamVjdCB2YWxpZGF0aW9uXHJcbmV4cG9ydCBmdW5jdGlvbiBWYWxpZE5lc3RlZChzZXZlcml0eTogRGF0YVF1YWxpdHlTZXZlcml0eSA9IERhdGFRdWFsaXR5U2V2ZXJpdHkuTUVESVVNKSB7XHJcbiAgcmV0dXJuIGFwcGx5RGVjb3JhdG9ycyhcclxuICAgIFZhbGlkYXRlTmVzdGVkKCksXHJcbiAgICBEYXRhUXVhbGl0eVJ1bGUoe1xyXG4gICAgICBydWxlVHlwZTogRGF0YVF1YWxpdHlSdWxlVHlwZS5DT05GT1JNSVRZLFxyXG4gICAgICBzZXZlcml0eSxcclxuICAgICAgdGhyZXNob2xkOiAxMDAsXHJcbiAgICAgIG1lc3NhZ2U6ICdOZXN0ZWQgb2JqZWN0IHZhbGlkYXRpb24gZmFpbGVkJyxcclxuICAgIH0pXHJcbiAgKTtcclxufVxyXG5cclxuLy8gUGhvbmUgbnVtYmVyIHZhbGlkYXRpb25cclxuZXhwb3J0IGZ1bmN0aW9uIFZhbGlkUGhvbmVOdW1iZXIoc2V2ZXJpdHk6IERhdGFRdWFsaXR5U2V2ZXJpdHkgPSBEYXRhUXVhbGl0eVNldmVyaXR5Lk1FRElVTSkge1xyXG4gIGNvbnN0IHBob25lUGF0dGVybiA9IC9eW1xcK10/WzEtOV1bXFxkXXswLDE1fSQvO1xyXG4gIHJldHVybiBhcHBseURlY29yYXRvcnMoXHJcbiAgICBNYXRjaGVzKHBob25lUGF0dGVybiwgeyBtZXNzYWdlOiAnTXVzdCBiZSBhIHZhbGlkIHBob25lIG51bWJlcicgfSksXHJcbiAgICBEYXRhUXVhbGl0eVJ1bGUoe1xyXG4gICAgICBydWxlVHlwZTogRGF0YVF1YWxpdHlSdWxlVHlwZS5BQ0NVUkFDWSxcclxuICAgICAgc2V2ZXJpdHksXHJcbiAgICAgIHRocmVzaG9sZDogMTAwLFxyXG4gICAgICBtZXNzYWdlOiAnUGhvbmUgbnVtYmVyIGZvcm1hdCBpcyBpbnZhbGlkJyxcclxuICAgICAgY29uZGl0aW9uczogeyBwYXR0ZXJuOiBwaG9uZVBhdHRlcm4uc291cmNlIH0sXHJcbiAgICB9KVxyXG4gICk7XHJcbn1cclxuXHJcbi8vIFVSTCB2YWxpZGF0aW9uXHJcbmV4cG9ydCBmdW5jdGlvbiBWYWxpZFVSTChzZXZlcml0eTogRGF0YVF1YWxpdHlTZXZlcml0eSA9IERhdGFRdWFsaXR5U2V2ZXJpdHkuTUVESVVNKSB7XHJcbiAgY29uc3QgdXJsUGF0dGVybiA9IC9eaHR0cHM/OlxcL1xcLyh3d3dcXC4pP1stYS16QS1aMC05QDolLl9cXCt+Iz1dezEsMjU2fVxcLlthLXpBLVowLTkoKV17MSw2fVxcYihbLWEtekEtWjAtOSgpQDolX1xcKy5+Iz8mLy89XSopJC87XHJcbiAgcmV0dXJuIGFwcGx5RGVjb3JhdG9ycyhcclxuICAgIE1hdGNoZXModXJsUGF0dGVybiwgeyBtZXNzYWdlOiAnTXVzdCBiZSBhIHZhbGlkIFVSTCcgfSksXHJcbiAgICBEYXRhUXVhbGl0eVJ1bGUoe1xyXG4gICAgICBydWxlVHlwZTogRGF0YVF1YWxpdHlSdWxlVHlwZS5BQ0NVUkFDWSxcclxuICAgICAgc2V2ZXJpdHksXHJcbiAgICAgIHRocmVzaG9sZDogMTAwLFxyXG4gICAgICBtZXNzYWdlOiAnVVJMIGZvcm1hdCBpcyBpbnZhbGlkJyxcclxuICAgICAgY29uZGl0aW9uczogeyBwYXR0ZXJuOiB1cmxQYXR0ZXJuLnNvdXJjZSB9LFxyXG4gICAgfSlcclxuICApO1xyXG59XHJcblxyXG4vLyBDcmVkaXQgY2FyZCB2YWxpZGF0aW9uXHJcbmV4cG9ydCBmdW5jdGlvbiBWYWxpZENyZWRpdENhcmQoc2V2ZXJpdHk6IERhdGFRdWFsaXR5U2V2ZXJpdHkgPSBEYXRhUXVhbGl0eVNldmVyaXR5LkhJR0gpIHtcclxuICBjb25zdCBjY1BhdHRlcm4gPSAvXig/OjRbMC05XXsxMn0oPzpbMC05XXszfSk/fDVbMS01XVswLTldezE0fXwzWzQ3XVswLTldezEzfXwzWzAtOV17MTN9fDYoPzowMTF8NVswLTldezJ9KVswLTldezEyfSkkLztcclxuICByZXR1cm4gYXBwbHlEZWNvcmF0b3JzKFxyXG4gICAgTWF0Y2hlcyhjY1BhdHRlcm4sIHsgbWVzc2FnZTogJ011c3QgYmUgYSB2YWxpZCBjcmVkaXQgY2FyZCBudW1iZXInIH0pLFxyXG4gICAgRGF0YVF1YWxpdHlSdWxlKHtcclxuICAgICAgcnVsZVR5cGU6IERhdGFRdWFsaXR5UnVsZVR5cGUuQUNDVVJBQ1ksXHJcbiAgICAgIHNldmVyaXR5LFxyXG4gICAgICB0aHJlc2hvbGQ6IDEwMCxcclxuICAgICAgbWVzc2FnZTogJ0NyZWRpdCBjYXJkIGZvcm1hdCBpcyBpbnZhbGlkJyxcclxuICAgICAgY29uZGl0aW9uczogeyBwYXR0ZXJuOiBjY1BhdHRlcm4uc291cmNlIH0sXHJcbiAgICB9KVxyXG4gICk7XHJcbn1cclxuXHJcbi8vIFNvY2lhbCBTZWN1cml0eSBOdW1iZXIgdmFsaWRhdGlvbiAoVVMgZm9ybWF0KVxyXG5leHBvcnQgZnVuY3Rpb24gVmFsaWRTU04oc2V2ZXJpdHk6IERhdGFRdWFsaXR5U2V2ZXJpdHkgPSBEYXRhUXVhbGl0eVNldmVyaXR5LkNSSVRJQ0FMKSB7XHJcbiAgY29uc3Qgc3NuUGF0dGVybiA9IC9eKD8hNjY2fDAwMHw5XFxcXGR7Mn0pXFxcXGR7M30tKD8hMDApXFxcXGR7Mn0tKD8hMHs0fSlcXFxcZHs0fSQvO1xyXG4gIHJldHVybiBhcHBseURlY29yYXRvcnMoXHJcbiAgICBNYXRjaGVzKHNzblBhdHRlcm4sIHsgbWVzc2FnZTogJ011c3QgYmUgYSB2YWxpZCBTU04gZm9ybWF0IChYWFgtWFgtWFhYWCknIH0pLFxyXG4gICAgRGF0YVF1YWxpdHlSdWxlKHtcclxuICAgICAgcnVsZVR5cGU6IERhdGFRdWFsaXR5UnVsZVR5cGUuQUNDVVJBQ1ksXHJcbiAgICAgIHNldmVyaXR5LFxyXG4gICAgICB0aHJlc2hvbGQ6IDEwMCxcclxuICAgICAgbWVzc2FnZTogJ1NTTiBmb3JtYXQgaXMgaW52YWxpZCcsXHJcbiAgICAgIGNvbmRpdGlvbnM6IHsgcGF0dGVybjogc3NuUGF0dGVybi5zb3VyY2UgfSxcclxuICAgIH0pXHJcbiAgKTtcclxufVxyXG5cclxuLy8gSVAgQWRkcmVzcyB2YWxpZGF0aW9uXHJcbmV4cG9ydCBmdW5jdGlvbiBWYWxpZElQQWRkcmVzcyhzZXZlcml0eTogRGF0YVF1YWxpdHlTZXZlcml0eSA9IERhdGFRdWFsaXR5U2V2ZXJpdHkuTUVESVVNKSB7XHJcbiAgY29uc3QgaXBQYXR0ZXJuID0gL14oPzooPzoyNVswLTVdfDJbMC00XVswLTldfFswMV0/WzAtOV1bMC05XT8pXFwuKXszfSg/OjI1WzAtNV18MlswLTRdWzAtOV18WzAxXT9bMC05XVswLTldPykkLztcclxuICByZXR1cm4gYXBwbHlEZWNvcmF0b3JzKFxyXG4gICAgTWF0Y2hlcyhpcFBhdHRlcm4sIHsgbWVzc2FnZTogJ011c3QgYmUgYSB2YWxpZCBJUCBhZGRyZXNzJyB9KSxcclxuICAgIERhdGFRdWFsaXR5UnVsZSh7XHJcbiAgICAgIHJ1bGVUeXBlOiBEYXRhUXVhbGl0eVJ1bGVUeXBlLkFDQ1VSQUNZLFxyXG4gICAgICBzZXZlcml0eSxcclxuICAgICAgdGhyZXNob2xkOiAxMDAsXHJcbiAgICAgIG1lc3NhZ2U6ICdJUCBhZGRyZXNzIGZvcm1hdCBpcyBpbnZhbGlkJyxcclxuICAgICAgY29uZGl0aW9uczogeyBwYXR0ZXJuOiBpcFBhdHRlcm4uc291cmNlIH0sXHJcbiAgICB9KVxyXG4gICk7XHJcbn1cclxuIl0sInZlcnNpb24iOjN9