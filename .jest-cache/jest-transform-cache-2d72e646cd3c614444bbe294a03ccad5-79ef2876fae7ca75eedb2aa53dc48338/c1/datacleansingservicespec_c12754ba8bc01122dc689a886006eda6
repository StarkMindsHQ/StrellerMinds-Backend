555c53ed4e6aaedb949c5434a8864396
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const bull_1 = require("@nestjs/bull");
const data_cleansing_service_1 = require("../services/data-cleansing.service");
describe("DataCleansingService", () => {
    let service;
    let cleansingQueue;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                data_cleansing_service_1.DataCleansingService,
                {
                    provide: (0, bull_1.getQueueToken)("data-cleansing"),
                    useValue: {
                        add: jest.fn(),
                    },
                },
            ],
        }).compile();
        service = module.get(data_cleansing_service_1.DataCleansingService);
        cleansingQueue = module.get((0, bull_1.getQueueToken)("data-cleansing"));
    });
    it("should be defined", () => {
        expect(service).toBeDefined();
    });
    describe("cleanseData", () => {
        it("should remove nulls", async () => {
            const data = [
                { id: 1, name: "John", email: "john@example.com" },
                { id: 2, name: "Jane", email: null },
                { id: 3, name: "Bob", email: "bob@example.com" },
            ];
            const rules = [
                {
                    id: "rule1",
                    name: "Remove Nulls",
                    field: "email",
                    operation: "remove_nulls",
                },
            ];
            const result = await service.cleanseData(data, rules);
            expect(result.originalCount).toBe(3);
            expect(result.cleanedCount).toBe(2);
            expect(result.removedCount).toBe(1);
            expect(result.cleanedData).toHaveLength(2);
            expect(result.cleanedData.every((item) => item.email !== null)).toBe(true);
        });
        it("should trim whitespace", async () => {
            const data = [
                { id: 1, name: "  John  " },
                { id: 2, name: "Jane" },
                { id: 3, name: "  Bob  " },
            ];
            const rules = [
                {
                    id: "rule1",
                    name: "Trim Whitespace",
                    field: "name",
                    operation: "trim_whitespace",
                },
            ];
            const result = await service.cleanseData(data, rules);
            expect(result.modifiedCount).toBe(2);
            expect(result.cleanedData[0].name).toBe("John");
            expect(result.cleanedData[1].name).toBe("Jane");
            expect(result.cleanedData[2].name).toBe("Bob");
        });
        it("should remove duplicates", async () => {
            const data = [
                { id: 1, email: "john@example.com" },
                { id: 2, email: "jane@example.com" },
                { id: 3, email: "john@example.com" },
            ];
            const rules = [
                {
                    id: "rule1",
                    name: "Remove Duplicates",
                    field: "email",
                    operation: "remove_duplicates",
                },
            ];
            const result = await service.cleanseData(data, rules);
            expect(result.originalCount).toBe(3);
            expect(result.cleanedCount).toBe(2);
            expect(result.removedCount).toBe(1);
            expect(result.cleanedData).toHaveLength(2);
        });
        it("should standardize email format", async () => {
            const data = [
                { id: 1, email: "JOHN@EXAMPLE.COM  " },
                { id: 2, email: "  jane@example.com" },
            ];
            const rules = [
                {
                    id: "rule1",
                    name: "Standardize Email",
                    field: "email",
                    operation: "standardize_format",
                    parameters: { format: "email" },
                },
            ];
            const result = await service.cleanseData(data, rules);
            expect(result.modifiedCount).toBe(2);
            expect(result.cleanedData[0].email).toBe("john@example.com");
            expect(result.cleanedData[1].email).toBe("jane@example.com");
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxnLWVrb2hcXERlc2t0b3BcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFxkYXRhLXF1YWxpdHlcXF9fdGVzdHNfX1xcZGF0YS1jbGVhbnNpbmcuc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQTBEO0FBQzFELHVDQUE0QztBQUc1QywrRUFBeUU7QUFFekUsUUFBUSxDQUFDLHNCQUFzQixFQUFFLEdBQUcsRUFBRTtJQUNwQyxJQUFJLE9BQTZCLENBQUE7SUFDakMsSUFBSSxjQUFxQixDQUFBO0lBRXpCLFVBQVUsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNwQixNQUFNLE1BQU0sR0FBa0IsTUFBTSxjQUFJLENBQUMsbUJBQW1CLENBQUM7WUFDM0QsU0FBUyxFQUFFO2dCQUNULDZDQUFvQjtnQkFDcEI7b0JBQ0UsT0FBTyxFQUFFLElBQUEsb0JBQWEsRUFBQyxnQkFBZ0IsQ0FBQztvQkFDeEMsUUFBUSxFQUFFO3dCQUNSLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO3FCQUNmO2lCQUNGO2FBQ0Y7U0FDRixDQUFDLENBQUMsT0FBTyxFQUFFLENBQUE7UUFFWixPQUFPLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBdUIsNkNBQW9CLENBQUMsQ0FBQTtRQUNoRSxjQUFjLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBUSxJQUFBLG9CQUFhLEVBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFBO0lBQ3JFLENBQUMsQ0FBQyxDQUFBO0lBRUYsRUFBRSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtRQUMzQixNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUE7SUFDL0IsQ0FBQyxDQUFDLENBQUE7SUFFRixRQUFRLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtRQUMzQixFQUFFLENBQUMscUJBQXFCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDbkMsTUFBTSxJQUFJLEdBQUc7Z0JBQ1gsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLElB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QUFHLE1BQU0sT0FBTyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUE7WUFFckQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7WUFDcEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUE7WUFDNUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUE7UUFDOUQsQ0FBQyxDQUFDLENBQUE7SUFDSixDQUFDLENBQUMsQ0FBQTtBQUNKLENBQUMsQ0FBQyxDQUFBIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZy1la29oXFxEZXNrdG9wXFxTdHJlbGxlck1pbmRzLUJhY2tlbmRcXHNyY1xcZGF0YS1xdWFsaXR5XFxfX3Rlc3RzX19cXGRhdGEtY2xlYW5zaW5nLnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCB0eXBlIFRlc3RpbmdNb2R1bGUgfSBmcm9tIFwiQG5lc3Rqcy90ZXN0aW5nXCJcclxuaW1wb3J0IHsgZ2V0UXVldWVUb2tlbiB9IGZyb20gXCJAbmVzdGpzL2J1bGxcIlxyXG5pbXBvcnQgdHlwZSB7IFF1ZXVlIH0gZnJvbSBcImJ1bGxcIlxyXG5cclxuaW1wb3J0IHsgRGF0YUNsZWFuc2luZ1NlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvZGF0YS1jbGVhbnNpbmcuc2VydmljZVwiXHJcblxyXG5kZXNjcmliZShcIkRhdGFDbGVhbnNpbmdTZXJ2aWNlXCIsICgpID0+IHtcclxuICBsZXQgc2VydmljZTogRGF0YUNsZWFuc2luZ1NlcnZpY2VcclxuICBsZXQgY2xlYW5zaW5nUXVldWU6IFF1ZXVlXHJcblxyXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcclxuICAgICAgcHJvdmlkZXJzOiBbXHJcbiAgICAgICAgRGF0YUNsZWFuc2luZ1NlcnZpY2UsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgcHJvdmlkZTogZ2V0UXVldWVUb2tlbihcImRhdGEtY2xlYW5zaW5nXCIpLFxyXG4gICAgICAgICAgdXNlVmFsdWU6IHtcclxuICAgICAgICAgICAgYWRkOiBqZXN0LmZuKCksXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF0sXHJcbiAgICB9KS5jb21waWxlKClcclxuXHJcbiAgICBzZXJ2aWNlID0gbW9kdWxlLmdldDxEYXRhQ2xlYW5zaW5nU2VydmljZT4oRGF0YUNsZWFuc2luZ1NlcnZpY2UpXHJcbiAgICBjbGVhbnNpbmdRdWV1ZSA9IG1vZHVsZS5nZXQ8UXVldWU+KGdldFF1ZXVlVG9rZW4oXCJkYXRhLWNsZWFuc2luZ1wiKSlcclxuICB9KVxyXG5cclxuICBpdChcInNob3VsZCBiZSBkZWZpbmVkXCIsICgpID0+IHtcclxuICAgIGV4cGVjdChzZXJ2aWNlKS50b0JlRGVmaW5lZCgpXHJcbiAgfSlcclxuXHJcbiAgZGVzY3JpYmUoXCJjbGVhbnNlRGF0YVwiLCAoKSA9PiB7XHJcbiAgICBpdChcInNob3VsZCByZW1vdmUgbnVsbHNcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBkYXRhID0gW1xyXG4gICAgICAgIHsgaWQ6IDEsIG5hbWU6IFwiSm9oblwiLCBlbWFpbDogXCJqb2huQGV4YW1wbGUuY29tXCIgfSxcclxuICAgICAgICB7IGlkOiAyLCBuYW1lOiBcIkphbmVcIiwgZW1haWw6IG51bGwgfSxcclxuICAgICAgICB7IGlkOiAzLCBuYW1lOiBcIkJvYlwiLCBlbWFpbDogXCJib2JAZXhhbXBsZS5jb21cIiB9LFxyXG4gICAgICBdXHJcblxyXG4gICAgICBjb25zdCBydWxlcyA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICBpZDogXCJydWxlMVwiLFxyXG4gICAgICAgICAgbmFtZTogXCJSZW1vdmUgTnVsbHNcIixcclxuICAgICAgICAgIGZpZWxkOiBcImVtYWlsXCIsXHJcbiAgICAgICAgICBvcGVyYXRpb246IFwicmVtb3ZlX251bGxzXCIsXHJcbiAgICAgICAgfSxcclxuICAgICAgXVxyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jbGVhbnNlRGF0YShkYXRhLCBydWxlcylcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQub3JpZ2luYWxDb3VudCkudG9CZSgzKVxyXG4gICAgICBleHBlY3QocmVzdWx0LmNsZWFuZWRDb3VudCkudG9CZSgyKVxyXG4gICAgICBleHBlY3QocmVzdWx0LnJlbW92ZWRDb3VudCkudG9CZSgxKVxyXG4gICAgICBleHBlY3QocmVzdWx0LmNsZWFuZWREYXRhKS50b0hhdmVMZW5ndGgoMilcclxuICAgICAgZXhwZWN0KHJlc3VsdC5jbGVhbmVkRGF0YS5ldmVyeSgoaXRlbSkgPT4gaXRlbS5lbWFpbCAhPT0gbnVsbCkpLnRvQmUodHJ1ZSlcclxuICAgIH0pXHJcblxyXG4gICAgaXQoXCJzaG91bGQgdHJpbSB3aGl0ZXNwYWNlXCIsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZGF0YSA9IFtcclxuICAgICAgICB7IGlkOiAxLCBuYW1lOiBcIiAgSm9obiAgXCIgfSxcclxuICAgICAgICB7IGlkOiAyLCBuYW1lOiBcIkphbmVcIiB9LFxyXG4gICAgICAgIHsgaWQ6IDMsIG5hbWU6IFwiICBCb2IgIFwiIH0sXHJcbiAgICAgIF1cclxuXHJcbiAgICAgIGNvbnN0IHJ1bGVzID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIGlkOiBcInJ1bGUxXCIsXHJcbiAgICAgICAgICBuYW1lOiBcIlRyaW0gV2hpdGVzcGFjZVwiLFxyXG4gICAgICAgICAgZmllbGQ6IFwibmFtZVwiLFxyXG4gICAgICAgICAgb3BlcmF0aW9uOiBcInRyaW1fd2hpdGVzcGFjZVwiLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF1cclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuY2xlYW5zZURhdGEoZGF0YSwgcnVsZXMpXHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0Lm1vZGlmaWVkQ291bnQpLnRvQmUoMilcclxuICAgICAgZXhwZWN0KHJlc3VsdC5jbGVhbmVkRGF0YVswXS5uYW1lKS50b0JlKFwiSm9oblwiKVxyXG4gICAgICBleHBlY3QocmVzdWx0LmNsZWFuZWREYXRhWzFdLm5hbWUpLnRvQmUoXCJKYW5lXCIpXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuY2xlYW5lZERhdGFbMl0ubmFtZSkudG9CZShcIkJvYlwiKVxyXG4gICAgfSlcclxuXHJcbiAgICBpdChcInNob3VsZCByZW1vdmUgZHVwbGljYXRlc1wiLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGRhdGEgPSBbXHJcbiAgICAgICAgeyBpZDogMSwgZW1haWw6IFwiam9obkBleGFtcGxlLmNvbVwiIH0sXHJcbiAgICAgICAgeyBpZDogMiwgZW1haWw6IFwiamFuZUBleGFtcGxlLmNvbVwiIH0sXHJcbiAgICAgICAgeyBpZDogMywgZW1haWw6IFwiam9obkBleGFtcGxlLmNvbVwiIH0sXHJcbiAgICAgIF1cclxuXHJcbiAgICAgIGNvbnN0IHJ1bGVzID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIGlkOiBcInJ1bGUxXCIsXHJcbiAgICAgICAgICBuYW1lOiBcIlJlbW92ZSBEdXBsaWNhdGVzXCIsXHJcbiAgICAgICAgICBmaWVsZDogXCJlbWFpbFwiLFxyXG4gICAgICAgICAgb3BlcmF0aW9uOiBcInJlbW92ZV9kdXBsaWNhdGVzXCIsXHJcbiAgICAgICAgfSxcclxuICAgICAgXVxyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jbGVhbnNlRGF0YShkYXRhLCBydWxlcylcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQub3JpZ2luYWxDb3VudCkudG9CZSgzKVxyXG4gICAgICBleHBlY3QocmVzdWx0LmNsZWFuZWRDb3VudCkudG9CZSgyKVxyXG4gICAgICBleHBlY3QocmVzdWx0LnJlbW92ZWRDb3VudCkudG9CZSgxKVxyXG4gICAgICBleHBlY3QocmVzdWx0LmNsZWFuZWREYXRhKS50b0hhdmVMZW5ndGgoMilcclxuICAgIH0pXHJcblxyXG4gICAgaXQoXCJzaG91bGQgc3RhbmRhcmRpemUgZW1haWwgZm9ybWF0XCIsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZGF0YSA9IFtcclxuICAgICAgICB7IGlkOiAxLCBlbWFpbDogXCJKT0hOQEVYQU1QTEUuQ09NICBcIiB9LFxyXG4gICAgICAgIHsgaWQ6IDIsIGVtYWlsOiBcIiAgamFuZUBleGFtcGxlLmNvbVwiIH0sXHJcbiAgICAgIF1cclxuXHJcbiAgICAgIGNvbnN0IHJ1bGVzID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIGlkOiBcInJ1bGUxXCIsXHJcbiAgICAgICAgICBuYW1lOiBcIlN0YW5kYXJkaXplIEVtYWlsXCIsXHJcbiAgICAgICAgICBmaWVsZDogXCJlbWFpbFwiLFxyXG4gICAgICAgICAgb3BlcmF0aW9uOiBcInN0YW5kYXJkaXplX2Zvcm1hdFwiLFxyXG4gICAgICAgICAgcGFyYW1ldGVyczogeyBmb3JtYXQ6IFwiZW1haWxcIiB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF1cclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuY2xlYW5zZURhdGEoZGF0YSwgcnVsZXMpXHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0Lm1vZGlmaWVkQ291bnQpLnRvQmUoMilcclxuICAgICAgZXhwZWN0KHJlc3VsdC5jbGVhbmVkRGF0YVswXS5lbWFpbCkudG9CZShcImpvaG5AZXhhbXBsZS5jb21cIilcclxuICAgICAgZXhwZWN0KHJlc3VsdC5jbGVhbmVkRGF0YVsxXS5lbWFpbCkudG9CZShcImphbmVAZXhhbXBsZS5jb21cIilcclxuICAgIH0pXHJcbiAgfSlcclxufSlcclxuIl0sInZlcnNpb24iOjN9